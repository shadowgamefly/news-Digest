<!DOCTYPE html><html xmlns:cc="http://creativecommons.org/ns#"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>React Native Performance — An Updated Example – Tal Kol – Medium</title><link rel="canonical" href="https://medium.com/@talkol/react-native-performance-an-updated-example-6516bfde9c5c"><meta name="title" content="React Native Performance — An Updated Example – Tal Kol – Medium"><meta name="referrer" content="unsafe-url"><meta name="description" content="I’m working on my performance talk for React Amsterdam 2017, which is based on the post “Performance Limitations of React Native and How to Overcome Them”. I’ve decided to freshen up the example we…"><meta property="og:title" content="React Native Performance — An Updated Example – Tal Kol – Medium"><meta property="og:url" content="https://medium.com/@talkol/react-native-performance-an-updated-example-6516bfde9c5c"><meta property="og:image" content="https://cdn-images-1.medium.com/max/1200/1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="I’m working on my performance talk for React Amsterdam 2017, which is based on the post “Performance Limitations of React Native and How to…"><meta name="twitter:description" content="I’m working on my performance talk for React Amsterdam 2017, which is based on the post “Performance Limitations of React Native and How to…"><meta name="twitter:image:src" content="https://cdn-images-1.medium.com/max/1200/1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@talkol"><meta property="author" content="Tal Kol"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="https://medium.com/@talkol"><meta property="fb:smart_publish:robots" content="noauto"><meta name="robots" content="index, follow"><meta property="article:published_time" content="2017-04-15T21:24:57.801Z"><meta name="twitter:creator" content="@koltal"><meta name="twitter:site" content="@Medium"><meta property="og:site_name" content="Medium"><meta name="twitter:label1" value="Reading time"><meta name="twitter:data1" value="9 min read"><script type="application/ld+json">{"@context":"http://schema.org","@type":"NewsArticle","image":{"@type":"ImageObject","width":1920,"height":325,"url":"https://cdn-images-1.medium.com/max/1920/1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg"},"datePublished":"2017-04-15T21:24:57.801Z","dateModified":"2017-04-15T21:24:57.801Z","headline":"React Native Performance — An Updated Example","name":"React Native Performance — An Updated Example","keywords":["React Native","React","Mobile App Development","Mobile","JavaScript"],"author":{"@type":"Person","name":"Tal Kol","url":"https://medium.com/@talkol"},"creator":["Tal Kol"],"mainEntityOfPage":"https://medium.com/@talkol/react-native-performance-an-updated-example-6516bfde9c5c"}</script><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium://p/6516bfde9c5c"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium://p/6516bfde9c5c"><meta property="al:android:url" content="medium://p/6516bfde9c5c"><meta property="al:web:url" content="https://medium.com/@talkol/react-native-performance-an-updated-example-6516bfde9c5c"><link rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml" /><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/6516bfde9c5c" /><meta name="theme-color" content="#000000"><link rel="stylesheet" href="https://cdn-static-1.medium.com/_/fp/css/main-base.g2e09PlZK_j3Lw2AgNmbfQ.css"><script>if (window.top !== window.self) window.top.location = window.self.location.href;var OB_startTime = new Date().getTime(); var OB_loadErrors = []; function _onerror(e) { OB_loadErrors.push(e) }; if (document.addEventListener) document.addEventListener("error", _onerror, true); else if (document.attachEvent) document.attachEvent("onerror", _onerror); function _asyncScript(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = u; f.parentNode.insertBefore(s, f);}function _asyncStyles(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("link"); s.rel = "stylesheet"; s.href = u; f.parentNode.insertBefore(s, f); return s}var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-24232453-2"]); _gaq.push(["_setDomainName", window.location.hostname]); _gaq.push(["_setAllowLinker", true]); _gaq.push(["_trackPageview"]);_asyncScript(("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js");(new Image()).src = "/_/stat?event=pixel.load&origin=" + encodeURIComponent(location.origin);</script><script>(function () {var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; document.write("<style>section.section-image--fullBleed.is-backgrounded {padding-top: " + Math.round(1.1 * height) + "px;}section.section-image--fullScreen.is-backgrounded, section.section-image--coverFade.is-backgrounded {min-height: " + height + "px; padding-top: " + Math.round(0.5 * height) + "px;}.u-sizeViewHeight100 {height: " + height + "px !important;}.u-sizeViewHeight110 {height: " + Math.round(1.1 * height) + "px !important;}.u-sizeViewHeightMin100 {min-height: " + height + "px !important;}.u-sizeViewHeightMax100 {max-height: " + height + "px !important;}section.section-image--coverFade {height: " + height + "px;}.section-aspectRatioViewportPlaceholder, .section-aspectRatioViewportCropPlaceholder {max-height: " + height + "px;}.section-aspectRatioViewportBottomSpacer, .section-aspectRatioViewportBottomPlaceholder {max-height: " + Math.round(0.5 * height) + "px;}.zoomable:before {top: " + (-1 * height) + "px; left: " + (-1 * width) + "px; padding: " + height + "px " + width + "px;}</style>");})()</script><!--[if lt IE 9]><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js"></script><![endif]--><link rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-medium.TAS6uQ-Y7kcKgi0xjcYHXw.ico" class="js-favicon"><link rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/152/152/1*W0nmth_X8nFKjn6BZ388UQ.png"><link rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/120/120/1*W0nmth_X8nFKjn6BZ388UQ.png"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/76/76/1*W0nmth_X8nFKjn6BZ388UQ.png"><link rel="apple-touch-icon" sizes="60x60" href="https://cdn-images-1.medium.com/fit/c/60/60/1*W0nmth_X8nFKjn6BZ388UQ.png"><link rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon.KjTfUJo7yJH_fCoUzzH3cg.svg" color="#171717"></head><body itemscope class=" postShowScreen is-noJs"><script>document.body.className = document.body.className.replace(/(^|\s)is-noJs(\s|$)/, "$1is-js$2")</script><div class="site-main" id="container"><div class="butterBar butterBar--error"></div><div class="surface"><div id="prerendered" class="screenContent"><canvas class="canvas-renderer"></canvas><div class="container u-maxWidth740 u-xs-margin0 notesPositionContainer js-notesPositionContainer"></div><div class="metabar u-clearfix js-metabar"><div class="metabar-inner u-marginAuto u-maxWidth1000 u-paddingLeft20 u-paddingRight20 js-metabarMiddle"><div class="metabar-block metabar-block--left u-floatLeft u-height65 u-xs-height56"><a href="https://medium.com/" class="siteNav-logo" data-log-event="home"><span class="svgIcon svgIcon--logoNew svgIcon--45px is-flushLeft"><svg class="svgIcon-use" width="45" height="45"  viewBox="-17 18 45 45" data-multipart="true"><path d="M11.525 28.078c-.472-.225-.858.002-.858.506v20.044l8.616 4.113c.948.46 1.717.14 1.717-.7v-19.3a.22.22 0 0 0-.124-.19l-9.35-4.46v-.01z"/><path d="M.333 43.696l9.83-15.247c.278-.43.89-.6 1.36-.38l9.364 4.47c.06.03.082.1.047.15L10.666 48.63.333 43.698v-.002z"/><path d="M-8.57 28.35c-.786-.375-1.053-.096-.592.62L.333 43.696l10.333 4.932L.356 32.635a.156.156 0 0 0-.06-.054l-8.866-4.23z"/><path d="M.333 52.033c0 .84-.643 1.22-1.43.844l-8.045-3.84c-.472-.224-.858-.82-.858-1.325V28.89c0-.672.515-.976 1.145-.675l9.133 4.36a.092.092 0 0 1 .055.084v19.37z"/></svg></span><span class="u-textScreenReader">Homepage</span></a></div><div class="metabar-block u-floatRight u-xs-absolute u-xs-textAlignRight u-xs-right0 u-xs-marginRight20 u-height65 u-xs-height56"><div class="buttonSet"><a class="button button--primary button--chromeless u-accentColor--buttonNormal is-inSiteNavBar u-lineHeight30 u-height32"  href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2F%40talkol%2Freact-native-performance-an-updated-example-6516bfde9c5c" data-action="sign-in-prompt" data-redirect="https://medium.com/@talkol/react-native-performance-an-updated-example-6516bfde9c5c" data-action-source="nav_signup">Sign in / Sign up</a></div></div></div></div><div class="metabar metabar--spacer js-metabarSpacer u-height65 u-xs-height56"></div><main role="main"><article class=" u-sizeViewHeightMin100 u-overflowHidden postArticle postArticle--full u-marginBottom40"  lang="en"><header class="container u-maxWidth740"><div class="postMetaHeader u-paddingBottom10 row"><div class="col u-size12of12 js-postMetaLockup"><div class="postMetaLockup postMetaLockup--authorWithBio u-flex js-postMetaLockup"><div class="u-flex0"><a class="link avatar u-baseColor--link"  href="https://medium.com/@talkol?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="83a4f96844d0" data-action-type="hover" data-user-id="83a4f96844d0" dir="auto"><div class="u-relative u-inlineBlock"><img  src="https://cdn-images-1.medium.com/fit/c/60/60/1*RvlrG_Pdhzb4RmV6aeHnrg.png" class="avatar-image avatar-image--small" alt="Go to the profile of Tal Kol"><div class="u-absolute u-tintSpectrum u-accentColor--iconNormal u-textColorGreenNormal svgIcon" style="width: calc(100% + 12px); height: calc(100% + 12px); top:-6px; left:-6px"><svg viewBox="0 0 114 114" xmlns="http://www.w3.org/2000/svg"><path d="M7.66922967,32.092726 C17.0070768,13.6353618 35.9421928,1.75 57,1.75 C78.0578072,1.75 96.9929232,13.6353618 106.33077,32.092726 L107.66923,31.4155801 C98.0784505,12.4582656 78.6289015,0.25 57,0.25 C35.3710985,0.25 15.9215495,12.4582656 6.33077033,31.4155801 L7.66922967,32.092726 Z"></path><path d="M106.33077,81.661427 C96.9929232,100.118791 78.0578072,112.004153 57,112.004153 C35.9421928,112.004153 17.0070768,100.118791 7.66922967,81.661427 L6.33077033,82.338573 C15.9215495,101.295887 35.3710985,113.504153 57,113.504153 C78.6289015,113.504153 98.0784505,101.295887 107.66923,82.338573 L106.33077,81.661427 Z"></path></svg></div></div></a></div><div class="u-flex1 u-paddingLeft15 u-overflowHidden"><a class="link link link--darken link--darker u-baseColor--link"  href="https://medium.com/@talkol?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="83a4f96844d0" data-action-type="hover" data-user-id="83a4f96844d0" dir="auto">Tal Kol</a><span class="followState js-followState buttonSet-inner" data-user-id="83a4f96844d0"><button class="button u-paddingLeft10 u-paddingRight10 u-height19 u-lineHeight13 u-verticalAlignMiddle u-fontSize12 u-uiTextMedium u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-marginLeft10 u-marginTopNegative2 u-xs-hide"  data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="post_header_lockup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary u-paddingLeft10 u-paddingRight10 u-height19 u-lineHeight13 u-verticalAlignMiddle u-fontSize12 u-uiTextMedium u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-marginLeft10 u-marginTopNegative2 u-xs-hide"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/83a4f96844d0" data-action-source="post_header_lockup_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span><div class="postMetaInline u-noWrapWithEllipsis u-xs-normalWrap u-xs-lineClamp2">Full-stack developer. Co-founded two technology companies, the latter acquired by Wix.com.</div><div class="postMetaInline js-testPostMetaInlineSupplemental"><time datetime="2017-04-15T21:24:57.801Z">Apr 15</time><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="9 min read"></span></div></div></div></div></div></header><div class="postArticle-content js-postField js-notesSource js-trackedPost"  data-post-id="6516bfde9c5c" data-source="post_page" data-tracking-context="postPage"><section name="3f03" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="482b" id="482b" class="graf graf--h3 graf--leading graf--title">React Native Performance — An Updated Example</h1></div><div class="section-inner sectionLayout--fullWidth"><figure name="a3d5" id="a3d5" class="graf graf--figure graf--layoutFillWidth graf-after--h3"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 17%;"></div><img class="graf-image" data-image-id="1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg" data-width="2000" data-height="339" src="https://cdn-images-1.medium.com/max/2000/1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="67ab" id="67ab" class="graf graf--p graf-after--figure graf--trailing">I’m working on my performance talk for <a href="https://react.amsterdam/" data-href="https://react.amsterdam/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">React Amsterdam 2017</a>, which is based on the post “<a href="https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440" data-href="https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440" class="markup--anchor markup--p-anchor" target="_blank">Performance Limitations of React Native and How to Overcome Them</a>”. I’ve decided to freshen up the example we’ll be discussing in order to walk through some exciting new API available today.</p></div></div></section><section name="8aa3" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="3b85" id="3b85" class="graf graf--h4 graf--leading">Some background</h4><p name="2299" id="2299" class="graf graf--p graf-after--h4">In this post, we’ll be assuming you are already familiar with the basic architecture of React Native — the <em class="markup--em markup--p-em">native realm</em>, the <em class="markup--em markup--p-em">JavaScript realm</em> and the <em class="markup--em markup--p-em">bridge</em> connecting the two. If not, this topic is discussed in detail in the <a href="https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440" data-href="https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440" class="markup--anchor markup--p-anchor" target="_blank">previous post</a>.</p><p name="7610" id="7610" class="graf graf--p graf-after--p">Let’s also remember the main conclusion from the previous post that will guide our performance-oriented discussion:</p><blockquote name="2be1" id="2be1" class="graf graf--pullquote graf-after--p">In order to architect performant React Native apps, we must keep passes over the bridge to a minimum.</blockquote><p name="1e11" id="1e11" class="graf graf--p graf-after--pullquote">So.. Time to jump into our new interesting use-case which, as it turns out, is not trivial to implement with React Native in a performant manner.</p><h4 name="5e4a" id="5e4a" class="graf graf--h4 graf-after--p">A new real life example</h4><p name="7a52" id="7a52" class="graf graf--p graf-after--h4">Our use-case is inspired by the home screen of the <a href="https://itunes.apple.com/il/app/wix.com/id1099748482?mt=8" data-href="https://itunes.apple.com/il/app/wix.com/id1099748482?mt=8" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Wix.com app</a>. The screen holds a feed of cards and contains a large header image welcoming the user to the app. This is what the UX looks like:</p><figure name="fad7" id="fad7" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 248px; max-height: 440px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 177.4%;"></div><img class="graf-image" data-image-id="1*JEzdDNvJjNOy-mSvFM1-ig.gif" data-width="248" data-height="440" src="https://cdn-images-1.medium.com/max/800/1*JEzdDNvJjNOy-mSvFM1-ig.gif"></div></figure><p name="eb8b" id="eb8b" class="graf graf--p graf-after--figure">Notice two interesting effects. The first — as the user is scrolling down the list of cards, the header image dissolves slowly into the gray background. The second — if the user scrolls up and is already at the top of the list, for the sake of continuity of movement the header image zooms slightly until it bounces back (this is called an <em class="markup--em markup--p-em">overscroll effect</em>).</p><p name="de51" id="de51" class="graf graf--p graf-after--p">Effects like these may seem minor, but are part of the <em class="markup--em markup--p-em">last mile</em> that makes a magical user experience and separates the mediocre apps from the great ones. We’ll have to be careful with the implementation though. If it doesn’t run smoothly at 60 FPS, the effect might backfire and degrade user immersion instead of enhancing it.</p><p name="86c9" id="86c9" class="graf graf--p graf-after--p">The general component layout of the screen is very simple:</p><figure name="a194" id="a194" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/6bda26a7631d7ee37c7433583f180ea2?postId=6516bfde9c5c" data-media-id="6bda26a7631d7ee37c7433583f180ea2" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"></IFRAME></div></div></figure><p name="323c" id="323c" class="graf graf--p graf-after--figure">Notice that the header image is not part of the ListView because it remains static and doesn’t scroll with the list content. Also notice we are still using the older <a href="https://facebook.github.io/react-native/docs/listview.html" data-href="https://facebook.github.io/react-native/docs/listview.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">ListView</a> implementation instead of the recommended <a href="https://facebook.github.io/react-native/docs/flatlist.html" data-href="https://facebook.github.io/react-native/docs/flatlist.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">FlatList</a>. This is due to some extra <a href="https://facebook.github.io/react-native/docs/listview.html#renderscrollcomponent" data-href="https://facebook.github.io/react-native/docs/listview.html#renderscrollcomponent" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">flexibility</a> ListView provides that isn’t yet available in FlatList.</p><h4 name="5375" id="5375" class="graf graf--h4 graf-after--p">Our first implementation — onScroll events in JavaScript</h4><p name="5ea2" id="5ea2" class="graf graf--p graf-after--h4">As usual, we’ll start with the straightforward approach. If we want the effects to be tied to scroll position, we can listen on scroll events. Every time the scroll position changes, our event listener will fire and we’ll be able to re-render the header image and apply the appropriate effect.</p><p name="b100" id="b100" class="graf graf--p graf-after--p">The setup is somewhat tricky because <a href="https://facebook.github.io/react-native/docs/listview.html" data-href="https://facebook.github.io/react-native/docs/listview.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">ListView</a> doesn’t expose the internal <a href="https://facebook.github.io/react-native/docs/scrollview.html" data-href="https://facebook.github.io/react-native/docs/scrollview.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">ScrollView</a> used to scroll the content. It works by allowing us to provide our own custom ScrollView using the <code class="markup--code markup--p-code"><a href="https://facebook.github.io/react-native/docs/listview.html#renderscrollcomponent" data-href="https://facebook.github.io/react-native/docs/listview.html#renderscrollcomponent" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">renderScrollComponent</a></code> prop.</p><p name="ab5f" id="ab5f" class="graf graf--p graf-after--p">Applying the effects to the header image is as simple as defining style properties. We’ll use <code class="markup--code markup--p-code"><a href="https://facebook.github.io/react-native/docs/view.html#style" data-href="https://facebook.github.io/react-native/docs/view.html#style" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">opacity</a></code> to control the dissolve effect and <code class="markup--code markup--p-code"><a href="http://facebook.github.io/react-native/releases/0.40/docs/transforms.html" data-href="http://facebook.github.io/react-native/releases/0.40/docs/transforms.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">transform.scale</a></code> to control the zoom effect. We’ll store the values for both in local component state and re-render by calling <code class="markup--code markup--p-code">setState</code>.</p><p name="19e6" id="19e6" class="graf graf--p graf-after--p">This is the complete implementation:</p><figure name="270c" id="270c" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/00aa2ad404b56d8d88eab0425334ca14?postId=6516bfde9c5c" data-media-id="00aa2ad404b56d8d88eab0425334ca14" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"></IFRAME></div></div></figure><p name="2e70" id="2e70" class="graf graf--p graf-after--figure">As you can see, on every <code class="markup--code markup--p-code">onScroll</code> event we decide which effect to apply based on scroll position (<code class="markup--code markup--p-code">contentOffset</code>). If the scroll position is positive (downwards scroll), opacity is decreased from <code class="markup--code markup--p-code">1.0</code> to <code class="markup--code markup--p-code">0.0</code>. If the scroll position is negative (upwards overscroll), scale is increased from <code class="markup--code markup--p-code">1.0</code> to <code class="markup--code markup--p-code">1.4</code>.</p><h4 name="6a5b" id="6a5b" class="graf graf--h4 graf-after--p">First attempt — performance analysis</h4><p name="b92f" id="b92f" class="graf graf--p graf-after--h4">What performance should we expect from this implementation? The main performance bottleneck is probably the number of passes over the bridge.</p><p name="752e" id="752e" class="graf graf--p graf-after--p">Let’s count passes by analyzing what’s running in the <em class="markup--em markup--p-em">JavaScript realm</em> (purple on the left) and what’s running in the <em class="markup--em markup--p-em">native realm</em> (black on the right):</p><figure name="e1a0" id="e1a0" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 389px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 55.60000000000001%;"></div><img class="graf-image" data-image-id="1*4a_A-hBMc3fMuHpSYqnLXQ.png" data-width="1410" data-height="784" data-action="zoom" data-action-value="1*4a_A-hBMc3fMuHpSYqnLXQ.png" src="https://cdn-images-1.medium.com/max/800/1*4a_A-hBMc3fMuHpSYqnLXQ.png"></div></figure><p name="3aee" id="3aee" class="graf graf--p graf-after--figure">Just like any other view event, scroll events originate in the <em class="markup--em markup--p-em">native realm. </em>Our JavaScript logic runs in the <em class="markup--em markup--p-em">JavaScript realm</em>. Once we re-render, the new view properties must be applied to the actual native views back in the <em class="markup--em markup--p-em">native realm</em>. This means we’re passing over the bridge twice for every frame.</p><p name="bf90" id="bf90" class="graf graf--p graf-after--p">On busy apps, this will prevent us from running at 60 FPS. Let’s improve.</p><h4 name="ae51" id="ae51" class="graf graf--h4 graf-after--p">A second implementation attempt — native scroll listener</h4><p name="526d" id="526d" class="graf graf--p graf-after--h4">React Native is very flexible regarding which components are implemented in JavaScript and which components are implemented in pure native. A native component can contain a JavaScript component and a JavaScript component can contain a native one.</p><p name="5e98" id="5e98" class="graf graf--p graf-after--p">Whenever we have a performance issue, we can usually pull this rabbit out of the hat. Porting one of our components to native can usually solve the problem. Let’s try to apply this principle here.</p><p name="722b" id="722b" class="graf graf--p graf-after--p">Our performance bottleneck stems from implementing our scroll listener in JavaScript. Since scroll events originate in the <em class="markup--em markup--p-em">native realm</em>, executing our <code class="markup--code markup--p-code">onScroll</code> logic in JavaScript will always incur overhead. Let’s move the <code class="markup--code markup--p-code">onScroll</code> logic to native.</p><p name="287a" id="287a" class="graf graf--p graf-after--p">The purpose of <code class="markup--code markup--p-code">onScroll</code> is to update view properties (opacity and scale). We can save this trip over the bridge as well by closing the entire loop in native. Instead of changing the opacity and scale of the header image directly, we can wrap the image with a native container component —conveniently named <code class="markup--code markup--p-code">NativeWrapper</code>— that will change its own properties. This will work because both opacity and scale of a container affect its children as well. This <code class="markup--code markup--p-code">NativeWrapper</code> component will contain the native implementation of our <code class="markup--code markup--p-code">onScroll</code> logic.</p><p name="8492" id="8492" class="graf graf--p graf-after--p">Our new layout:</p><figure name="4338" id="4338" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/9e50074ef53a6d7655ed7659d09ddc86?postId=6516bfde9c5c" data-media-id="9e50074ef53a6d7655ed7659d09ddc86" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"></IFRAME></div></div></figure><p name="3c64" id="3c64" class="graf graf--p graf-after--figure">The only challenge so far is hooking our native scroll listener to the correct ScrollView. The ScrollView is part of the ListView and is neither a child or parent of our <code class="markup--code markup--p-code">NativeWrapper</code>. We need to be able to pinpoint it from within the native implementation in order to connect the listener. Every React component has a <em class="markup--em markup--p-em">node handle</em> — sometimes called a <em class="markup--em markup--p-em">React tag</em>. This is just a number that uniquely identifies this component instance. We can find this number using <code class="markup--code markup--p-code"><a href="https://github.com/facebook/react/blob/72196da82915bee400edb1599d4223926aa2a8a0/src/renderers/native/findNodeHandle.js#L59" data-href="https://github.com/facebook/react/blob/72196da82915bee400edb1599d4223926aa2a8a0/src/renderers/native/findNodeHandle.js#L59" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">ReactNative.findNodeHandle</a></code> and simply pass it as prop to <code class="markup--code markup--p-code">NativeWrapper</code>.</p><p name="ea58" id="ea58" class="graf graf--p graf-after--p">Now that the JavaScript side is all set up, it’s time to get our hands dirty with some Objective-C.</p><p name="002b" id="002b" class="graf graf--p graf-after--p">Porting the <code class="markup--code markup--p-code">onScroll</code> logic itself to Objective-C is easy. The code actually looks almost exactly the same. Instead of calling <code class="markup--code markup--p-code">setState</code> to update the view properties, we can simply change the view properties directly since we’re running in the <em class="markup--em markup--p-em">native realm</em>.</p><p name="fe28" id="fe28" class="graf graf--p graf-after--p">The only challenge here once again is hooking our native scroll listener. Once the numeric <em class="markup--em markup--p-em">node handle</em> of the ScrollView arrives via props, we need to translate it back to a view object reference in order to access the underlying ScrollView instance. This involves a little <a href="https://github.com/facebook/react-native/blob/da9a712a9e17942dcd05b8d955f0764c2026a4ad/React/Views/RCTWebViewManager.m#L56" data-href="https://github.com/facebook/react-native/blob/da9a712a9e17942dcd05b8d955f0764c2026a4ad/React/Views/RCTWebViewManager.m#L56" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">borrowed boilerplate</a> that uses the <a href="https://github.com/facebook/react-native/blob/bc1ea548d0017f131c36a30ce06bf4d512cb2f8c/React/Modules/RCTUIManager.h" data-href="https://github.com/facebook/react-native/blob/bc1ea548d0017f131c36a30ce06bf4d512cb2f8c/React/Modules/RCTUIManager.h" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">UIManager</a> to do the translation.</p><p name="a898" id="a898" class="graf graf--p graf-after--p">This is the Objective-C implementation:</p><figure name="ce98" id="ce98" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/40814033809df0ca48b7e2e2497352d2?postId=6516bfde9c5c" data-media-id="40814033809df0ca48b7e2e2497352d2" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"></IFRAME></div></div></figure><p name="edc9" id="edc9" class="graf graf--p graf-after--figure">As you can see, the <code class="markup--code markup--p-code">onScroll</code> implementation is almost identical to the JavaScript one. If the scroll position is positive (downwards scroll), opacity is natively decreased from <code class="markup--code markup--p-code">1.0</code> to <code class="markup--code markup--p-code">0.0</code>. If the scroll position is negative (upwards overscroll), scale is natively increased from <code class="markup--code markup--p-code">1.0</code> to <code class="markup--code markup--p-code">1.4</code>.</p><h4 name="e7f2" id="e7f2" class="graf graf--h4 graf-after--p">Second attempt — performance analysis</h4><p name="4a70" id="4a70" class="graf graf--p graf-after--h4">We expect performance to be much better since this implementation is tailored for reducing passes over the bridge.</p><p name="58d0" id="58d0" class="graf graf--p graf-after--p">Let’s count passes by analyzing what’s running in the <em class="markup--em markup--p-em">JavaScript realm</em> (purple on the left) and what’s running in the <em class="markup--em markup--p-em">native realm</em> (black on the right):</p><figure name="dfe3" id="dfe3" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 384px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 54.800000000000004%;"></div><img class="graf-image" data-image-id="1*TFOpiGcat_rSXVnxjcldqA.png" data-width="1404" data-height="770" data-action="zoom" data-action-value="1*TFOpiGcat_rSXVnxjcldqA.png" src="https://cdn-images-1.medium.com/max/800/1*TFOpiGcat_rSXVnxjcldqA.png"></div></figure><p name="d6f6" id="d6f6" class="graf graf--p graf-after--figure">It’s not surprising that we’ve indeed eliminated all the passes over the bridge after initialization. Both handling of the scroll events and updating of the view properties accordingly now take place in the <em class="markup--em markup--p-em">native realm</em>.</p><p name="7c31" id="7c31" class="graf graf--p graf-after--p">We’re still not happy though. This implementation may be performant, but it’s rather complex and requires native expertise. Can we do the same from JavaScript?</p><h4 name="9895" id="9895" class="graf graf--h4 graf-after--p">Third time’s a charm — declarative API for the win</h4><p name="678e" id="678e" class="graf graf--p graf-after--h4">So, can we do the same from JavaScript? This is the million dollar question for React Native. For the framework to be truly useful, we must find ways to resolve these performance issues without resorting to native code.</p><p name="e4ea" id="e4ea" class="graf graf--p graf-after--p">This is one area where a lot of progress has been made since the <a href="https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440" data-href="https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440" class="markup--anchor markup--p-anchor" target="_blank">previous post</a>. The key to reducing passes over the bridge is <em class="markup--em markup--p-em">declarative API</em>. It allows us to declare behaviors in advance in JavaScript and serialize the entire declaration and send it once over the bridge during initialization. From this point on, a general purpose <em class="markup--em markup--p-em">native driver</em> — one that you don’t need to write yourself — will execute the behavior in the <em class="markup--em markup--p-em">native realm </em>according to the declared specification.</p><p name="0343" id="0343" class="graf graf--p graf-after--p">The behavior we want consists of two parts — listening to scroll position changes and updating view properties (opacity and scale). For the latter, we know that <a href="https://facebook.github.io/react-native/docs/animated.html" data-href="https://facebook.github.io/react-native/docs/animated.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Animated</a>, the excellent animation library that’s part of the core, provides good support.</p><p name="69ae" id="69ae" class="graf graf--p graf-after--p">What is less known is that Animated can drive an <code class="markup--code markup--p-code"><a href="https://facebook.github.io/react-native/docs/animated.html#animatedvalue" data-href="https://facebook.github.io/react-native/docs/animated.html#animatedvalue" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Animated.Value</a></code> based on <a href="https://github.com/facebook/react-native/blob/c7387fefc85fd15dceadfa291857099ed3e848b8/Examples/UIExplorer/js/NativeAnimationsExample.js#L195" data-href="https://github.com/facebook/react-native/blob/c7387fefc85fd15dceadfa291857099ed3e848b8/Examples/UIExplorer/js/NativeAnimationsExample.js#L195" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">scroll events</a> as well.</p><p name="e716" id="e716" class="graf graf--p graf-after--p">How does that work? Let’s jump into the complete implementation:</p><figure name="a7d4" id="a7d4" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/3f0a0789635821f2cd365446e444cb80?postId=6516bfde9c5c" data-media-id="3f0a0789635821f2cd365446e444cb80" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"></IFRAME></div></div></figure><p name="3c6e" id="3c6e" class="graf graf--p graf-after--figure">We’ve started by defining an <code class="markup--code markup--p-code">Animated.Value</code> that we’ll use to hold the scroll position at any given time. We’re providing our ListView with a custom ScrollView component — an <code class="markup--code markup--p-code">Animated.ScrollView</code> instead of a regular ScrollView. The <code class="markup--code markup--p-code">Animated.ScrollView</code> lets us declare that our <code class="markup--code markup--p-code">Animated.Value</code> is driven by the <code class="markup--code markup--p-code">contentOffset</code> property of the native <code class="markup--code markup--p-code">onScroll</code> event.</p><p name="0d6e" id="0d6e" class="graf graf--p graf-after--p">From this point forward, we can use the standard Animated approach of interpolating view properties based on an <code class="markup--code markup--p-code">Animated.Value</code>. This requires changing our header image to <code class="markup--code markup--p-code">Animated.Image</code> and allows us to interpolate both the <code class="markup--code markup--p-code">opacity</code> and <code class="markup--code markup--p-code">transform.scale</code> from scroll position.</p><p name="b9fa" id="b9fa" class="graf graf--p graf-after--p">Note that the entire implementation is <em class="markup--em markup--p-em">declarative</em>. We no longer have an imperative <code class="markup--code markup--p-code">onScroll</code> function that performs calculations for our effects.</p><p name="ee08" id="ee08" class="graf graf--p graf-after--p">Also note that we’ve specified <code class="markup--code markup--p-code">useNativeDriver</code>. The implementation of the Animated library in recent versions of React Native finally contains a <em class="markup--em markup--p-em">native driver</em> that can execute the entire declaration from the <em class="markup--em markup--p-em">native realm</em> without using the bridge.</p><h4 name="f120" id="f120" class="graf graf--h4 graf-after--p">Third attempt — performance analysis</h4><p name="4612" id="4612" class="graf graf--p graf-after--h4">As usual, we’ll count passes by analyzing what’s running in the <em class="markup--em markup--p-em">JavaScript realm</em> (purple on the left) and what’s running in the <em class="markup--em markup--p-em">native realm</em> (black on the right):</p><figure name="11d3" id="11d3" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 387px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 55.300000000000004%;"></div><img class="graf-image" data-image-id="1*b338WkFCW3WDel08VxxApA.png" data-width="1402" data-height="776" data-action="zoom" data-action-value="1*b338WkFCW3WDel08VxxApA.png" src="https://cdn-images-1.medium.com/max/800/1*b338WkFCW3WDel08VxxApA.png"></div></figure><p name="76c5" id="76c5" class="graf graf--p graf-after--figure">The only part running in the <em class="markup--em markup--p-em">JavaScript realm</em> is the initialization of our declaration. The entire declared behavior is serialized and sent over the bridge once in order to configure the general-purpose <em class="markup--em markup--p-em">native driver</em> of Animated.</p><p name="8497" id="8497" class="graf graf--p graf-after--p">After the driver has been configured, it takes care of the frame by frame for us in the <em class="markup--em markup--p-em">native realm</em> without additional passes over the bridge. This section has been grayed out since it’s no longer under the responsibility of our code.</p><h4 name="699b" id="699b" class="graf graf--h4 graf-after--p">Comparing the three implementations</h4><p name="77c4" id="77c4" class="graf graf--p graf-after--h4">The full code of all three implementations is available on GitHub:</p><div name="7de0" id="7de0" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/wix/rn-perf-experiments2" data-href="https://github.com/wix/rn-perf-experiments2" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/wix/rn-perf-experiments2" rel="nofollow"><strong class="markup--strong markup--mixtapeEmbed-strong">wix/rn-perf-experiments2</strong><br><em class="markup--em markup--mixtapeEmbed-em">rn-perf-experiments2 - React Native performance experiments revisited</em>github.com</a><a href="https://github.com/wix/rn-perf-experiments2" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="7eb0e17daebbcee381e71af5968c9819" data-thumbnail-img-id="0*rA8JfWZrQmRyoBOJ." style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*rA8JfWZrQmRyoBOJ.);"></a></div><p name="dd09" id="dd09" class="graf graf--p graf-after--mixtapeEmbed">The demo project lets you choose which implementation to use so they can be compared side by side. Try to run it on a real device. Judging performance on a simulator is usually inaccurate.</p><p name="250d" id="250d" class="graf graf--p graf-after--p">Since it’s just a simple demo app, there is very little unrelated bridge activity. You will probably not notice any difference between implementations. To assist with this, the demo app provides a toggle to simulate stress conditions with plenty of activity. As you can see, turning it on will make the performance differences much more evident:</p><figure name="16aa" id="16aa" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 270px; max-height: 480px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 177.8%;"></div><img class="graf-image" data-image-id="1*v29H0OZ-GngqseBG-7jqEA.gif" data-width="270" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*v29H0OZ-GngqseBG-7jqEA.gif"></div></figure><h4 name="ef87" id="ef87" class="graf graf--h4 graf-after--figure">Summary</h4><p name="05ae" id="05ae" class="graf graf--p graf-after--h4">Architecting performant React Native app is not always straightforward. You should normally start with the naive approach, but if you begin to notice performance issues with your app, always consider the number of passes over the bridge.</p><p name="58a9" id="58a9" class="graf graf--p graf-after--p">As the framework matures, common tasks that are prone to high bridge traffic are addressed with declarative API that is designed to reduce passes over the bridge. The <a href="https://facebook.github.io/react-native/docs/animated.html" data-href="https://facebook.github.io/react-native/docs/animated.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Animated</a> library is a good example. Another interesting example is <a href="https://github.com/wix/react-native-interactable" data-href="https://github.com/wix/react-native-interactable" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">react-native-interactable</a> which I’ve demonstrated in <a href="https://youtu.be/mjsv8NJnt5k" data-href="https://youtu.be/mjsv8NJnt5k" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">ReactConf 2017</a>. To learn more about it, check out the post “<a href="https://hackernoon.com/moving-beyond-animations-to-user-interactions-at-60-fps-in-react-native-b6b1fa0ba525" data-href="https://hackernoon.com/moving-beyond-animations-to-user-interactions-at-60-fps-in-react-native-b6b1fa0ba525" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Moving Beyond Animations to User Interactions at 60 FPS in React Native</a>”.</p><p name="611a" id="611a" class="graf graf--p graf-after--p graf--trailing">If you hit a wall and can’t find a declarative API that resolves your performance issue, you can always fall back on a native implementation. Bring a native developer or two into your team and port the problematic area to native like we did in the second implementation. It’s not always pretty, but it works.</p></div></div></section></div><footer class="u-paddingTop10"><div class="container u-maxWidth740"><div class="row"><div class="col u-size12of12"></div></div><div class="row"><div class="col u-size12of12 js-postTags"><div class="u-paddingBottom10"><ul class="tags tags--postTags tags--borderless"><li><a class="link u-baseColor--link"  href="https://medium.com/tag/react-native?source=post" data-action-source="post">React Native</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/react?source=post" data-action-source="post">React</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/mobile-app-development?source=post" data-action-source="post">Mobile App Development</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/mobile?source=post" data-action-source="post">Mobile</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/javascript?source=post" data-action-source="post">JavaScript</a></li></ul></div></div></div><div class="row js-postActionsFooter"><div class="postActions col u-size12of12"><div class="u-floatLeft buttonSet buttonSet--withLabels"><div class="buttonSet-inner"><div class="js-actionRecommend" data-post-id="6516bfde9c5c" data-is-icon-29px="true" data-has-recommend-list="true" data-source="post_actions_footer"><button class="button button--primary button--large button--chromeless is-touchIconFadeInPulse u-accentColor--buttonNormal button--withIcon button--withSvgIcon u-accentColor--iconLight js-actionRecommendButton"  title="Recommend to share this article with your followers and let the author know you liked it" aria-label="Recommend to share this article with your followers and let the author know you liked it" data-action="sign-in-prompt" data-sign-in-action="upvote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/6516bfde9c5c" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--heart svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.215 23.716c-.348.288-.984.826-1.376 1.158a.526.526 0 0 1-.68 0c-.36-.307-.92-.78-1.22-1.03C9.22 20.734 3 15.527 3 10.734 3 7.02 5.916 4 9.5 4c1.948 0 3.77.898 5 2.434C15.73 4.898 17.552 4 19.5 4c3.584 0 6.5 3.02 6.5 6.734 0 4.9-6.125 9.96-9.785 12.982zM19.5 5.2c-1.774 0-3.423.923-4.41 2.468a.699.699 0 0 1-.59.323.706.706 0 0 1-.59-.32c-.988-1.54-2.637-2.47-4.41-2.47-2.922 0-5.3 2.49-5.3 5.54 0 4.23 6.19 9.41 9.517 12.19.217.18.566.48.783.66l.952-.79c3.496-2.88 9.348-7.72 9.348-12.05 0-3.05-2.378-5.53-5.3-5.53z"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--heartFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.5 4c-1.948 0-3.77.898-5 2.434C13.27 4.898 11.448 4 9.5 4 5.916 4 3 7.02 3 10.734c0 4.793 6.227 10 9.95 13.11.296.25.853.723 1.212 1.03.196.166.48.166.677 0 .39-.332 1.02-.87 1.37-1.158 3.66-3.022 9.79-8.08 9.79-12.982C26 7.02 23.08 4 19.5 4z" fill-rule="evenodd"/></svg></span></span></button><button class="button button--chromeless u-baseColor--buttonNormal"  data-action="show-recommends" data-action-value="6516bfde9c5c">51</button></div></div><div class="buttonSet-inner"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  data-action="scroll-to-responses" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"/></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal"  data-action="scroll-to-responses">2</button></div></div><div class="u-floatRight buttonSet buttonSet--narrow"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"/></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"/></svg></span></button></div></div></div></div><div class="js-postPromotionWrapper postPromotionWrapper" data-location-id="footer_above_post_attribution"></div><div class="container u-maxWidth740 js-postAttributionFooterContainer u-paddingTop20 u-paddingBottom20 u-marginTop10 u-borderTopLightest u-xs-paddingTop10 u-xs-paddingBottom10"><div class="row js-postFooterInfo"><div class="col u-size12of12"><li class="u-block u-paddingBottom18 js-cardUser"><div class="u-marginLeft20 u-floatRight"><span class="followState js-followState buttonSet-inner" data-user-id="83a4f96844d0"><button class="button button--small u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton"  data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/83a4f96844d0" data-action-source="footer_card_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="u-tableCell "><a class="link avatar u-baseColor--link"  href="https://medium.com/@talkol?source=footer_card" title="Go to the profile of Tal Kol" aria-label="Go to the profile of Tal Kol" data-action-source="footer_card" data-user-id="83a4f96844d0" dir="auto"><div class="u-relative u-inlineBlock"><img  src="https://cdn-images-1.medium.com/fit/c/60/60/1*RvlrG_Pdhzb4RmV6aeHnrg.png" class="avatar-image avatar-image--small" alt="Go to the profile of Tal Kol"><div class="u-absolute u-tintSpectrum u-accentColor--iconNormal u-textColorGreenNormal svgIcon" style="width: calc(100% + 12px); height: calc(100% + 12px); top:-6px; left:-6px"><svg viewBox="0 0 114 114" xmlns="http://www.w3.org/2000/svg"><path d="M7.66922967,32.092726 C17.0070768,13.6353618 35.9421928,1.75 57,1.75 C78.0578072,1.75 96.9929232,13.6353618 106.33077,32.092726 L107.66923,31.4155801 C98.0784505,12.4582656 78.6289015,0.25 57,0.25 C35.3710985,0.25 15.9215495,12.4582656 6.33077033,31.4155801 L7.66922967,32.092726 Z"></path><path d="M106.33077,81.661427 C96.9929232,100.118791 78.0578072,112.004153 57,112.004153 C35.9421928,112.004153 17.0070768,100.118791 7.66922967,81.661427 L6.33077033,82.338573 C15.9215495,101.295887 35.3710985,113.504153 57,113.504153 C78.6289015,113.504153 98.0784505,101.295887 107.66923,82.338573 L106.33077,81.661427 Z"></path></svg></div></div></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="u-fontSize18 u-lineHeightTighter"><a class="link link--primary u-accentColor--hoverTextNormal"  href="https://medium.com/@talkol" property="cc:attributionName" title="Go to the profile of Tal Kol" aria-label="Go to the profile of Tal Kol" rel="author cc:attributionUrl" data-user-id="83a4f96844d0" dir="auto">Tal Kol</a></h3><p class="u-textColorGreenNormal u-tintSpectrum u-accentColor--textNormal u-fontSize13 u-marginBottom0 u-marginBottom7">Medium member since Apr 2017</p><p class="u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">Full-stack developer. Co-founded two technology companies, the latter acquired by Wix.com.</p></div></li></div></div></div><div class="js-postFooterPlacements"></div><div class="u-padding0 u-clearfix u-backgroundGrayLightest u-print-hide supplementalPostContent js-responsesWrapper"></div><div class="supplementalPostContent js-readNext"></div><div class="supplementalPostContent js-heroPromo"></div></footer></article></main><div class="u-marginAuto u-maxWidth1000"><div class="js-postShareWidget u-foreground u-sm-hide u-transition--fadeOut300 u-fixed"><ul><li class="u-uiTextSemibold u-textAlignCenter u-textColorNormal u-fontSize12 u-textUppercase">Share</li><li class="u-textAlignCenter"><div class="js-actionRecommend" data-post-id="6516bfde9c5c" data-is-icon-29px="true" data-is-vertical="true" data-has-recommend-list="true" data-source="post_share_widget"><button class="button button--primary button--large button--chromeless is-touchIconFadeInPulse u-accentColor--buttonNormal button--withIcon button--withSvgIcon u-accentColor--iconLight js-actionRecommendButton"  title="Recommend to share this article with your followers and let the author know you liked it" aria-label="Recommend to share this article with your followers and let the author know you liked it" data-action="sign-in-prompt" data-sign-in-action="upvote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/6516bfde9c5c" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--heart svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.215 23.716c-.348.288-.984.826-1.376 1.158a.526.526 0 0 1-.68 0c-.36-.307-.92-.78-1.22-1.03C9.22 20.734 3 15.527 3 10.734 3 7.02 5.916 4 9.5 4c1.948 0 3.77.898 5 2.434C15.73 4.898 17.552 4 19.5 4c3.584 0 6.5 3.02 6.5 6.734 0 4.9-6.125 9.96-9.785 12.982zM19.5 5.2c-1.774 0-3.423.923-4.41 2.468a.699.699 0 0 1-.59.323.706.706 0 0 1-.59-.32c-.988-1.54-2.637-2.47-4.41-2.47-2.922 0-5.3 2.49-5.3 5.54 0 4.23 6.19 9.41 9.517 12.19.217.18.566.48.783.66l.952-.79c3.496-2.88 9.348-7.72 9.348-12.05 0-3.05-2.378-5.53-5.3-5.53z"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--heartFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.5 4c-1.948 0-3.77.898-5 2.434C13.27 4.898 11.448 4 9.5 4 5.916 4 3 7.02 3 10.734c0 4.793 6.227 10 9.95 13.11.296.25.853.723 1.212 1.03.196.166.48.166.677 0 .39-.332 1.02-.87 1.37-1.158 3.66-3.022 9.79-8.08 9.79-12.982C26 7.02 23.08 4 19.5 4z" fill-rule="evenodd"/></svg></span></span></button><button class="button button--chromeless u-baseColor--buttonNormal  u-block u-marginAuto u-marginTopNegative5"  data-action="show-recommends" data-action-value="6516bfde9c5c">51</button></div></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_share_widget"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"/></svg></span></button></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_share_widget"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"/></svg></span></button></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton"  title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-in-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/6516bfde9c5c"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"/></svg></span></span></button></li></ul></div></div><div class="u-fixed u-bottom0 u-sizeFullWidth u-backgroundWhite u-boxShadowTop u-borderBox u-paddingTop10 u-paddingBottom10 u-zIndexMetabar u-xs-paddingLeft10 u-xs-paddingRight10 js-stickyFooter"><div class="u-maxWidth700 u-marginAuto u-flexCenter"><div class="u-fontSize16 u-flex1 u-flexCenter"><div class="u-flex0 u-inlineBlock u-paddingRight20 u-xs-paddingRight10"><a class="link avatar u-inline u-baseColor--link"  href="https://medium.com/@talkol" data-action="show-user-card" data-action-value="83a4f96844d0" data-action-type="hover" data-user-id="83a4f96844d0" dir="auto"><div class="u-relative u-inlineBlock"><img  src="https://cdn-images-1.medium.com/fit/c/40/40/1*RvlrG_Pdhzb4RmV6aeHnrg.png" class="avatar-image avatar-image--smaller" alt="Go to the profile of Tal Kol"><div class="u-absolute u-tintSpectrum u-accentColor--iconNormal u-textColorGreenNormal svgIcon" style="width: calc(100% + 10px); height: calc(100% + 10px); top:-5px; left:-5px"><svg viewBox="0 0 70 70" xmlns="http://www.w3.org/2000/svg"><path d="M5.53538374,19.9430227 C11.180401,8.78497536 22.6271155,1.6 35.3571429,1.6 C48.0871702,1.6 59.5338847,8.78497536 65.178902,19.9430227 L66.2496695,19.401306 C60.4023065,7.84329843 48.5440457,0.4 35.3571429,0.4 C22.17024,0.4 10.3119792,7.84329843 4.46461626,19.401306 L5.53538374,19.9430227 Z"></path><path d="M65.178902,49.9077131 C59.5338847,61.0657604 48.0871702,68.2507358 35.3571429,68.2507358 C22.6271155,68.2507358 11.180401,61.0657604 5.53538374,49.9077131 L4.46461626,50.4494298 C10.3119792,62.0074373 22.17024,69.4507358 35.3571429,69.4507358 C48.5440457,69.4507358 60.4023065,62.0074373 66.2496695,50.4494298 L65.178902,49.9077131 Z"></path></svg></div></div></a></div><div class="u-flex1 u-inlineBlock"><div class="u-xs-hide">Never miss a story from<strong> Tal Kol</strong>, when you sign up for Medium. <a class="link link--accent u-accentColor--textNormal u-accentColor--textDarken u-baseColor--link"  href="https://medium.com/@Medium/personalize-your-medium-experience-with-users-publications-tags-26a41ab1ee0c#.hx4zuv3mg" data-action-source="sticky_footer">Learn more</a></div><div class="u-xs-show">Never miss a story from<strong> Tal Kol</strong></div></div></div><div class="u-marginLeft50 u-xs-marginAuto"><span class="followState js-followState buttonSet-inner" data-user-id="83a4f96844d0"><button class="button u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-uiTextSemibold u-textUppercase u-fontSize12"  data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="sticky_footer"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary is-active u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-uiTextSemibold u-textUppercase u-fontSize12"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/83a4f96844d0" data-action-source="sticky_footer_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Get updates</span></button></span></div></div></div></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","buildLabel":"28586-6143d83","currentUser":{"userId":"lo_89034cbf61e6","isVerified":false,"subscriberEmail":""},"currentUserHasUnverifiedEmail":false,"isAuthenticated":false,"isCurrentUserVerified":false,"mediumTwitterScreenName":"medium","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.2nXtJ8XknWJqOjh2ZNHRVw.js","notes":"https://cdn-static-1.medium.com/_/fp/gen-js/main-notes.bundle.AouowiblLn4SBKZF6cWDtA.js","posters":"https://cdn-static-1.medium.com/_/fp/gen-js/main-posters.bundle.4rYp3nph7xNXmlmak5XWxQ.js","common-async":"https://cdn-static-1.medium.com/_/fp/gen-js/main-common-async.bundle.R35emyz9xZL7YdHbIl-SvQ.js","stats":"https://cdn-static-1.medium.com/_/fp/gen-js/main-stats.bundle.XUyD-cfC9DG2nc9iq5x7GA.js","home-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-home-screens.bundle.0oM8iNH9LgWeJY00O_ao2Q.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-misc-screens.bundle.caQfKUCZ18Wg2IbFBoaXiA.js"},"previewConfig":{"weightThreshold":1,"weightImageParagraph":0.51,"weightIframeParagraph":0.8,"weightTextParagraph":0.08,"weightEmptyParagraph":0,"weightP":0.003,"weightH":0.005,"weightBq":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15},"productName":"Medium","supportsEdit":false,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1492369994481:91a78877500e","useragent":{"browser":"python requests","family":"","os":"","version":2.2,"supportsDesktopEdit":false,"supportsInteract":false,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":false,"isTier1":false,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":false,"supportsVhUnits":false,"ruinsViewportSections":false,"supportsHtml5Video":false,"supportsMagicUnderlines":false,"isWebView":false,"isFacebookWebView":false,"supportsProgressiveMedia":false,"supportsPromotedPosts":true,"isBot":false,"isNativeIphone":false,"supportsCssVariables":false,"supportsScrollableMetabar":false},"variants":{"allow_access":true,"allow_signup":true,"allow_test_auth":"disallow","signin_services":"twitter,facebook,google,email,google-fastidv","signup_services":"twitter,facebook,google,email,google-fastidv","android_rating_prompt_recommend_threshold":5,"google_sign_in_android":true,"enable_onboarding":true,"ios_custom_miro_url":"https://cdn-images-1.medium.com","reengagement_notification_duration":3,"enable_adsnative_integration":true,"browsable_stream_config_bucket":"curated-topics","ios_small_post_preview_truncation_length":5.5,"ios_large_post_preview_truncation_length":5.5,"disable_ios_catalog_badging":true,"enable_series_creation":true,"enable_your_series_pages":true,"enable_productionized_series":true,"enable_dedicated_series_tab_api_ios":true,"enable_clap_milestone_notifications":true,"enable_series_stats_page":true,"enable_prepublish_share_settings":true,"enable_direct_auth_connect":true,"enable_post_import":true,"enable_sponsored_post_labelling":true,"enable_logged_in_follow_on_collection_post":true,"promoted_story_placement_locations":"POST_PAGE_FOOTER","show_topics":true,"enable_search_collection_by_tag_recency_filter":true,"search_collection_by_tag_filter_min_votes":10,"enable_sms_app_promo":true,"enable_export_members":true,"enable_series_card_background_creation":true,"enable_ios_onboarding_notifications":true,"can_see_subscription_branding":true,"enable_subscriptions_landing_page":true,"enable_partner_program_landing_page":true,"enable_hide_broken_links":true,"enable_pay_for_custom_domain":true,"enable_promos_from_dynamo":true,"enable_promos_in_placement":true,"enable_series_promo_in_email":true,"enable_sms":true,"enable_series_in_user_profiles":true,"enable_new_logged_out_bento_operation":true,"enable_topic_brief_relations":true},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","teamName":"Team Medium","fp":{"/icons/favicon.svg":"https://cdn-static-1.medium.com/_/fp/icons/favicon.KjTfUJo7yJH_fCoUzzH3cg.svg","/icons/favicon-dev-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-dev-editor.YKKRxBO8EMvIqhyCwIiJeQ.ico","/icons/favicon-hatch-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-hatch-editor.BuEyHIqlyh2s_XEk4Rl32Q.ico","/icons/favicon-medium-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"394474ced050e3911ae2249ecc774921","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","useDynamicCss":false,"faviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium.TAS6uQ-Y7kcKgi0xjcYHXw.ico","faviconImageId":"1*W0nmth_X8nFKjn6BZ388UQ.png","fontSets":[{"id":1,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-base.by5Oi_VbnwEIvhnWIsuUjA.css"},{"id":4,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-lazy-base.g08Jj5TZPAiuPWj5YNUsSg.css"},{"id":6,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-latin-base.141WxxXgxGxNcfeza73H7Q.css"},{"id":7,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-lazy-latin-base.jMU532QDmysQMOINr-cr2A.css"}],"editorFaviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrlRev":"moc.muidem//:sptth","isDnt":false,"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","archiveUploadSizeMb":100,"paymentData":{"currencies":{"1":{"label":"US Dollar","external":"usd"}},"countries":{"1":{"label":"United States of America","external":"US"}},"accountTypes":{"1":{"label":"Individual","external":"individual"},"2":{"label":"Company","external":"company"}}},"previewConfig2":{"weightThreshold":1,"weightImageParagraph":0.05,"raiseImage":true,"enforceHeaderHierarchy":true,"isImageInsetRight":true},"isAmp":false,"iosScheme":"medium","isSwBoot":false,"lightstep":{"accessToken":"ce5be895bef60919541332990ac9fef2","carrier":"{\"ot-tracer-spanid\":\"0147343f371b03ec\",\"ot-tracer-traceid\":\"2cb4e1ae30732fda\",\"ot-tracer-sampled\":\"true\"}","host":"collector-medium.lightstep.com"},"facebook":{"key":"542599432471018","secret":"c14df7146e9052a1131f3c900c1f0644","token":"542599432471018|1JqjIwxSfY9jOt_KwjWEl1R7T6I","namespace":"medium-com","scope":{"default":["public_profile","email","user_friends"],"connect":["public_profile","email","user_friends"],"login":["public_profile","email","user_friends"],"share":["public_profile","email","user_friends","publish_actions"]},"smartPublishWhitelistedPublications":["bcc38c8f6edf","f3726e2a5878","828a270689e","81c7d351c056","f30e42fd7ff8","8bf1d7d3081b","d16afa0ae7c","d8f3f6ad9c31","e74de0cedea9","15f753907972","c8c6a6b01ebd","3412b9729488","2ce4bbcf83bb","544c7006046e","7bfcdbc6b30a","a268fd916824","458a773bccd2"],"instantArticles":{"published":true,"developmentMode":false}},"mailingListArchiveUploadSizeMb":2,"availableMembershipPlans":[],"editorsPicksTopicId":"3985d2a191c5","popularOnMediumTopicId":"9d34e48ecf94","memberContentTopicId":"13d7efd82fb2","isDoNotAuth":false,"goldfinchUrl":"https://goldfinch.medium.com"}
// ]]></script><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.2nXtJ8XknWJqOjh2ZNHRVw.js" async></script><script>// <![CDATA[
window["obvInit"]({"value":{"id":"6516bfde9c5c","versionId":"63fdf840690a","creatorId":"83a4f96844d0","creator":{"userId":"83a4f96844d0","name":"Tal Kol","username":"talkol","createdAt":1465489677854,"lastPostCreatedAt":1492255667264,"imageId":"1*RvlrG_Pdhzb4RmV6aeHnrg.png","backgroundImageId":"","bio":"Full-stack developer. Co-founded two technology companies, the latter acquired by Wix.com.","twitterScreenName":"koltal","socialStats":{"userId":"83a4f96844d0","usersFollowedCount":22,"usersFollowedByCount":1456,"type":"SocialStats"},"social":{"userId":"lo_c78b086328cd","targetUserId":"83a4f96844d0","type":"Social"},"facebookAccountId":"","allowNotes":1,"mediumMemberAt":1492254985000,"type":"User"},"homeCollectionId":"","title":"React Native Performance — An Updated Example","detectedLanguage":"en","latestVersion":"63fdf840690a","latestPublishedVersion":"63fdf840690a","hasUnpublishedEdits":false,"latestRev":1451,"createdAt":1492255667264,"updatedAt":1492291497801,"acceptedAt":0,"firstPublishedAt":1492291497801,"latestPublishedAt":1492291497801,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"I’m working on my performance talk for React Amsterdam 2017, which is based on the post “Performance Limitations of React Native and How to…","bodyModel":{"paragraphs":[{"name":"482b","type":3,"text":"React Native Performance — An Updated Example","markups":[]},{"name":"a3d5","type":4,"text":"","markups":[],"layout":5,"metadata":{"id":"1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg","originalWidth":2000,"originalHeight":339}},{"name":"67ab","type":1,"text":"I’m working on my performance talk for React Amsterdam 2017, which is based on the post “Performance Limitations of React Native and How to Overcome Them”. I’ve decided to freshen up the example we’ll be discussing in order to walk through some exciting new API available today.","markups":[{"type":3,"start":39,"end":59,"href":"https://react.amsterdam/","title":"","rel":"","anchorType":0},{"type":3,"start":89,"end":153,"href":"https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440","title":"","rel":"","anchorType":0}]},{"name":"3b85","type":13,"text":"Some background","markups":[]},{"name":"2299","type":1,"text":"In this post, we’ll be assuming you are already familiar with the basic architecture of React Native — the native realm, the JavaScript realm and the bridge connecting the two. If not, this topic is discussed in detail in the previous post.","markups":[{"type":3,"start":226,"end":239,"href":"https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440","title":"","rel":"","anchorType":0},{"type":2,"start":107,"end":119},{"type":2,"start":125,"end":141},{"type":2,"start":150,"end":156}]},{"name":"7610","type":1,"text":"Let’s also remember the main conclusion from the previous post that will guide our performance-oriented discussion:","markups":[]},{"name":"2be1","type":7,"text":"In order to architect performant React Native apps, we must keep passes over the bridge to a minimum.","markups":[]},{"name":"1e11","type":1,"text":"So.. Time to jump into our new interesting use-case which, as it turns out, is not trivial to implement with React Native in a performant manner.","markups":[]},{"name":"5e4a","type":13,"text":"A new real life example","markups":[]},{"name":"7a52","type":1,"text":"Our use-case is inspired by the home screen of the Wix.com app. The screen holds a feed of cards and contains a large header image welcoming the user to the app. This is what the UX looks like:","markups":[{"type":3,"start":51,"end":62,"href":"https://itunes.apple.com/il/app/wix.com/id1099748482?mt=8","title":"","rel":"","anchorType":0}]},{"name":"fad7","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*JEzdDNvJjNOy-mSvFM1-ig.gif","originalWidth":248,"originalHeight":440}},{"name":"eb8b","type":1,"text":"Notice two interesting effects. The first — as the user is scrolling down the list of cards, the header image dissolves slowly into the gray background. The second — if the user scrolls up and is already at the top of the list, for the sake of continuity of movement the header image zooms slightly until it bounces back (this is called an overscroll effect).","markups":[{"type":2,"start":340,"end":357}]},{"name":"de51","type":1,"text":"Effects like these may seem minor, but are part of the last mile that makes a magical user experience and separates the mediocre apps from the great ones. We’ll have to be careful with the implementation though. If it doesn’t run smoothly at 60 FPS, the effect might backfire and degrade user immersion instead of enhancing it.","markups":[{"type":2,"start":55,"end":64}]},{"name":"86c9","type":1,"text":"The general component layout of the screen is very simple:","markups":[]},{"name":"a194","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"6bda26a7631d7ee37c7433583f180ea2","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd"}},{"name":"323c","type":1,"text":"Notice that the header image is not part of the ListView because it remains static and doesn’t scroll with the list content. Also notice we are still using the older ListView implementation instead of the recommended FlatList. This is due to some extra flexibility ListView provides that isn’t yet available in FlatList.","markups":[{"type":3,"start":166,"end":174,"href":"https://facebook.github.io/react-native/docs/listview.html","title":"","rel":"","anchorType":0},{"type":3,"start":217,"end":225,"href":"https://facebook.github.io/react-native/docs/flatlist.html","title":"","rel":"","anchorType":0},{"type":3,"start":253,"end":264,"href":"https://facebook.github.io/react-native/docs/listview.html#renderscrollcomponent","title":"","rel":"","anchorType":0}]},{"name":"5375","type":13,"text":"Our first implementation — onScroll events in JavaScript","markups":[]},{"name":"5ea2","type":1,"text":"As usual, we’ll start with the straightforward approach. If we want the effects to be tied to scroll position, we can listen on scroll events. Every time the scroll position changes, our event listener will fire and we’ll be able to re-render the header image and apply the appropriate effect.","markups":[]},{"name":"b100","type":1,"text":"The setup is somewhat tricky because ListView doesn’t expose the internal ScrollView used to scroll the content. It works by allowing us to provide our own custom ScrollView using the renderScrollComponent prop.","markups":[{"type":10,"start":184,"end":205},{"type":3,"start":37,"end":45,"href":"https://facebook.github.io/react-native/docs/listview.html","title":"","rel":"","anchorType":0},{"type":3,"start":74,"end":84,"href":"https://facebook.github.io/react-native/docs/scrollview.html","title":"","rel":"","anchorType":0},{"type":3,"start":184,"end":205,"href":"https://facebook.github.io/react-native/docs/listview.html#renderscrollcomponent","title":"","rel":"","anchorType":0}]},{"name":"ab5f","type":1,"text":"Applying the effects to the header image is as simple as defining style properties. We’ll use opacity to control the dissolve effect and transform.scale to control the zoom effect. We’ll store the values for both in local component state and re-render by calling setState.","markups":[{"type":10,"start":94,"end":101},{"type":10,"start":137,"end":152},{"type":10,"start":263,"end":271},{"type":3,"start":94,"end":101,"href":"https://facebook.github.io/react-native/docs/view.html#style","title":"","rel":"","anchorType":0},{"type":3,"start":137,"end":152,"href":"http://facebook.github.io/react-native/releases/0.40/docs/transforms.html","title":"","rel":"","anchorType":0}]},{"name":"19e6","type":1,"text":"This is the complete implementation:","markups":[]},{"name":"270c","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"00aa2ad404b56d8d88eab0425334ca14","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd"}},{"name":"2e70","type":1,"text":"As you can see, on every onScroll event we decide which effect to apply based on scroll position (contentOffset). If the scroll position is positive (downwards scroll), opacity is decreased from 1.0 to 0.0. If the scroll position is negative (upwards overscroll), scale is increased from 1.0 to 1.4.","markups":[{"type":10,"start":25,"end":33},{"type":10,"start":98,"end":111},{"type":10,"start":195,"end":198},{"type":10,"start":202,"end":205},{"type":10,"start":288,"end":291},{"type":10,"start":295,"end":298}]},{"name":"6a5b","type":13,"text":"First attempt — performance analysis","markups":[]},{"name":"b92f","type":1,"text":"What performance should we expect from this implementation? The main performance bottleneck is probably the number of passes over the bridge.","markups":[]},{"name":"752e","type":1,"text":"Let’s count passes by analyzing what’s running in the JavaScript realm (purple on the left) and what’s running in the native realm (black on the right):","markups":[{"type":2,"start":54,"end":70},{"type":2,"start":118,"end":130}]},{"name":"e1a0","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*4a_A-hBMc3fMuHpSYqnLXQ.png","originalWidth":1410,"originalHeight":784}},{"name":"3aee","type":1,"text":"Just like any other view event, scroll events originate in the native realm. Our JavaScript logic runs in the JavaScript realm. Once we re-render, the new view properties must be applied to the actual native views back in the native realm. This means we’re passing over the bridge twice for every frame.","markups":[{"type":2,"start":63,"end":77},{"type":2,"start":110,"end":126},{"type":2,"start":226,"end":238}]},{"name":"bf90","type":1,"text":"On busy apps, this will prevent us from running at 60 FPS. Let’s improve.","markups":[]},{"name":"ae51","type":13,"text":"A second implementation attempt — native scroll listener","markups":[]},{"name":"526d","type":1,"text":"React Native is very flexible regarding which components are implemented in JavaScript and which components are implemented in pure native. A native component can contain a JavaScript component and a JavaScript component can contain a native one.","markups":[]},{"name":"5e98","type":1,"text":"Whenever we have a performance issue, we can usually pull this rabbit out of the hat. Porting one of our components to native can usually solve the problem. Let’s try to apply this principle here.","markups":[]},{"name":"722b","type":1,"text":"Our performance bottleneck stems from implementing our scroll listener in JavaScript. Since scroll events originate in the native realm, executing our onScroll logic in JavaScript will always incur overhead. Let’s move the onScroll logic to native.","markups":[{"type":10,"start":151,"end":159},{"type":10,"start":223,"end":231},{"type":2,"start":123,"end":135}]},{"name":"287a","type":1,"text":"The purpose of onScroll is to update view properties (opacity and scale). We can save this trip over the bridge as well by closing the entire loop in native. Instead of changing the opacity and scale of the header image directly, we can wrap the image with a native container component —conveniently named NativeWrapper— that will change its own properties. This will work because both opacity and scale of a container affect its children as well. This NativeWrapper component will contain the native implementation of our onScroll logic.","markups":[{"type":10,"start":15,"end":23},{"type":10,"start":306,"end":319},{"type":10,"start":453,"end":466},{"type":10,"start":523,"end":531}]},{"name":"8492","type":1,"text":"Our new layout:","markups":[]},{"name":"4338","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"9e50074ef53a6d7655ed7659d09ddc86","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd"}},{"name":"3c64","type":1,"text":"The only challenge so far is hooking our native scroll listener to the correct ScrollView. The ScrollView is part of the ListView and is neither a child or parent of our NativeWrapper. We need to be able to pinpoint it from within the native implementation in order to connect the listener. Every React component has a node handle — sometimes called a React tag. This is just a number that uniquely identifies this component instance. We can find this number using ReactNative.findNodeHandle and simply pass it as prop to NativeWrapper.","markups":[{"type":10,"start":170,"end":183},{"type":10,"start":465,"end":491},{"type":10,"start":522,"end":535},{"type":3,"start":465,"end":491,"href":"https://github.com/facebook/react/blob/72196da82915bee400edb1599d4223926aa2a8a0/src/renderers/native/findNodeHandle.js#L59","title":"","rel":"","anchorType":0},{"type":2,"start":319,"end":330},{"type":2,"start":352,"end":361}]},{"name":"ea58","type":1,"text":"Now that the JavaScript side is all set up, it’s time to get our hands dirty with some Objective-C.","markups":[]},{"name":"002b","type":1,"text":"Porting the onScroll logic itself to Objective-C is easy. The code actually looks almost exactly the same. Instead of calling setState to update the view properties, we can simply change the view properties directly since we’re running in the native realm.","markups":[{"type":10,"start":12,"end":20},{"type":10,"start":126,"end":134},{"type":2,"start":243,"end":255}]},{"name":"fe28","type":1,"text":"The only challenge here once again is hooking our native scroll listener. Once the numeric node handle of the ScrollView arrives via props, we need to translate it back to a view object reference in order to access the underlying ScrollView instance. This involves a little borrowed boilerplate that uses the UIManager to do the translation.","markups":[{"type":3,"start":274,"end":294,"href":"https://github.com/facebook/react-native/blob/da9a712a9e17942dcd05b8d955f0764c2026a4ad/React/Views/RCTWebViewManager.m#L56","title":"","rel":"","anchorType":0},{"type":3,"start":309,"end":318,"href":"https://github.com/facebook/react-native/blob/bc1ea548d0017f131c36a30ce06bf4d512cb2f8c/React/Modules/RCTUIManager.h","title":"","rel":"","anchorType":0},{"type":2,"start":91,"end":102}]},{"name":"a898","type":1,"text":"This is the Objective-C implementation:","markups":[]},{"name":"ce98","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"40814033809df0ca48b7e2e2497352d2","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd"}},{"name":"edc9","type":1,"text":"As you can see, the onScroll implementation is almost identical to the JavaScript one. If the scroll position is positive (downwards scroll), opacity is natively decreased from 1.0 to 0.0. If the scroll position is negative (upwards overscroll), scale is natively increased from 1.0 to 1.4.","markups":[{"type":10,"start":20,"end":28},{"type":10,"start":177,"end":180},{"type":10,"start":184,"end":187},{"type":10,"start":279,"end":282},{"type":10,"start":286,"end":289}]},{"name":"e7f2","type":13,"text":"Second attempt — performance analysis","markups":[]},{"name":"4a70","type":1,"text":"We expect performance to be much better since this implementation is tailored for reducing passes over the bridge.","markups":[]},{"name":"58d0","type":1,"text":"Let’s count passes by analyzing what’s running in the JavaScript realm (purple on the left) and what’s running in the native realm (black on the right):","markups":[{"type":2,"start":54,"end":70},{"type":2,"start":118,"end":130}]},{"name":"dfe3","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*TFOpiGcat_rSXVnxjcldqA.png","originalWidth":1404,"originalHeight":770}},{"name":"d6f6","type":1,"text":"It’s not surprising that we’ve indeed eliminated all the passes over the bridge after initialization. Both handling of the scroll events and updating of the view properties accordingly now take place in the native realm.","markups":[{"type":2,"start":207,"end":219}]},{"name":"7c31","type":1,"text":"We’re still not happy though. This implementation may be performant, but it’s rather complex and requires native expertise. Can we do the same from JavaScript?","markups":[]},{"name":"9895","type":13,"text":"Third time’s a charm — declarative API for the win","markups":[]},{"name":"678e","type":1,"text":"So, can we do the same from JavaScript? This is the million dollar question for React Native. For the framework to be truly useful, we must find ways to resolve these performance issues without resorting to native code.","markups":[]},{"name":"e4ea","type":1,"text":"This is one area where a lot of progress has been made since the previous post. The key to reducing passes over the bridge is declarative API. It allows us to declare behaviors in advance in JavaScript and serialize the entire declaration and send it once over the bridge during initialization. From this point on, a general purpose native driver — one that you don’t need to write yourself — will execute the behavior in the native realm according to the declared specification.","markups":[{"type":3,"start":65,"end":78,"href":"https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440","title":"","rel":"","anchorType":0},{"type":2,"start":126,"end":141},{"type":2,"start":333,"end":346},{"type":2,"start":426,"end":439}]},{"name":"0343","type":1,"text":"The behavior we want consists of two parts — listening to scroll position changes and updating view properties (opacity and scale). For the latter, we know that Animated, the excellent animation library that’s part of the core, provides good support.","markups":[{"type":3,"start":161,"end":169,"href":"https://facebook.github.io/react-native/docs/animated.html","title":"","rel":"","anchorType":0}]},{"name":"69ae","type":1,"text":"What is less known is that Animated can drive an Animated.Value based on scroll events as well.","markups":[{"type":10,"start":49,"end":63},{"type":3,"start":49,"end":63,"href":"https://facebook.github.io/react-native/docs/animated.html#animatedvalue","title":"","rel":"","anchorType":0},{"type":3,"start":73,"end":86,"href":"https://github.com/facebook/react-native/blob/c7387fefc85fd15dceadfa291857099ed3e848b8/Examples/UIExplorer/js/NativeAnimationsExample.js#L195","title":"","rel":"","anchorType":0}]},{"name":"e716","type":1,"text":"How does that work? Let’s jump into the complete implementation:","markups":[]},{"name":"a7d4","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"3f0a0789635821f2cd365446e444cb80","thumbnailUrl":"https://i.embed.ly/1/image?url=https%3A%2F%2Favatars0.githubusercontent.com%2Fu%2F6762255%3Fv%3D3%26s%3D400&key=4fce0568f2ce49e8b54624ef71a8a5bd"}},{"name":"3c6e","type":1,"text":"We’ve started by defining an Animated.Value that we’ll use to hold the scroll position at any given time. We’re providing our ListView with a custom ScrollView component — an Animated.ScrollView instead of a regular ScrollView. The Animated.ScrollView lets us declare that our Animated.Value is driven by the contentOffset property of the native onScroll event.","markups":[{"type":10,"start":29,"end":43},{"type":10,"start":175,"end":194},{"type":10,"start":232,"end":251},{"type":10,"start":277,"end":291},{"type":10,"start":309,"end":322},{"type":10,"start":346,"end":354}]},{"name":"0d6e","type":1,"text":"From this point forward, we can use the standard Animated approach of interpolating view properties based on an Animated.Value. This requires changing our header image to Animated.Image and allows us to interpolate both the opacity and transform.scale from scroll position.","markups":[{"type":10,"start":112,"end":126},{"type":10,"start":171,"end":185},{"type":10,"start":224,"end":231},{"type":10,"start":236,"end":251}]},{"name":"b9fa","type":1,"text":"Note that the entire implementation is declarative. We no longer have an imperative onScroll function that performs calculations for our effects.","markups":[{"type":10,"start":84,"end":92},{"type":2,"start":39,"end":50}]},{"name":"ee08","type":1,"text":"Also note that we’ve specified useNativeDriver. The implementation of the Animated library in recent versions of React Native finally contains a native driver that can execute the entire declaration from the native realm without using the bridge.","markups":[{"type":10,"start":31,"end":46},{"type":2,"start":145,"end":158},{"type":2,"start":208,"end":220}]},{"name":"f120","type":13,"text":"Third attempt — performance analysis","markups":[]},{"name":"4612","type":1,"text":"As usual, we’ll count passes by analyzing what’s running in the JavaScript realm (purple on the left) and what’s running in the native realm (black on the right):","markups":[{"type":2,"start":64,"end":80},{"type":2,"start":128,"end":140}]},{"name":"11d3","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*b338WkFCW3WDel08VxxApA.png","originalWidth":1402,"originalHeight":776}},{"name":"76c5","type":1,"text":"The only part running in the JavaScript realm is the initialization of our declaration. The entire declared behavior is serialized and sent over the bridge once in order to configure the general-purpose native driver of Animated.","markups":[{"type":2,"start":29,"end":45},{"type":2,"start":203,"end":216}]},{"name":"8497","type":1,"text":"After the driver has been configured, it takes care of the frame by frame for us in the native realm without additional passes over the bridge. This section has been grayed out since it’s no longer under the responsibility of our code.","markups":[{"type":2,"start":88,"end":100}]},{"name":"699b","type":13,"text":"Comparing the three implementations","markups":[]},{"name":"77c4","type":1,"text":"The full code of all three implementations is available on GitHub:","markups":[]},{"name":"7de0","type":14,"text":"wix/rn-perf-experiments2\nrn-perf-experiments2 - React Native performance experiments revisitedgithub.com","markups":[{"type":3,"start":0,"end":104,"href":"https://github.com/wix/rn-perf-experiments2","title":"https://github.com/wix/rn-perf-experiments2","rel":"","anchorType":0},{"type":1,"start":0,"end":24},{"type":2,"start":25,"end":94}],"mixtapeMetadata":{"mediaResourceId":"7eb0e17daebbcee381e71af5968c9819","thumbnailImageId":"0*rA8JfWZrQmRyoBOJ.","href":"https://github.com/wix/rn-perf-experiments2"}},{"name":"dd09","type":1,"text":"The demo project lets you choose which implementation to use so they can be compared side by side. Try to run it on a real device. Judging performance on a simulator is usually inaccurate.","markups":[]},{"name":"250d","type":1,"text":"Since it’s just a simple demo app, there is very little unrelated bridge activity. You will probably not notice any difference between implementations. To assist with this, the demo app provides a toggle to simulate stress conditions with plenty of activity. As you can see, turning it on will make the performance differences much more evident:","markups":[]},{"name":"16aa","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*v29H0OZ-GngqseBG-7jqEA.gif","originalWidth":270,"originalHeight":480}},{"name":"ef87","type":13,"text":"Summary","markups":[]},{"name":"05ae","type":1,"text":"Architecting performant React Native app is not always straightforward. You should normally start with the naive approach, but if you begin to notice performance issues with your app, always consider the number of passes over the bridge.","markups":[]},{"name":"58a9","type":1,"text":"As the framework matures, common tasks that are prone to high bridge traffic are addressed with declarative API that is designed to reduce passes over the bridge. The Animated library is a good example. Another interesting example is react-native-interactable which I’ve demonstrated in ReactConf 2017. To learn more about it, check out the post “Moving Beyond Animations to User Interactions at 60 FPS in React Native”.","markups":[{"type":3,"start":167,"end":175,"href":"https://facebook.github.io/react-native/docs/animated.html","title":"","rel":"","anchorType":0},{"type":3,"start":234,"end":259,"href":"https://github.com/wix/react-native-interactable","title":"","rel":"","anchorType":0},{"type":3,"start":287,"end":301,"href":"https://youtu.be/mjsv8NJnt5k","title":"","rel":"","anchorType":0},{"type":3,"start":347,"end":418,"href":"https://hackernoon.com/moving-beyond-animations-to-user-interactions-at-60-fps-in-react-native-b6b1fa0ba525","title":"","rel":"","anchorType":0}]},{"name":"611a","type":1,"text":"If you hit a wall and can’t find a declarative API that resolves your performance issue, you can always fall back on a native implementation. Bring a native developer or two into your team and port the problematic area to native like we did in the second implementation. It’s not always pretty, but it works.","markups":[]}],"sections":[{"name":"3f03","startIndex":0},{"name":"8aa3","startIndex":3}]},"postDisplay":{"coverless":true}},"virtuals":{"allowNotes":true,"previewImage":{"imageId":"1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg","filter":"","backgroundSize":"","originalWidth":2000,"originalHeight":339,"strategy":"resample","height":0,"width":0},"wordCount":2012,"imageCount":6,"readingTime":8.54245283018868,"subtitle":"I’m working on my performance talk for React Amsterdam 2017, which is based on the post “Performance Limitations of React Native and How to…","usersBySocialRecommends":[],"recommends":51,"socialRecommends":[],"isBookmarked":false,"tags":[{"slug":"react-native","name":"React Native","postCount":1452,"virtuals":{"isFollowing":false},"metadata":{"followerCount":3827,"postCount":1452,"coverImage":{"id":"1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg","originalWidth":2000,"originalHeight":339}},"type":"Tag"},{"slug":"react","name":"React","postCount":6418,"virtuals":{"isFollowing":false},"metadata":{"followerCount":12937,"postCount":6418,"coverImage":{"id":"1*uF2-YU2quykHIs4tKXy7sw.png","originalWidth":3658,"originalHeight":942}},"type":"Tag"},{"slug":"mobile-app-development","name":"Mobile App Development","postCount":12268,"virtuals":{"isFollowing":false},"metadata":{"followerCount":7571,"postCount":12268,"coverImage":{"id":"1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg","originalWidth":2000,"originalHeight":339}},"type":"Tag"},{"slug":"mobile","name":"Mobile","postCount":21114,"virtuals":{"isFollowing":false},"metadata":{"followerCount":136616,"postCount":21114,"coverImage":{"id":"1*b9Q1ffCZBKb4_fVlQfEtZQ.png","originalWidth":1148,"originalHeight":264}},"type":"Tag"},{"slug":"javascript","name":"JavaScript","postCount":29556,"virtuals":{"isFollowing":false},"metadata":{"followerCount":32184,"postCount":29556,"coverImage":{"id":"1*mR7_k1mHMlsfc01qz-ZPiQ.png","originalWidth":8844,"originalHeight":4235}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":2,"links":{"entries":[{"url":"https://youtu.be/mjsv8NJnt5k","alts":[{"type":2,"url":"vnd.youtube://www.youtube.com/watch?v=mjsv8NJnt5k&feature=applinks"},{"type":3,"url":"vnd.youtube://www.youtube.com/watch?v=mjsv8NJnt5k&feature=applinks"}]},{"url":"https://medium.com/@talkol/performance-limitations-of-react-native-and-how-to-overcome-them-947630d7f440","alts":[{"type":2,"url":"medium://p/947630d7f440"},{"type":3,"url":"medium://p/947630d7f440"}]},{"url":"https://hackernoon.com/moving-beyond-animations-to-user-interactions-at-60-fps-in-react-native-b6b1fa0ba525","alts":[{"type":2,"url":"medium://p/b6b1fa0ba525"},{"type":3,"url":"medium://p/b6b1fa0ba525"}]}],"version":"0.3","generatedAt":1492291499945},"isLockedPreviewOnly":false,"takeoverId":"","metaDescription":"","totalClapCount":0},"coverless":true,"slug":"react-native-performance-an-updated-example","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"react-native-performance-an-updated-example-6516bfde9c5c","previewContent":{"bodyModel":{"paragraphs":[{"name":"482b","type":3,"text":"React Native Performance — An Updated Example","markups":[],"alignment":1},{"name":"a3d5","type":4,"text":"","markups":[],"layout":10,"metadata":{"id":"1*b6h_7LQ9Fhsp__sRCAzFgg.jpeg","originalWidth":2000,"originalHeight":339}},{"name":"67ab","type":1,"text":"I’m working on my performance talk for React Amsterdam 2017, which is based on…","markups":[{"type":3,"start":39,"end":59,"href":"https://react.amsterdam/","title":"","rel":"","anchorType":0}],"alignment":1}],"sections":[{"startIndex":0}]},"isFullContent":false},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/@talkol/react-native-performance-an-updated-example-6516bfde9c5c","approvedHomeCollectionId":"","newsletterId":"","webCanonicalUrl":"https://medium.com/@talkol/react-native-performance-an-updated-example-6516bfde9c5c","mediumUrl":"https://medium.com/@talkol/react-native-performance-an-updated-example-6516bfde9c5c","migrationId":"","notifyFollowers":true,"notifyTwitter":false,"isSponsored":false,"isRequestToPubDisabled":false,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"type":"Post"},"mentionedUsers":[],"collaborators":[],"membershipPlans":[],"collectionUserRelations":[],"mode":null,"references":{"User":{"83a4f96844d0":{"userId":"83a4f96844d0","name":"Tal Kol","username":"talkol","createdAt":1465489677854,"lastPostCreatedAt":1492255667264,"imageId":"1*RvlrG_Pdhzb4RmV6aeHnrg.png","backgroundImageId":"","bio":"Full-stack developer. Co-founded two technology companies, the latter acquired by Wix.com.","twitterScreenName":"koltal","socialStats":{"userId":"83a4f96844d0","usersFollowedCount":22,"usersFollowedByCount":1456,"type":"SocialStats"},"social":{"userId":"lo_c78b086328cd","targetUserId":"83a4f96844d0","type":"Social"},"facebookAccountId":"","allowNotes":1,"mediumMemberAt":1492254985000,"type":"User"}},"Social":{"83a4f96844d0":{"userId":"lo_c78b086328cd","targetUserId":"83a4f96844d0","type":"Social"}},"SocialStats":{"83a4f96844d0":{"userId":"83a4f96844d0","usersFollowedCount":22,"usersFollowedByCount":1456,"type":"SocialStats"}}}})
// ]]></script></body></html>