<!DOCTYPE html><html xmlns:cc="http://creativecommons.org/ns#"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>War of the Machines: PVS-Studio vs. TensorFlow – Sergey Vasiliev – Medium</title><link rel="canonical" href="https://medium.com/@CPP_Coder/war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f"><meta name="title" content="War of the Machines: PVS-Studio vs. TensorFlow – Sergey Vasiliev – Medium"><meta name="referrer" content="unsafe-url"><meta name="description" content="“I’ll be back” ©. I think everybody knows this phrase. Although, today we aren’t going to talk about the return of the terminator, the topic of the article is similar in some way. We’ll discuss the…"><meta property="og:title" content="War of the Machines: PVS-Studio vs. TensorFlow – Sergey Vasiliev – Medium"><meta property="og:url" content="https://medium.com/@CPP_Coder/war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f"><meta property="og:image" content="https://cdn-images-1.medium.com/max/1200/0*y24BVsXdIggXnUwA.png"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="“I’ll be back” ©. I think everybody knows this phrase. Although, today we aren’t going to talk about the return of the terminator, the…"><meta name="twitter:description" content="“I’ll be back” ©. I think everybody knows this phrase. Although, today we aren’t going to talk about the return of the terminator, the…"><meta name="twitter:image:src" content="https://cdn-images-1.medium.com/max/1200/0*y24BVsXdIggXnUwA.png"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@CPP_Coder"><meta property="author" content="Sergey Vasiliev"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="https://medium.com/@CPP_Coder"><meta property="fb:smart_publish:robots" content="noauto"><meta name="robots" content="index, follow"><meta property="article:published_time" content="2017-04-11T13:05:05.186Z"><meta name="twitter:creator" content="@CPP_Coder"><meta name="twitter:site" content="@Medium"><meta property="og:site_name" content="Medium"><meta name="twitter:label1" value="Reading time"><meta name="twitter:data1" value="19 min read"><script type="application/ld+json">{"@context":"http://schema.org","@type":"NewsArticle","image":{"@type":"ImageObject","width":520,"height":287,"url":"https://cdn-images-1.medium.com/max/520/0*y24BVsXdIggXnUwA.png"},"datePublished":"2017-04-11T13:05:05.186Z","dateModified":"2017-04-11T13:06:45.794Z","headline":"War of the Machines: PVS-Studio vs. TensorFlow","name":"War of the Machines: PVS-Studio vs. TensorFlow","keywords":["TensorFlow","Cpp","Open Source","Development","Software"],"author":{"@type":"Person","name":"Sergey Vasiliev","url":"https://medium.com/@CPP_Coder"},"creator":["Sergey Vasiliev"],"mainEntityOfPage":"https://medium.com/@CPP_Coder/war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f"}</script><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium://p/d3d20fe0229f"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium://p/d3d20fe0229f"><meta property="al:android:url" content="medium://p/d3d20fe0229f"><meta property="al:web:url" content="https://medium.com/@CPP_Coder/war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f"><link rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml" /><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/d3d20fe0229f" /><meta name="theme-color" content="#000000"><link rel="stylesheet" href="https://cdn-static-1.medium.com/_/fp/css/main-base.g2e09PlZK_j3Lw2AgNmbfQ.css"><script>if (window.top !== window.self) window.top.location = window.self.location.href;var OB_startTime = new Date().getTime(); var OB_loadErrors = []; function _onerror(e) { OB_loadErrors.push(e) }; if (document.addEventListener) document.addEventListener("error", _onerror, true); else if (document.attachEvent) document.attachEvent("onerror", _onerror); function _asyncScript(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = u; f.parentNode.insertBefore(s, f);}function _asyncStyles(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("link"); s.rel = "stylesheet"; s.href = u; f.parentNode.insertBefore(s, f); return s}var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-24232453-2"]); _gaq.push(["_setDomainName", window.location.hostname]); _gaq.push(["_setAllowLinker", true]); _gaq.push(["_trackPageview"]);_asyncScript(("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js");(new Image()).src = "/_/stat?event=pixel.load&origin=" + encodeURIComponent(location.origin);</script><script>(function () {var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; document.write("<style>section.section-image--fullBleed.is-backgrounded {padding-top: " + Math.round(1.1 * height) + "px;}section.section-image--fullScreen.is-backgrounded, section.section-image--coverFade.is-backgrounded {min-height: " + height + "px; padding-top: " + Math.round(0.5 * height) + "px;}.u-sizeViewHeight100 {height: " + height + "px !important;}.u-sizeViewHeight110 {height: " + Math.round(1.1 * height) + "px !important;}.u-sizeViewHeightMin100 {min-height: " + height + "px !important;}.u-sizeViewHeightMax100 {max-height: " + height + "px !important;}section.section-image--coverFade {height: " + height + "px;}.section-aspectRatioViewportPlaceholder, .section-aspectRatioViewportCropPlaceholder {max-height: " + height + "px;}.section-aspectRatioViewportBottomSpacer, .section-aspectRatioViewportBottomPlaceholder {max-height: " + Math.round(0.5 * height) + "px;}.zoomable:before {top: " + (-1 * height) + "px; left: " + (-1 * width) + "px; padding: " + height + "px " + width + "px;}</style>");})()</script><!--[if lt IE 9]><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js"></script><![endif]--><link rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-medium.TAS6uQ-Y7kcKgi0xjcYHXw.ico" class="js-favicon"><link rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/152/152/1*W0nmth_X8nFKjn6BZ388UQ.png"><link rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/120/120/1*W0nmth_X8nFKjn6BZ388UQ.png"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/76/76/1*W0nmth_X8nFKjn6BZ388UQ.png"><link rel="apple-touch-icon" sizes="60x60" href="https://cdn-images-1.medium.com/fit/c/60/60/1*W0nmth_X8nFKjn6BZ388UQ.png"><link rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon.KjTfUJo7yJH_fCoUzzH3cg.svg" color="#171717"></head><body itemscope class=" postShowScreen is-noJs"><script>document.body.className = document.body.className.replace(/(^|\s)is-noJs(\s|$)/, "$1is-js$2")</script><div class="site-main" id="container"><div class="butterBar butterBar--error"></div><div class="surface"><div id="prerendered" class="screenContent"><canvas class="canvas-renderer"></canvas><div class="container u-maxWidth740 u-xs-margin0 notesPositionContainer js-notesPositionContainer"></div><div class="metabar u-clearfix js-metabar"><div class="metabar-inner u-marginAuto u-maxWidth1000 u-paddingLeft20 u-paddingRight20 js-metabarMiddle"><div class="metabar-block metabar-block--left u-floatLeft u-height65 u-xs-height56"><a href="https://medium.com/" class="siteNav-logo" data-log-event="home"><span class="svgIcon svgIcon--logoNew svgIcon--45px is-flushLeft"><svg class="svgIcon-use" width="45" height="45"  viewBox="-17 18 45 45" data-multipart="true"><path d="M11.525 28.078c-.472-.225-.858.002-.858.506v20.044l8.616 4.113c.948.46 1.717.14 1.717-.7v-19.3a.22.22 0 0 0-.124-.19l-9.35-4.46v-.01z"/><path d="M.333 43.696l9.83-15.247c.278-.43.89-.6 1.36-.38l9.364 4.47c.06.03.082.1.047.15L10.666 48.63.333 43.698v-.002z"/><path d="M-8.57 28.35c-.786-.375-1.053-.096-.592.62L.333 43.696l10.333 4.932L.356 32.635a.156.156 0 0 0-.06-.054l-8.866-4.23z"/><path d="M.333 52.033c0 .84-.643 1.22-1.43.844l-8.045-3.84c-.472-.224-.858-.82-.858-1.325V28.89c0-.672.515-.976 1.145-.675l9.133 4.36a.092.092 0 0 1 .055.084v19.37z"/></svg></span><span class="u-textScreenReader">Homepage</span></a></div><div class="metabar-block u-floatRight u-xs-absolute u-xs-textAlignRight u-xs-right0 u-xs-marginRight20 u-height65 u-xs-height56"><div class="buttonSet"><a class="button button--primary button--chromeless u-accentColor--buttonNormal is-inSiteNavBar u-lineHeight30 u-height32"  href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2F%40CPP_Coder%2Fwar-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f" data-action="sign-in-prompt" data-redirect="https://medium.com/@CPP_Coder/war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f" data-action-source="nav_signup">Sign in / Sign up</a></div></div></div></div><div class="metabar metabar--spacer js-metabarSpacer u-height65 u-xs-height56"></div><main role="main"><article class=" u-sizeViewHeightMin100 u-overflowHidden postArticle postArticle--full u-marginBottom40"  lang="en"><header class="container u-maxWidth740"><div class="postMetaHeader u-paddingBottom10 row"><div class="col u-size12of12 js-postMetaLockup"><div class="postMetaLockup postMetaLockup--authorWithBio u-flex js-postMetaLockup"><div class="u-flex0"><a class="link avatar u-baseColor--link"  href="https://medium.com/@CPP_Coder?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="b773450fce8a" data-action-type="hover" data-user-id="b773450fce8a" dir="auto"><img  src="https://cdn-images-1.medium.com/fit/c/60/60/0*tjWbXDbIHRTRpOvA.png" class="avatar-image avatar-image--small" alt="Go to the profile of Sergey Vasiliev"></a></div><div class="u-flex1 u-paddingLeft15 u-overflowHidden"><a class="link link link--darken link--darker u-baseColor--link"  href="https://medium.com/@CPP_Coder?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="b773450fce8a" data-action-type="hover" data-user-id="b773450fce8a" dir="auto">Sergey Vasiliev</a><span class="followState js-followState buttonSet-inner" data-user-id="b773450fce8a"><button class="button u-paddingLeft10 u-paddingRight10 u-height19 u-lineHeight13 u-verticalAlignMiddle u-fontSize12 u-uiTextMedium u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-marginLeft10 u-marginTopNegative2 u-xs-hide"  data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="post_header_lockup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary u-paddingLeft10 u-paddingRight10 u-height19 u-lineHeight13 u-verticalAlignMiddle u-fontSize12 u-uiTextMedium u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-marginLeft10 u-marginTopNegative2 u-xs-hide"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/b773450fce8a" data-action-source="post_header_lockup_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span><div class="postMetaInline u-noWrapWithEllipsis u-xs-normalWrap u-xs-lineClamp2">Developer of PVS-Studio static analyzer.</div><div class="postMetaInline js-testPostMetaInlineSupplemental"><time datetime="2017-04-11T13:05:05.186Z">Apr 11</time><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="19 min read"></span></div></div></div></div></div></header><div class="postArticle-content js-postField js-notesSource js-trackedPost"  data-post-id="d3d20fe0229f" data-source="post_page" data-tracking-context="postPage"><section name="a919" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="8b80" id="8b80" class="graf graf--h3 graf--leading graf--title">War of the Machines: PVS-Studio vs. TensorFlow</h1><figure name="2406" id="2406" class="graf graf--figure graf--layoutOutsetLeft graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 520px; max-height: 287px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 55.2%;"></div><img class="graf-image" data-image-id="0*y24BVsXdIggXnUwA.png" data-width="520" data-height="287" src="https://cdn-images-1.medium.com/max/600/0*y24BVsXdIggXnUwA.png"></div></figure><p name="f4a3" id="f4a3" class="graf graf--p graf--startsWithDoubleQuote graf-after--figure">“I’ll be back” ©. I think everybody knows this phrase. Although, today we aren’t going to talk about the return of the terminator, the topic of the article is similar in some way. We’ll discuss the analysis of the the machine learning library TensorFlow and will try to find out, if we can sleep peacefully or Skynet is already coming…</p><h3 name="8ab2" id="8ab2" class="graf graf--h3 graf-after--p">TensorFlow</h3><figure name="2da8" id="2da8" class="graf graf--figure graf--layoutOutsetLeft graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 480px; max-height: 270px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="0*J467PhQOyViajc3M.png" data-width="480" data-height="270" src="https://cdn-images-1.medium.com/max/600/0*J467PhQOyViajc3M.png"></div></figure><p name="1b69" id="1b69" class="graf graf--p graf-after--figure"><a href="https://www.tensorflow.org/" data-href="https://www.tensorflow.org/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">TensorFlow</a> is a machine learning library, developed by Google corporation and available as an open-source project since November, 9th, 2015 year. At the moment it is actively used in research work and in dozens of commercial products of Google, including Google Search, Gmail, YouTube, Photos, Translate, Assistant, etc. The source code is available at <a href="https://github.com/tensorflow/tensorflow" data-href="https://github.com/tensorflow/tensorflow" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">the repository on GitHub</a> and on the <a href="https://opensource.google.com/projects/tensorflow" data-href="https://opensource.google.com/projects/tensorflow" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Google Open Source</a> platform.</p><p name="f830" id="f830" class="graf graf--p graf-after--p">Why was this project chosen?</p><ul class="postList"><li name="f68b" id="f68b" class="graf graf--li graf-after--p">Google. If a project is developed by Google, Microsoft or any other famous developers, its analysis is a kind of a challenge for us. Besides that, a lot of people would be interested to see the mistakes made by developers from big name corporations.</li><li name="4400" id="4400" class="graf graf--li graf-after--li">Machine learning. Nowadays, this subject is gaining more and more popularity. For good reason, some of the results are truly impressive! I won’t bring the examples here, you may easily find them yourselves.</li><li name="2a89" id="2a89" class="graf graf--li graf-after--li">Statistics on GitHub. This is also quite an important criterion, because the more popular is the project, the better. TensorFlow is breaking all the possible and impossible records! It takes one of the top places among C++ projects, has more than 50 000 stars and over 20 000 forks! It’s amazing!</li></ul><p name="7b8a" id="7b8a" class="graf graf--p graf-after--li">Of course, we cannot miss a chance to check such a project. I don’t even know why my colleagues haven’t checked it yet. Well, it’s time to do this.</p><h3 name="be31" id="be31" class="graf graf--h3 graf-after--p">What was the tool of the analysis?</h3><p name="f5eb" id="f5eb" class="graf graf--p graf-after--h3">If you know what PVS-Studio is, then you know the answer. In case you are still not aware, please don’t rush reading on. For example, it could be interesting to know that we have a <a href="https://www.viva64.com/en/b/0362/" data-href="https://www.viva64.com/en/b/0362/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">C# analyzer for more than a year</a>, and a <a href="https://www.viva64.com/en/b/0441/" data-href="https://www.viva64.com/en/b/0441/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Linux version</a> for roughly half a year.</p><figure name="a114" id="a114" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 226px; max-height: 154px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 68.10000000000001%;"></div><img class="graf-image" data-image-id="0*NU2fxJIINiVK5lP7.png" data-width="226" data-height="154" src="https://cdn-images-1.medium.com/max/800/0*NU2fxJIINiVK5lP7.png"></div></figure><p name="d233" id="d233" class="graf graf--p graf-after--figure">Here is also the general information about the tool. The analysis was done using a static code analyzer <a href="https://www.viva64.com/en/pvs-studio/" data-href="https://www.viva64.com/en/pvs-studio/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">PVS-Studio</a> that finds bugs in programs written in C, C++ and C#. PVS-Studio works under Linux and Windows; currently it has more than 400 diagnostics, whose description you may find on <a href="https://www.viva64.com/en/w/" data-href="https://www.viva64.com/en/w/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">this page</a>.</p><p name="387e" id="387e" class="graf graf--p graf-after--p">Besides developing the static analyzer, we also check open source projects and write reports about the results. By this moment we have checked more than <a href="https://www.viva64.com/en/inspections/" data-href="https://www.viva64.com/en/inspections/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">280 projects</a>, where we found more than <a href="https://www.viva64.com/en/examples/" data-href="https://www.viva64.com/en/examples/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">10 800 errors</a>. These aren’t some small and insignificant projects, but quite well known ones: <a href="https://www.viva64.com/en/b/0442/" data-href="https://www.viva64.com/en/b/0442/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Chromium</a>, <a href="https://www.viva64.com/en/b/0446/" data-href="https://www.viva64.com/en/b/0446/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Clang</a>, <a href="https://www.viva64.com/en/b/0425/" data-href="https://www.viva64.com/en/b/0425/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">GCC</a>, <a href="https://www.viva64.com/en/b/0363/" data-href="https://www.viva64.com/en/b/0363/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Roslyn</a>, <a href="https://www.viva64.com/en/b/0377/" data-href="https://www.viva64.com/en/b/0377/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">FreeBSD</a>, <a href="https://www.viva64.com/en/b/0330/" data-href="https://www.viva64.com/en/b/0330/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Unreal Engine</a>, <a href="https://www.viva64.com/en/b/0431/" data-href="https://www.viva64.com/en/b/0431/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Mono</a> and others.</p><p name="7504" id="7504" class="graf graf--p graf-after--p">PVS-Studio is <a href="https://www.viva64.com/en/pvs-studio-download/" data-href="https://www.viva64.com/en/pvs-studio-download/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">available for download</a>, that’s why I suggest trying it on your project and checking out what it may find in your code.</p><p name="4948" id="4948" class="graf graf--p graf-after--p">By the way, PVS-Studio has its own tag on StackOverflow (<a href="https://stackoverflow.com/questions/tagged/pvs-studio" data-href="https://stackoverflow.com/questions/tagged/pvs-studio" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">link</a>). I recommend asking questions there, so that other developers could quickly find the necessary information without waiting for our reply by the e-mail. In our turn we are always glad to help our users.</p><h3 name="9e94" id="9e94" class="graf graf--h3 graf-after--p">The article format</h3><p name="3bad" id="3bad" class="graf graf--p graf-after--h3">This time I want to divert from a traditional flow of the analysis: Downloaded the project — checked — wrote about the found bugs. I also want to tell about some analyzer settings and the ways they can be useful. In particular I will show how to fight against false positives, how to benefit from disabling certain diagnostics and excluding particular files from the analysis. Of course, we will have a look at the errors that PVS-Studio managed to find in the source code TensorFlow.</p><h3 name="50ae" id="50ae" class="graf graf--h3 graf-after--p">Preparation for the analysis</h3><p name="895b" id="895b" class="graf graf--p graf-after--h3">Now that <a href="https://www.viva64.com/en/m/0036/" data-href="https://www.viva64.com/en/m/0036/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">PVS-Studio is also available under Linux</a>, we have a choice of how to perform the analysis: under Linux or Windows. Quite recently I checked one project under openSUSE, which was quite simple and convenient, but still I decided to check TensorFlow under Windows. It was more familiar for me. What’s more, it can be built using CMake which presupposes further work in the Visual Studio IDE, for which we have a special plugin (the latest version obtained code highlighting of erroneous fragments).</p><p name="dc08" id="dc08" class="graf graf--p graf-after--p">Officially, the built of TensorFlow under Windows is not supported (<a href="https://www.tensorflow.org/install/install_sources" data-href="https://www.tensorflow.org/install/install_sources" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">according to the website</a>). Nevertheless, there is also a link of how to build a project using CMake. I should say that it gets easily built according to <a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/cmake" data-href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/cmake" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">these instructions</a>.</p><p name="c99b" id="c99b" class="graf graf--p graf-after--p">As a result we get a set of <em class="markup--em markup--p-em">.vcxproj </em>files, combined as one <em class="markup--em markup--p-em">.sln, </em>which means that further on it will be comfortable to work with the project from Visual Studio, which is great. I worked from the Visual Studio 2017 IDE, whose support was added to the <a href="https://www.viva64.com/en/m/0010/" data-href="https://www.viva64.com/en/m/0010/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">PVS-Studio 6.14 release</a>.</p><p name="bd3d" id="bd3d" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Note. </strong>It’s a good idea to build a project before the analysis and make sure that it gets compiled and there are no errors. It is necessary to reassure that the analysis will be done efficiently and the analyzer will have all the syntactic and semantic information. There is now a note on the TensorFlow site: <em class="markup--em markup--p-em">By default, building TensorFlow from sources consumes a lot of RAM. </em>Well, it’s okay, because I have a 16 GB RAM on the machine. What do you think? During the build I had a <a href="https://msdn.microsoft.com/en-us/library/yz7kx3y2.aspx" data-href="https://msdn.microsoft.com/en-us/library/yz7kx3y2.aspx" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Fatal Error C1060</a> (compiler is out of heap space)! My machine ran our of memory! It was quite unexpected. No, I didn’t have five virtual machines running concurrently with the build. In all fairness it has to be added, that using <a href="https://bazel.build/" data-href="https://bazel.build/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">bazel</a> for build, you may limit the number of RAM used (the description is given in TensorFlow build instructions).</p><p name="6302" id="6302" class="graf graf--p graf-after--p">I couldn’t wait to press the sacred button “Analyze solution with PVS-Studio” and see those interesting bugs we found, but first it would be great to exclude those files from the analysis which aren’t much interesting: third-party libraries, for example. It can be easily done in the PVS-Studio settings: on the tab ‘Don’t Check Files’ we set masks of those files and paths, whose analysis is of no interest. The settings already have a certain set of paths (/boost/, for example). I have replenished it with two masks: /third_party/ and /external/. This allows not only excluding warnings from the output window, but also excluding the files of the directories from the analysis, which decreases the analysis time.</p><figure name="e5d2" id="e5d2" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 580px; max-height: 337px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 58.099999999999994%;"></div><img class="graf-image" data-image-id="0*oJsBtRFIm7Z6LEjj.png" data-width="580" data-height="337" src="https://cdn-images-1.medium.com/max/800/0*oJsBtRFIm7Z6LEjj.png"></div></figure><p name="808e" id="808e" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">Figure 1 — Set exception analysis in PVS-Studio preferences</em></p><p name="352e" id="352e" class="graf graf--p graf-after--p">Finally, we can run the analysis and see what was found.</p><p name="fae0" id="fae0" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Note. </strong>‘Don’t Check Files’ can be configured before and after the analysis. I have just described the first case, the second scenario allows filtering the obtained log, which is also useful and can save you from viewing unnecessary warnings. This will be described below.</p><h3 name="ebd4" id="ebd4" class="graf graf--h3 graf-after--p">False positives: arithmetic and fun</h3><h4 name="6424" id="6424" class="graf graf--h4 graf-after--h3">Why false positives are important (and frustrating)</h4><p name="fff7" id="fff7" class="graf graf--p graf-after--h4">False positives — a headache for everybody: for us, the developers of a static code analyzer and for the users because they clutter up useful output. A large number of false positives may repel people from using the tool. In addition, people usually judge the analyzer based on the criteria of the percentage of false positives. It is not that easy as it may seem, and this topic is for another article and discussion. My colleague has recently written <a href="https://www.viva64.com/en/b/0488/" data-href="https://www.viva64.com/en/b/0488/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">an article about this</a>, I recommend having a look at it.</p><h4 name="575c" id="575c" class="graf graf--h4 graf-after--p">How to fight against false positives?</h4><p name="d453" id="d453" class="graf graf--p graf-after--h4">Our task is to try getting rid of the false positives on the analysis stage, so that the users never see them. To do this, we add exceptions to the diagnostic rules, i.e. special cases, when the analyzer shouldn’t issue warnings at all. The number of these exceptions can vary greatly from the diagnostic to diagnostic: for some diagnostics we don’t have to write exceptions at all and sometimes we may have dozens of such exceptions implemented.</p><p name="dfb9" id="dfb9" class="graf graf--p graf-after--p">Nevertheless, we aren’t able to cover all the cases (sometimes they are too specific), that’s why our second task is to allow our user exclude the false positives from the analysis themselves. PVS-Studio provides several mechanisms for this: suppression by comments, configuration files and suppression bases. There is a <a href="https://www.viva64.com/en/m/0017/" data-href="https://www.viva64.com/en/m/0017/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">separate article</a> devoted to this, so I won’t go deep into details.</p><h3 name="28e9" id="28e9" class="graf graf--h3 graf-after--p">False positives and TensorFlow</h3><p name="7f66" id="7f66" class="graf graf--p graf-after--h3">Why have I started speaking about false positives in general? Firstly, because it is very important to fight against false positives, secondly, because of what I saw when I checked TensorFlow and filtered and output by the diagnostic rule <a href="https://www.viva64.com/en/w/v654/" data-href="https://www.viva64.com/en/w/v654/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">V654</a>.</p><figure name="c07a" id="c07a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 580px; max-height: 154px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 26.6%;"></div><img class="graf-image" data-image-id="0*UHHCLWwtECreV5Iy.png" data-width="580" data-height="154" src="https://cdn-images-1.medium.com/max/800/0*UHHCLWwtECreV5Iy.png"></div></figure><p name="fed2" id="fed2" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">Figure 2 — All the found warnings of V654 have the same pattern</em></p><p name="aa03" id="aa03" class="graf graf--p graf-after--p">64 warnings and all of them have the same pattern — the following code:</p><pre name="7a24" id="7a24" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">false &amp;&amp; expr</code></pre><p name="0e9b" id="0e9b" class="graf graf--p graf-after--pre">In the code itself, these fragments look like this:</p><pre name="58df" id="58df" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">DCHECK(v);<br>DCHECK(stream != nullptr);<br>DCHECK(result != nullptr);</code></pre><p name="c561" id="c561" class="graf graf--p graf-after--pre">Here is how the macro <em class="markup--em markup--p-em">DCHECK </em>is declared:</p><pre name="77b6" id="77b6" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">#<strong class="markup--strong markup--pre-strong">ifndef</strong> NDEBUG<br>....<br>#<strong class="markup--strong markup--pre-strong">define</strong> DCHECK(condition) CHECK(condition)<br>....<br>#<strong class="markup--strong markup--pre-strong">else</strong><br>....<br>#<strong class="markup--strong markup--pre-strong">define</strong> DCHECK(condition) \<br>  while (false &amp;&amp; (condition)) LOG(FATAL)<br>....<br>#<strong class="markup--strong markup--pre-strong">endif</strong></code></pre><p name="302c" id="302c" class="graf graf--p graf-after--pre">What follows from this code? <em class="markup--em markup--p-em">DCHECK</em> — is a debugging macro. In the debug version it is expanded to the check of the condition (<em class="markup--em markup--p-em">CHECK(condition)</em>), in the release version — to a loop that will never be executed — <em class="markup--em markup--p-em">while (false &amp;&amp; ….)</em>. Since I was building a release version of the code, the macro expanded correspondingly (to the <em class="markup--em markup--p-em">while</em> loop). As a result, the analyzer seems to complain correctly — because the result of the expression is always <em class="markup--em markup--p-em">false</em>. But what’s the point of these warnings, if they are issued for the code that was meant to be like this? So, the percentage of false positives for this diagnostic will be the same as on the diagram below.</p><figure name="a63b" id="a63b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 465px; max-height: 330px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 71%;"></div><img class="graf-image" data-image-id="0*G95XhW0_LMn1agTO.png" data-width="465" data-height="330" src="https://cdn-images-1.medium.com/max/800/0*G95XhW0_LMn1agTO.png"></div></figure><p name="120b" id="120b" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">Figure 3 — The ratio of good and false positives of diagnostics </em><a href="https://www.viva64.com/en/w/v654/" data-href="https://www.viva64.com/en/w/v654/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--p-em">V654</em></a></p><p name="eeca" id="eeca" class="graf graf--p graf-after--p">You may have thought that this was a joke? No, we are not kidding, there are 100% of false positives. This is exactly what I was talking about. I also said that there are various ways to fight against them. By pressing ‘Add selected messages to suppression base’ we can correct this to the opposite direction (the image is clickable).</p><figure name="d2b8" id="d2b8" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 580px; max-height: 154px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 26.6%;"></div><img class="graf-image" data-image-id="0*P-_fnhLEg3Q30pEY.png" data-width="580" data-height="154" src="https://cdn-images-1.medium.com/max/800/0*P-_fnhLEg3Q30pEY.png"></div></figure><p name="ac65" id="ac65" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">Figure 4 — Fighting against false positives</em></p><p name="2bee" id="2bee" class="graf graf--p graf-after--p">This is the way to suppress all current warnings by removing them from the output window. But it is not quite correct, because if you start using the <em class="markup--em markup--p-em">DCHECK</em> macro again when writing new code, you will get warnings again. There is a solution. We need to suppress the warning in the macro by leaving a special comment. Then the suppression code will be as follows:</p><pre name="d956" id="d956" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">//-V:DCHECK:654 <br>#<strong class="markup--strong markup--pre-strong">define</strong> DCHECK(condition) \<br>  while (false &amp;&amp; (condition)) LOG(FATAL)</code></pre><p name="f87b" id="f87b" class="graf graf--p graf-after--pre">The comment should be written in the same header file, where the macro is declared.</p><p name="cfcd" id="cfcd" class="graf graf--p graf-after--p">That’s it, we may forget about <em class="markup--em markup--p-em">DCHECK</em> macro, because the <a href="https://www.viva64.com/en/w/v654/" data-href="https://www.viva64.com/en/w/v654/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">V654</a> warning will not be issued for it anymore. As a result, we have successfully dealt with false positives. After these simple actions, the diagram of false positives for <a href="https://www.viva64.com/en/w/v654/" data-href="https://www.viva64.com/en/w/v654/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">V654</a> will be as follows.</p><figure name="a706" id="a706" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 465px; max-height: 330px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 71%;"></div><img class="graf-image" data-image-id="0*O7-aGk9KyH-NESuq.png" data-width="465" data-height="330" src="https://cdn-images-1.medium.com/max/800/0*O7-aGk9KyH-NESuq.png"></div></figure><p name="1724" id="1724" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">Figure 5 — We successfully eliminated false positives</em></p><p name="abba" id="abba" class="graf graf--p graf-after--p">We see a completely different picture, as the percentage of false positives is 0. Quite an amusing arithmetic. Why did I start talking about false positives in general? I just wanted to explain that false positives are inevitable. The general aim of the analyzer is to decrease their number on the phase of the analysis, but you’ll probably have to deal with them due to some peculiarities of the project. I hope I managed to convey that false alarms can be handled (and should be handled), and it is quite simple.</p><h3 name="631d" id="631d" class="graf graf--h3 graf-after--p">A couple more settings</h3><p name="5e1b" id="5e1b" class="graf graf--p graf-after--h3">Perhaps, you can’t wait to take a look at the bugs we found, but please, be patient and read about couple more settings that will make the life easier during the work with the analysis results.</p><h3 name="5a5a" id="5a5a" class="graf graf--h3 graf-after--p">Warnings in automatically generated files</h3><p name="ce2d" id="ce2d" class="graf graf--p graf-after--h3">During the analysis we checked not only the code, which was written manually by the programmers, but the automatically generated. It won’t be interesting for us to warning for such code, that’s why we will exclude them from the analysis. ‘Don’t check files’ settings are coming to aid here. Specifically for this project, I specified the following file names:</p><pre name="b414" id="b414" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">pywrap_*<br>*.pb.cc</code></pre><p name="c1fa" id="c1fa" class="graf graf--p graf-after--pre">This allowed hiding more than 100 warnings of general analysis (GA) of the medium certainty level.</p><h3 name="1880" id="1880" class="graf graf--h3 graf-after--p">Disabling specific diagnoses</h3><p name="45d0" id="45d0" class="graf graf--p graf-after--h3">One more analyzer setting that turned out to be very useful — disabling groups of diagnostic rules. Why can it be relevant? For example, there were about 70 warnings <a href="https://www.viva64.com/en/w/v730/" data-href="https://www.viva64.com/en/w/v730/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">V730</a> (not all the class members are initialized in the constructor). These warnings really need reviewing, because they might signal about hard-to-detect bugs. Nevertheless, it may not be clear to a person, who is not much familiar with the code, if the uninitialized member will lead to problems or there is another tricky way of it further initialization. For an article, these errors aren’t much interesting too. That’s why, the developers should really review them and we won’t focus on it here. Therefore, we have a goal — to disable a whole group of diagnostic rules. It can be easily done: in settings of the PVS-Studio plugin you should just uncheck the necessary diagnostic.</p><figure name="1cd5" id="1cd5" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 480px; max-height: 279px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 58.099999999999994%;"></div><img class="graf-image" data-image-id="0*HQl1znd0rTR1nSIR.png" data-width="480" data-height="279" src="https://cdn-images-1.medium.com/max/800/0*HQl1znd0rTR1nSIR.png"></div></figure><p name="9852" id="9852" class="graf graf--p graf-after--figure"><em class="markup--em markup--p-em">Figure 6 — Disabling irrelevant diagnoses</em></p><p name="532a" id="532a" class="graf graf--p graf-after--p">Disabling those diagnostic rules that are not relevant to your project, you simplify the further work with the output of the analyzer.</p><h3 name="196b" id="196b" class="graf graf--h3 graf-after--p">The analyzer warnings issued for the project</h3><p name="f621" id="f621" class="graf graf--p graf-after--h3">Well, now let’s move on to the most intriguing part — those code fragments that the analyzer found suspicious.</p><p name="575d" id="575d" class="graf graf--p graf-after--p">Usually, I like starting with a classic error, that is made both in C# and C++ projects — an error <em class="markup--em markup--p-em">a == a</em>, which gets detected by <a href="https://www.viva64.com/en/w/v501/" data-href="https://www.viva64.com/en/w/v501/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">V501</a> and <a href="https://www.viva64.com/en/w/v3001/" data-href="https://www.viva64.com/en/w/v3001/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">V3001</a> diagnostic rules. But there are no such errors here! In general, the bugs detected in this project… is quite peculiar… So, here we go.</p><pre name="2794" id="2794" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">void</strong> <strong class="markup--strong markup--pre-strong">ToGraphDef</strong>(<strong class="markup--strong markup--pre-strong">const</strong> Graph* g, GraphDef* gdef, <strong class="markup--strong markup--pre-strong">bool</strong> pretty) {<br>  ....<br>  gtl::InlinedVector&lt;<strong class="markup--strong markup--pre-strong">const</strong> Edge*, 4&gt; inputs;<br>  ....<br>  <strong class="markup--strong markup--pre-strong">for</strong> (<strong class="markup--strong markup--pre-strong">const</strong> Edge* e : inputs) {<br>    <strong class="markup--strong markup--pre-strong">const</strong> string srcname = NewName(e-&gt;src(), pretty);<br>    <strong class="markup--strong markup--pre-strong">if</strong> (e == nullptr) {<br>      ndef-&gt;add_input(&quot;unknown&quot;);<br>    } <strong class="markup--strong markup--pre-strong">else</strong> <strong class="markup--strong markup--pre-strong">if</strong> (!e-&gt;src()-&gt;IsOp()) {<br>    } <strong class="markup--strong markup--pre-strong">else</strong> <strong class="markup--strong markup--pre-strong">if</strong> (e-&gt;IsControlEdge()) {<br>      ndef-&gt;add_input(strings::StrCat(&quot;^&quot;, srcname));<br>    } <strong class="markup--strong markup--pre-strong">else</strong> <strong class="markup--strong markup--pre-strong">if</strong> (e-&gt;src_output() == 0) {<br>      ndef-&gt;add_input(srcname);<br>    } <strong class="markup--strong markup--pre-strong">else</strong> {<br>      ndef-&gt;add_input(strings::StrCat(srcname, &quot;:&quot;, <br>                                      e-&gt;src_output()));<br>    }<br>  }<br>  ....<br>}</code></pre><p name="53a3" id="53a3" class="graf graf--p graf-after--pre"><a href="https://github.com/tensorflow/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/core/common_runtime/function.cc" data-href="https://github.com/tensorflow/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/core/common_runtime/function.cc" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">A link to GitHub</a>.</p><blockquote name="e020" id="e020" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">PVS-Studio warning: </em></strong><a href="https://www.viva64.com/en/w/v595/" data-href="https://www.viva64.com/en/w/v595/" class="markup--anchor markup--blockquote-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">V595</em></a><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em"> </em></strong><em class="markup--em markup--blockquote-em">The ‘e’ pointer was utilized before it was verified against nullptr. Check lines: 1044, 1045. function.cc 1044</em></blockquote><p name="10c5" id="10c5" class="graf graf--p graf-after--blockquote">In the loop we see that certain vector elements get iterated and depending on the value of the elements, certain actions are performed. The check <em class="markup--em markup--p-em">e == nullptr </em>presupposes that the pointer can be null. The thing is that we see the dereference of this pointer during the call of the function <em class="markup--em markup--p-em">NewName: e-&gt;src()</em>. The result of such an operation is undefined behavior, which may lead, inter alia, to the program crash.</p><p name="7ff6" id="7ff6" class="graf graf--p graf-after--p">But the code of TensorFlow is not that simple. The filling of this vector <em class="markup--em markup--p-em">(inputs)</em> happens earlier and looks as follows:</p><pre name="b2c5" id="b2c5" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">for</strong> (<strong class="markup--strong markup--pre-strong">const</strong> Edge* e : n-&gt;in_edges()) {<br>  <strong class="markup--strong markup--pre-strong">if</strong> (e-&gt;IsControlEdge()) {<br>    inputs.push_back(e);<br>  } <strong class="markup--strong markup--pre-strong">else</strong> {<br>    <strong class="markup--strong markup--pre-strong">if</strong> (inputs[e-&gt;dst_input()] == nullptr) {<br>      inputs[e-&gt;dst_input()] = e;<br>    } <strong class="markup--strong markup--pre-strong">else</strong> {<br>      LOG(WARNING) &lt;&lt; &quot;Malformed graph node. multiple input edges: &quot;<br>                   &lt;&lt; n-&gt;DebugString();<br>    }<br>  }<br>}</code></pre><p name="0877" id="0877" class="graf graf--p graf-after--pre">Looking carefully at the code, you can understand that the null pointers will never be written to the inputs vector, because there will always be the null pointer dereference before adding the elements, besides that the check against <em class="markup--em markup--p-em">nullptr</em> is missing before the dereference of the pointer. Since the <em class="markup--em markup--p-em">inputs</em> vector won’t contain null pointers, it turns out that the statement <em class="markup--em markup--p-em">e == nullptr, </em>that we spoke about before, will always be <em class="markup--em markup--p-em">false.</em></p><p name="facf" id="facf" class="graf graf--p graf-after--p">Anyway, this code is really tricky and PVS-Studio found it really successfully. Let’s move on.</p><pre name="4896" id="4896" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">Status MasterSession::StartStep(<strong class="markup--strong markup--pre-strong">const</strong> BuildGraphOptions&amp; opts, <br>                                int64* count,<br>                                ReffedClientGraph** rcg, <br>                                <strong class="markup--strong markup--pre-strong">bool</strong> is_partial) {<br>  ....<br>  ReffedClientGraph* to_unref = nullptr;<br>  ....<br>  <strong class="markup--strong markup--pre-strong">if</strong> (to_unref) to_unref-&gt;Unref();<br>  ....<br>}</code></pre><p name="fd20" id="fd20" class="graf graf--p graf-after--pre"><a href="https://github.com/tensorflow/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/core/distributed_runtime/master_session.cc" data-href="https://github.com/tensorflow/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/core/distributed_runtime/master_session.cc" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">A link to GitGub</a>.</p><blockquote name="5709" id="5709" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">PVS-Studio warning: </em></strong><a href="https://www.viva64.com/en/w/v547/" data-href="https://www.viva64.com/en/w/v547/" class="markup--anchor markup--blockquote-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">V547</em></a><em class="markup--em markup--blockquote-em"> Expression ‘to_unref’ is always false. master_session.cc 1114</em></blockquote><p name="b73c" id="b73c" class="graf graf--p graf-after--blockquote">In the body of the method we see that a local variable <em class="markup--em markup--p-em">to_unref </em>is declared, being initialized by the <em class="markup--em markup--p-em">nullptr </em>value. Before the <em class="markup--em markup--p-em">if</em> statement, this pointer is not used in any way, its value doesn’t get changed. Thus, the body of the if statement won’t be executed, because the pointer remained null. Perhaps, this code was left after the refactoring. There is a chance that this pointer was to be used somewhere between the initialization and the check, but instead of it, the programmer used another one (mixed them up), but I didn’t find similar names. Looks suspicious.</p><p name="fd93" id="fd93" class="graf graf--p graf-after--p">Let’s go on.</p><pre name="9651" id="9651" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">struct</strong> LSTMBlockCellBprop ....<br>{<br>  ....<br>  <strong class="markup--strong markup--pre-strong">void</strong> <strong class="markup--strong markup--pre-strong">operator</strong>()(...., <strong class="markup--strong markup--pre-strong">bool</strong> use_peephole, ....) {<br>  ....<br>  <strong class="markup--strong markup--pre-strong">if</strong> (use_peephole) {<br>    cs_prev_grad.device(d) =<br>        cs_prev_grad +<br>        di * wci.reshape(p_shape).broadcast(p_broadcast_shape) +<br>        df * wcf.reshape(p_shape).broadcast(p_broadcast_shape);<br>  }</code></pre><pre name="7ece" id="7ece" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">  <strong class="markup--strong markup--pre-strong">if</strong> (use_peephole) {<br>    wci_grad.device(d) = <br>      (di * cs_prev).sum(Eigen::array&lt;<strong class="markup--strong markup--pre-strong">int</strong>, 1&gt;({0}));<br>    wcf_grad.device(d) = <br>      (df * cs_prev).sum(Eigen::array&lt;<strong class="markup--strong markup--pre-strong">int</strong>, 1&gt;({0}));<br>    wco_grad.device(d) = <br>      (do_ * cs).sum(Eigen::array&lt;<strong class="markup--strong markup--pre-strong">int</strong>, 1&gt;({0}));<br>  }<br>  ....<br>  }<br>};</code></pre><p name="7597" id="7597" class="graf graf--p graf-after--pre"><a href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/contrib/rnn/kernels/lstm_ops.h" data-href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/contrib/rnn/kernels/lstm_ops.h" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">A link to GitHub</a>.</p><blockquote name="535c" id="535c" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">PVS-Studio warning: </em></strong><a href="https://www.viva64.com/en/w/v581/" data-href="https://www.viva64.com/en/w/v581/" class="markup--anchor markup--blockquote-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">V581</em></a><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em"> </em></strong><em class="markup--em markup--blockquote-em">The conditional expressions of the ‘if’ operators situated alongside each other are identical. Check lines: 277, 284. lstm_ops.h 284</em></blockquote><p name="9bd3" id="9bd3" class="graf graf--p graf-after--blockquote">There are two conditional operators with an identical conditional statement, but between these statements, the expression (in this case the <em class="markup--em markup--p-em">use_peephole </em>parameter) doesn’t get changed. Sometimes it may indicate a serious enough error, when a wrong statement was used in one of the cases, but in this case, judging by the context, we can say that the conditional statements were just duplicated. I think it’s not a bug, but all the operations could be put in a single conditional statement.</p><p name="af6e" id="af6e" class="graf graf--p graf-after--p">One does not simply write an write and skip copy-paste errors.</p><pre name="70e2" id="70e2" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">struct</strong> CompressFlags {<br>  ....<br>  Format format;</code></pre><pre name="c75d" id="c75d" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">  ....<br>  <strong class="markup--strong markup--pre-strong">int</strong> quality = 95;</code></pre><pre name="7374" id="7374" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">  ....<br>  <strong class="markup--strong markup--pre-strong">bool</strong> progressive = false;</code></pre><pre name="c057" id="c057" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">  ....<br>  <strong class="markup--strong markup--pre-strong">bool</strong> optimize_jpeg_size = false;</code></pre><pre name="485b" id="485b" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">  ....<br>  <strong class="markup--strong markup--pre-strong">bool</strong> chroma_downsampling = true;</code></pre><pre name="7267" id="7267" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">  ....<br>  <strong class="markup--strong markup--pre-strong">int</strong> density_unit = 1;  <br>  <strong class="markup--strong markup--pre-strong">int</strong> x_density = 300;<br>  <strong class="markup--strong markup--pre-strong">int</strong> y_density = 300;</code></pre><pre name="3752" id="3752" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code">  ....<br>  StringPiece xmp_metadata;</code></pre><pre name="7d02" id="7d02" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">  ....<br>  <strong class="markup--strong markup--pre-strong">int</strong> stride = 0;<br>};</code></pre><pre name="e407" id="e407" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">class</strong> EncodeJpegOp : <strong class="markup--strong markup--pre-strong">public</strong> OpKernel {<br>  ....<br>  <strong class="markup--strong markup--pre-strong">explicit</strong> <strong class="markup--strong markup--pre-strong">EncodeJpegOp</strong>(OpKernelConstruction* context) :  <br>    <strong class="markup--strong markup--pre-strong">OpKernel</strong>(context) { <br>    ....<br>    OP_REQUIRES_OK(context, <br>      context-&gt;GetAttr(&quot;quality&quot;, &amp;flags_.quality));<br>    OP_REQUIRES(context, <br>      0 &lt;= flags_.quality &amp;&amp; flags_.quality &lt;= 100,<br>      errors::InvalidArgument(&quot;quality must be in [0,100], got &quot;,<br>      flags_.quality));<br>    OP_REQUIRES_OK(context,<br>      context-&gt;GetAttr(&quot;progressive&quot;, <br>                       &amp;flags_.progressive));<br>    OP_REQUIRES_OK(context, <br>      context-&gt;GetAttr(&quot;optimize_size&quot;, <br>                       &amp;flags_.optimize_jpeg_size));<br>    OP_REQUIRES_OK(context, <br>      context-&gt;GetAttr(&quot;chroma_downsampling&quot;,         // &lt;=<br>                       &amp;flags_.chroma_downsampling));<br>    OP_REQUIRES_OK(context, <br>      context-&gt;GetAttr(&quot;chroma_downsampling&quot;,         // &lt;=<br>                       &amp;flags_.chroma_downsampling));<br>    ....<br>  }<br>  ....  <br>  jpeg::CompressFlags flags_;<br>}</code></pre><p name="c88d" id="c88d" class="graf graf--p graf-after--pre"><a href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/kernels/encode_jpeg_op.cc" data-href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/kernels/encode_jpeg_op.cc" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">A link to GitHub</a>.</p><blockquote name="1285" id="1285" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">PVS-Studio warning: </em></strong><a href="https://www.viva64.com/en/w/v760/" data-href="https://www.viva64.com/en/w/v760/" class="markup--anchor markup--blockquote-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">V760</em></a><em class="markup--em markup--blockquote-em"> Two identical blocks of text were found. The second block begins from line 58. encode_jpeg_op.cc 56</em></blockquote><p name="3aa3" id="3aa3" class="graf graf--p graf-after--blockquote">As you can see in the code, the programmer checks the values of the flags, read from the field <em class="markup--em markup--p-em">flags_ </em>in the constructor of the <em class="markup--em markup--p-em">EncodeJpegOp </em>class via the macros <em class="markup--em markup--p-em">OP_REQUIRES_OK</em> and <em class="markup--em markup--p-em">OP_REQUIRES.</em> However, in the last lines of the given fragment, the value of the same flag is checked for the constructor. It looks very much like copy-paste: the code was copied, but not edited.</p><p name="d63c" id="d63c" class="graf graf--p graf-after--p">The most interesting (and the hardest part) is to understand if the copy-paste redundant or something else was meant to be here. If the code is redundant, then there is nothing horrible, but the situation is completely different, if another code fragment was meant here, because we get a logical error here.</p><p name="fbaf" id="fbaf" class="graf graf--p graf-after--p">Having reviewed the body of the constructor, I haven’t found the check of the <em class="markup--em markup--p-em">stride</em> field. Perhaps, in one of the cases, this very check was meant to be. On the other hand, the order of the fields in the constructor is similar with the order of field declaration in the structure <em class="markup--em markup--p-em">CompressFlags</em>. Thus, it’s hard to say how this code should be fixed, we can only make assumptions. In any case, this code is worth paying attention to.</p><p name="f9eb" id="f9eb" class="graf graf--p graf-after--p">The analyzer also found several suspicious fragments related to the bit shifting. Let’s have a look at them. I want to remind, that incorrect use of the shift operations leads to undefined behavior.</p><figure name="f407" id="f407" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 480px; max-height: 375px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 78.10000000000001%;"></div><img class="graf-image" data-image-id="0*hVem1cPjcIO4l90p.png" data-width="480" data-height="375" src="https://cdn-images-1.medium.com/max/800/0*hVem1cPjcIO4l90p.png"></div></figure><pre name="2e13" id="2e13" class="graf graf--pre graf-after--figure"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">class</strong> InferenceContext {<br>  ....<br>  <strong class="markup--strong markup--pre-strong">inline</strong> int64 <strong class="markup--strong markup--pre-strong">Value</strong>(DimensionOrConstant d) <strong class="markup--strong markup--pre-strong">const</strong> {<br>    <strong class="markup--strong markup--pre-strong">return</strong> d.dim.IsSet() ? d.dim-&gt;value_ : d.val;<br>  }<br>  ....<br>}<br>REGISTER_OP(&quot;UnpackPath&quot;)<br>    .Input(&quot;path: int32&quot;)<br>    .Input(&quot;path_values: float&quot;)<br>    .Output(&quot;unpacked_path: float&quot;)<br>    .SetShapeFn([](InferenceContext* c) {<br>      ....<br>      int64 num_nodes = InferenceContext::kUnknownDim;<br>      <strong class="markup--strong markup--pre-strong">if</strong> (c-&gt;ValueKnown(tree_depth)) {<br>        num_nodes = (1 &lt;&lt; c-&gt;Value(tree_depth)) - 1;    // &lt;=<br>      }<br>      ....<br>    })<br>....;</code></pre><p name="58e1" id="58e1" class="graf graf--p graf-after--pre"><a href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/contrib/tensor_forest/hybrid/core/ops/unpack_path_op.cc" data-href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/contrib/tensor_forest/hybrid/core/ops/unpack_path_op.cc" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">A link to GitHub</a>.</p><blockquote name="1b66" id="1b66" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">PVS-Studio warning: </em></strong><a href="https://www.viva64.com/en/w/v629/" data-href="https://www.viva64.com/en/w/v629/" class="markup--anchor markup--blockquote-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">V629</em></a><em class="markup--em markup--blockquote-em"> Consider inspecting the ‘1 &lt;&lt; c-&gt;Value(tree_depth)’ expression. Bit shifting of the 32-bit value with a subsequent expansion to the 64-bit type. unpack_path_op.cc 55</em></blockquote><p name="e2f4" id="e2f4" class="graf graf--p graf-after--blockquote">The strangeness of this code is in the fact that the 32 and 64 bit values are mixed in the shift and assignment operations. The literal <em class="markup--em markup--p-em">1</em> is a 32-bit value, for which a left-side shift is performed. The result of the shift still has a 32-bit type, but is written to the 64-bit variable. It is suspicious, because we may get undefined behavior if the value returned by the <em class="markup--em markup--p-em">Value</em> method is more than 32.</p><blockquote name="b0c9" id="b0c9" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">Here is a quote from the standard: </em></strong><em class="markup--em markup--blockquote-em">The value of E1 &lt;&lt; E2 is E1 left-shifted E2 bit positions; vacated bits are zero-filled. If E1 has an unsigned type, the value of the result is E1 * 2^E2, reduced modulo one more than the maximum value representable in the result type. </em><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">Otherwise, if E1 has a signed type and non-negative value, and E1*2^E2 is representable in the result type, then that is the resulting value; otherwise, the behavior is undefined</em></strong><em class="markup--em markup--blockquote-em">.</em></blockquote><p name="2f16" id="2f16" class="graf graf--p graf-after--blockquote">This code can be fixed by writing <em class="markup--em markup--p-em">1</em> as a 64-bit literal or doing the type extension via casting. More details on the shift operations can be found in the article “<a href="https://www.viva64.com/en/b/0142/" data-href="https://www.viva64.com/en/b/0142/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Wade not in unknown waters. Part three</a>”.</p><p name="50bd" id="50bd" class="graf graf--p graf-after--p">The extension through the casting was used in another fragment as well. Here is the code:</p><pre name="e0da" id="e0da" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">AlphaNum::AlphaNum(Hex hex) {<br>  ....<br>  uint64 value = hex.value;<br>  uint64 width = hex.spec;<br>  // We accomplish minimum width by OR&#39;ing in 0x10000 to the user&#39;s  <br>  // value,<br>  // where 0x10000 is the smallest hex number that is as wide as the <br>  // user<br>  // asked for.<br>  uint64 mask = ((<strong class="markup--strong markup--pre-strong">static_cast</strong>&lt;uint64&gt;(1) &lt;&lt; (width - 1) * 4)) | <br>                  value;<br>  ....<br>}</code></pre><p name="71e6" id="71e6" class="graf graf--p graf-after--pre"><a href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/lib/strings/strcat.cc" data-href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/lib/strings/strcat.cc" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">A link to GitHub</a>.</p><blockquote name="9433" id="9433" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">PVS-Studio warning: </em></strong><a href="https://www.viva64.com/en/w/v592/" data-href="https://www.viva64.com/en/w/v592/" class="markup--anchor markup--blockquote-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">V592</em></a><em class="markup--em markup--blockquote-em"> The expression was enclosed by parentheses twice: ((expression)). One pair of parentheses is unnecessary or misprint is present. strcat.cc 43</em></blockquote><p name="9f00" id="9f00" class="graf graf--p graf-after--blockquote">This code is actually correct, but the analyzer found it suspicious, having detected duplicate parentheses. The analyzer thinks in the following way: the double brackets do not affect the evaluation result, so perhaps one pair of brackets is placed not where it should be.</p><p name="cd99" id="cd99" class="graf graf--p graf-after--p">We cannot exclude that the brackets were probably meant to explicitly underline the precedence of evaluations and to avoid remembering the priorities of the operations ‘&lt;&lt;’ and ‘*’. They aren’t much necessary as they are in the wrong place anyway. I reckon that this evaluation order is correct (first we specify a shift value, and then do the shift itself), so we just have to put the brackets in the correct order, so that they do not confuse people.</p><pre name="2dfd" id="2dfd" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0">uint64 mask = (<strong class="markup--strong markup--pre-strong">static_cast</strong>&lt;uint64&gt;(1) &lt;&lt; ((width - 1) * 4)) | value;</code></pre><p name="397f" id="397f" class="graf graf--p graf-after--pre">Let’s go on.</p><pre name="0958" id="0958" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">void</strong> <strong class="markup--strong markup--pre-strong">Compute</strong>(OpKernelContext* context) override {<br>  ....<br>  int64 v = floor(in_x);<br>  ....<br>  v = ceil(in_x1);<br>  x_interp.end = ceil(in_x1);<br>  v = x_interp.end - 1;<br>  ....<br>}</code></pre><p name="6f21" id="6f21" class="graf graf--p graf-after--pre"><a href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/kernels/resize_area_op.cc" data-href="https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/kernels/resize_area_op.cc" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">A link to GitHub</a>.</p><blockquote name="79a2" id="79a2" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">PVS-Studio warning: </em></strong><a href="https://www.viva64.com/en/w/v519/" data-href="https://www.viva64.com/en/w/v519/" class="markup--anchor markup--blockquote-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">V519</em></a><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em"> </em></strong><em class="markup--em markup--blockquote-em">The ‘v’ variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 172, 174. resize_area_op.cc 174</em></blockquote><p name="36c1" id="36c1" class="graf graf--p graf-after--blockquote">The <em class="markup--em markup--p-em">v</em> variable is assigned twice, but between these assignments, the value of this variable is not used in any way. Moreover, the variable <em class="markup--em markup--p-em">x_interp.end </em>is assigned with the same value of the variable that was written to the <em class="markup--em markup--p-em">v </em>variable. Even if we omit the fact that the call of the <em class="markup--em markup--p-em">ceil </em>function is redundant here, as it is not critical (although…), the code looks strange: either it is weirdly written or it contains a tricky error.</p><p name="2fcd" id="2fcd" class="graf graf--p graf-after--p">What’s next?</p><pre name="ec73" id="ec73" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">void</strong> <strong class="markup--strong markup--pre-strong">Compute</strong>(OpKernelContext* context) override {<br>  ....<br>  int64 sparse_input_start;                                    // &lt;=<br>  ....<br>  <strong class="markup--strong markup--pre-strong">if</strong> (sparse_input) {<br>    num_total_features += GetNumSparseFeatures(<br>      sparse_input_indices, *it, &amp;sparse_input_start);         // &lt;=<br>  }<br>  <strong class="markup--strong markup--pre-strong">if</strong> (num_total_features == 0) {<br>    LOG(WARNING) &lt;&lt; &quot;num total features is zero.&quot;;<br>    <strong class="markup--strong markup--pre-strong">break</strong>;<br>  }<br>  <strong class="markup--strong markup--pre-strong">if</strong> (rand_feature &lt; input_spec_.dense_features_size()) {<br>    ....<br>  } <strong class="markup--strong markup--pre-strong">else</strong> {<br>    ....<br>    <strong class="markup--strong markup--pre-strong">const</strong> int32 sparse_index = sparse_input_start +            // &lt;=<br>      rand_feature - input_spec_.dense_features_size();<br>    ....<br>  }<br>  ....<br>}</code></pre><p name="4c80" id="4c80" class="graf graf--p graf-after--pre"><a href="https://github.com/tensorflow/tensorflow/blob/eae70b8ee31d87bdfd339aecf05100f0a1633961/tensorflow/contrib/tensor_forest/kernels/sample_inputs_op.cc" data-href="https://github.com/tensorflow/tensorflow/blob/eae70b8ee31d87bdfd339aecf05100f0a1633961/tensorflow/contrib/tensor_forest/kernels/sample_inputs_op.cc" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">A link to GitHub.</a></p><blockquote name="3cd9" id="3cd9" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">PVS-Studio warning: </em></strong><a href="https://www.viva64.com/en/w/v614/" data-href="https://www.viva64.com/en/w/v614/" class="markup--anchor markup--blockquote-anchor" rel="nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">V614</em></a><em class="markup--em markup--blockquote-em"> Potentially uninitialized variable ‘sparse_input_start’ used. sample_inputs_op.cc 351</em></blockquote><p name="762c" id="762c" class="graf graf--p graf-after--blockquote">The suspicious thing about this code is that during the initialization of the <em class="markup--em markup--p-em">sparse_index </em>constant, a potentially uninitialized variable <em class="markup--em markup--p-em">sparse_input_start </em>can also be used. At the time of declaration, this variable is not initialized with any value, i.e. it contains some junk. Further on, in case the statement <em class="markup--em markup--p-em">sparse_input </em>is true, the address of the variable <em class="markup--em markup--p-em">sparse_input_start </em>is passed to the function <em class="markup--em markup--p-em">GetNumSparseFeatures</em>, where perhaps, the variable initialization takes place. Otherwise, if the body of this conditional operator isn’t executed, <em class="markup--em markup--p-em">sparse_input_start </em>will remain uninitialized.</p><p name="3b70" id="3b70" class="graf graf--p graf-after--p">Of course, we can suppose that in case if <em class="markup--em markup--p-em">sparse_input_start </em>remains uninitialized, it won’t get used, but it’s too bold and unobvious, so better to set a standard value for the variable.</p><h3 name="1731" id="1731" class="graf graf--h3 graf-after--p">Is that all?</h3><p name="89ba" id="89ba" class="graf graf--p graf-after--h3">Well, yes and no. To be honest, I was hoping to find more defects and write an article in the style of the articles <a href="https://www.viva64.com/en/b/0251/" data-href="https://www.viva64.com/en/b/0251/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Qt</a>, <a href="https://www.viva64.com/en/b/0431/" data-href="https://www.viva64.com/en/b/0431/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Mono</a>, <a href="https://www.viva64.com/en/b/0249/" data-href="https://www.viva64.com/en/b/0249/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Unreal Engine 4</a> and similar to them, but it didn’t work. The project authors did a great job, there were not so many errors found. I was also hoping that the project would of a bigger size, but there were only 700 files checked in the chosen configuration, including the auto generated files.</p><p name="a514" id="a514" class="graf graf--p graf-after--p">Besides that, a lot of things were left outside the scope of this article, for example:</p><ul class="postList"><li name="203f" id="203f" class="graf graf--li graf-after--p">we reviewed only the warnings of the GA group;</li><li name="e2de" id="e2de" class="graf graf--li graf-after--li">we did not review the warnings of the 3 (Low) level of certainty;</li><li name="dff8" id="dff8" class="graf graf--li graf-after--li">the analyzer issued several dozens of <a href="https://www.viva64.com/en/w/v730/" data-href="https://www.viva64.com/en/w/v730/" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">V730</a> warnings, but it’s hard to judge about their criticality, so it’s up to developers to decide;</li><li name="5bc8" id="5bc8" class="graf graf--li graf-after--li">and many more.</li></ul><p name="96c2" id="96c2" class="graf graf--p graf-after--li">Nevertheless, there was quite a number of interesting fragments found, which we reviewed in this article.</p><h3 name="c35e" id="c35e" class="graf graf--h3 graf-after--p">Summing up</h3><p name="cf99" id="cf99" class="graf graf--p graf-after--h3">TensorFlow turned out to be quite an interesting and high-quality project in terms of code, but, as we saw, not without flaws. At the same time PVS-Studio proved once more that it is able to find errors even in the code of well-known developers.</p><p name="c284" id="c284" class="graf graf--p graf-after--p">In conclusion, I cannot but compliment all the developers of TensorFlow for the qualitative code and wish them the best of luck in the future.</p><figure name="5f02" id="5f02" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 379px; max-height: 195px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51.5%;"></div><img class="graf-image" data-image-id="0*3xMCDgMbf4aMCGNF.png" data-width="379" data-height="195" src="https://cdn-images-1.medium.com/max/800/0*3xMCDgMbf4aMCGNF.png"></div></figure><p name="8750" id="8750" class="graf graf--p graf-after--figure graf--trailing">Thank you for the attention to those who got to the end of the article and don’t forget to use <a href="https://www.viva64.com/en/pvs-studio/" data-href="https://www.viva64.com/en/pvs-studio/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">PVS-Studio</a>!</p></div></div></section></div><footer class="u-paddingTop10"><div class="container u-maxWidth740"><div class="row"><div class="col u-size12of12"></div></div><div class="row"><div class="col u-size12of12 js-postTags"><div class="u-paddingBottom10"><ul class="tags tags--postTags tags--borderless"><li><a class="link u-baseColor--link"  href="https://medium.com/tag/tensorflow?source=post" data-action-source="post">TensorFlow</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/cpp?source=post" data-action-source="post">Cpp</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/open-source?source=post" data-action-source="post">Open Source</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/development?source=post" data-action-source="post">Development</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/software?source=post" data-action-source="post">Software</a></li></ul></div></div></div><div class="row js-postActionsFooter"><div class="postActions col u-size12of12"><div class="u-floatLeft buttonSet buttonSet--withLabels"><div class="buttonSet-inner"><div class="js-actionRecommend" data-post-id="d3d20fe0229f" data-is-icon-29px="true" data-has-recommend-list="true" data-source="post_actions_footer"><button class="button button--primary button--large button--chromeless is-touchIconFadeInPulse u-accentColor--buttonNormal button--withIcon button--withSvgIcon u-accentColor--iconLight js-actionRecommendButton"  title="Recommend to share this article with your followers and let the author know you liked it" aria-label="Recommend to share this article with your followers and let the author know you liked it" data-action="sign-in-prompt" data-sign-in-action="upvote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/d3d20fe0229f" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--heart svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.215 23.716c-.348.288-.984.826-1.376 1.158a.526.526 0 0 1-.68 0c-.36-.307-.92-.78-1.22-1.03C9.22 20.734 3 15.527 3 10.734 3 7.02 5.916 4 9.5 4c1.948 0 3.77.898 5 2.434C15.73 4.898 17.552 4 19.5 4c3.584 0 6.5 3.02 6.5 6.734 0 4.9-6.125 9.96-9.785 12.982zM19.5 5.2c-1.774 0-3.423.923-4.41 2.468a.699.699 0 0 1-.59.323.706.706 0 0 1-.59-.32c-.988-1.54-2.637-2.47-4.41-2.47-2.922 0-5.3 2.49-5.3 5.54 0 4.23 6.19 9.41 9.517 12.19.217.18.566.48.783.66l.952-.79c3.496-2.88 9.348-7.72 9.348-12.05 0-3.05-2.378-5.53-5.3-5.53z"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--heartFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.5 4c-1.948 0-3.77.898-5 2.434C13.27 4.898 11.448 4 9.5 4 5.916 4 3 7.02 3 10.734c0 4.793 6.227 10 9.95 13.11.296.25.853.723 1.212 1.03.196.166.48.166.677 0 .39-.332 1.02-.87 1.37-1.158 3.66-3.022 9.79-8.08 9.79-12.982C26 7.02 23.08 4 19.5 4z" fill-rule="evenodd"/></svg></span></span></button><button class="button button--chromeless u-baseColor--buttonNormal"  data-action="show-recommends" data-action-value="d3d20fe0229f">15</button></div></div><div class="buttonSet-inner"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  data-action="scroll-to-responses" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"/></svg></span></button></div></div><div class="u-floatRight buttonSet buttonSet--narrow"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"/></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"/></svg></span></button></div></div></div></div><div class="js-postPromotionWrapper postPromotionWrapper" data-location-id="footer_above_post_attribution"></div><div class="container u-maxWidth740 js-postAttributionFooterContainer u-paddingTop20 u-paddingBottom20 u-marginTop10 u-borderTopLightest u-xs-paddingTop10 u-xs-paddingBottom10"><div class="row js-postFooterInfo"><div class="col u-size12of12"><li class="u-block u-paddingBottom18 js-cardUser"><div class="u-marginLeft20 u-floatRight"><span class="followState js-followState buttonSet-inner" data-user-id="b773450fce8a"><button class="button button--small u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton"  data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/b773450fce8a" data-action-source="footer_card_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="u-tableCell "><a class="link avatar u-baseColor--link"  href="https://medium.com/@CPP_Coder?source=footer_card" title="Go to the profile of Sergey Vasiliev" aria-label="Go to the profile of Sergey Vasiliev" data-action-source="footer_card" data-user-id="b773450fce8a" dir="auto"><img  src="https://cdn-images-1.medium.com/fit/c/60/60/0*tjWbXDbIHRTRpOvA.png" class="avatar-image avatar-image--small" alt="Go to the profile of Sergey Vasiliev"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal"  href="https://medium.com/@CPP_Coder" property="cc:attributionName" title="Go to the profile of Sergey Vasiliev" aria-label="Go to the profile of Sergey Vasiliev" rel="author cc:attributionUrl" data-user-id="b773450fce8a" dir="auto">Sergey Vasiliev</a></h3><p class="u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">Developer of PVS-Studio static analyzer.</p></div></li></div></div></div><div class="js-postFooterPlacements"></div><div class="u-padding0 u-clearfix u-backgroundGrayLightest u-print-hide supplementalPostContent js-responsesWrapper"></div><div class="supplementalPostContent js-readNext"></div><div class="supplementalPostContent js-heroPromo"></div></footer></article></main><div class="u-marginAuto u-maxWidth1000"><div class="js-postShareWidget u-foreground u-sm-hide u-transition--fadeOut300 u-fixed"><ul><li class="u-uiTextSemibold u-textAlignCenter u-textColorNormal u-fontSize12 u-textUppercase">Share</li><li class="u-textAlignCenter"><div class="js-actionRecommend" data-post-id="d3d20fe0229f" data-is-icon-29px="true" data-is-vertical="true" data-has-recommend-list="true" data-source="post_share_widget"><button class="button button--primary button--large button--chromeless is-touchIconFadeInPulse u-accentColor--buttonNormal button--withIcon button--withSvgIcon u-accentColor--iconLight js-actionRecommendButton"  title="Recommend to share this article with your followers and let the author know you liked it" aria-label="Recommend to share this article with your followers and let the author know you liked it" data-action="sign-in-prompt" data-sign-in-action="upvote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/d3d20fe0229f" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--heart svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.215 23.716c-.348.288-.984.826-1.376 1.158a.526.526 0 0 1-.68 0c-.36-.307-.92-.78-1.22-1.03C9.22 20.734 3 15.527 3 10.734 3 7.02 5.916 4 9.5 4c1.948 0 3.77.898 5 2.434C15.73 4.898 17.552 4 19.5 4c3.584 0 6.5 3.02 6.5 6.734 0 4.9-6.125 9.96-9.785 12.982zM19.5 5.2c-1.774 0-3.423.923-4.41 2.468a.699.699 0 0 1-.59.323.706.706 0 0 1-.59-.32c-.988-1.54-2.637-2.47-4.41-2.47-2.922 0-5.3 2.49-5.3 5.54 0 4.23 6.19 9.41 9.517 12.19.217.18.566.48.783.66l.952-.79c3.496-2.88 9.348-7.72 9.348-12.05 0-3.05-2.378-5.53-5.3-5.53z"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--heartFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.5 4c-1.948 0-3.77.898-5 2.434C13.27 4.898 11.448 4 9.5 4 5.916 4 3 7.02 3 10.734c0 4.793 6.227 10 9.95 13.11.296.25.853.723 1.212 1.03.196.166.48.166.677 0 .39-.332 1.02-.87 1.37-1.158 3.66-3.022 9.79-8.08 9.79-12.982C26 7.02 23.08 4 19.5 4z" fill-rule="evenodd"/></svg></span></span></button><button class="button button--chromeless u-baseColor--buttonNormal  u-block u-marginAuto u-marginTopNegative5"  data-action="show-recommends" data-action-value="d3d20fe0229f">15</button></div></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_share_widget"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"/></svg></span></button></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_share_widget"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"/></svg></span></button></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton"  title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-in-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/d3d20fe0229f"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"/></svg></span></span></button></li></ul></div></div><div class="u-fixed u-bottom0 u-sizeFullWidth u-backgroundWhite u-boxShadowTop u-borderBox u-paddingTop10 u-paddingBottom10 u-zIndexMetabar u-xs-paddingLeft10 u-xs-paddingRight10 js-stickyFooter"><div class="u-maxWidth700 u-marginAuto u-flexCenter"><div class="u-fontSize16 u-flex1 u-flexCenter"><div class="u-flex0 u-inlineBlock u-paddingRight20 u-xs-paddingRight10"><a class="link avatar u-inline u-baseColor--link"  href="https://medium.com/@CPP_Coder" data-action="show-user-card" data-action-value="b773450fce8a" data-action-type="hover" data-user-id="b773450fce8a" dir="auto"><img  src="https://cdn-images-1.medium.com/fit/c/40/40/0*tjWbXDbIHRTRpOvA.png" class="avatar-image avatar-image--smaller" alt="Go to the profile of Sergey Vasiliev"></a></div><div class="u-flex1 u-inlineBlock"><div class="u-xs-hide">Never miss a story from<strong> Sergey Vasiliev</strong>, when you sign up for Medium. <a class="link link--accent u-accentColor--textNormal u-accentColor--textDarken u-baseColor--link"  href="https://medium.com/@Medium/personalize-your-medium-experience-with-users-publications-tags-26a41ab1ee0c#.hx4zuv3mg" data-action-source="sticky_footer">Learn more</a></div><div class="u-xs-show">Never miss a story from<strong> Sergey Vasiliev</strong></div></div></div><div class="u-marginLeft50 u-xs-marginAuto"><span class="followState js-followState buttonSet-inner" data-user-id="b773450fce8a"><button class="button u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-uiTextSemibold u-textUppercase u-fontSize12"  data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="sticky_footer"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary is-active u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-uiTextSemibold u-textUppercase u-fontSize12"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/b773450fce8a" data-action-source="sticky_footer_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Get updates</span></button></span></div></div></div></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","buildLabel":"28586-6143d83","currentUser":{"userId":"lo_a6bc19c48183","isVerified":false,"subscriberEmail":""},"currentUserHasUnverifiedEmail":false,"isAuthenticated":false,"isCurrentUserVerified":false,"mediumTwitterScreenName":"medium","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.2nXtJ8XknWJqOjh2ZNHRVw.js","notes":"https://cdn-static-1.medium.com/_/fp/gen-js/main-notes.bundle.AouowiblLn4SBKZF6cWDtA.js","posters":"https://cdn-static-1.medium.com/_/fp/gen-js/main-posters.bundle.4rYp3nph7xNXmlmak5XWxQ.js","common-async":"https://cdn-static-1.medium.com/_/fp/gen-js/main-common-async.bundle.R35emyz9xZL7YdHbIl-SvQ.js","stats":"https://cdn-static-1.medium.com/_/fp/gen-js/main-stats.bundle.XUyD-cfC9DG2nc9iq5x7GA.js","home-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-home-screens.bundle.0oM8iNH9LgWeJY00O_ao2Q.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-misc-screens.bundle.caQfKUCZ18Wg2IbFBoaXiA.js"},"previewConfig":{"weightThreshold":1,"weightImageParagraph":0.51,"weightIframeParagraph":0.8,"weightTextParagraph":0.08,"weightEmptyParagraph":0,"weightP":0.003,"weightH":0.005,"weightBq":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15},"productName":"Medium","supportsEdit":false,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1492158809376:46dbee5467ef","useragent":{"browser":"python requests","family":"","os":"","version":2.2,"supportsDesktopEdit":false,"supportsInteract":false,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":false,"isTier1":false,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":false,"supportsVhUnits":false,"ruinsViewportSections":false,"supportsHtml5Video":false,"supportsMagicUnderlines":false,"isWebView":false,"isFacebookWebView":false,"supportsProgressiveMedia":false,"supportsPromotedPosts":true,"isBot":false,"isNativeIphone":false,"supportsCssVariables":false,"supportsScrollableMetabar":false},"variants":{"allow_access":true,"allow_signup":true,"allow_test_auth":"disallow","signin_services":"twitter,facebook,google,email,google-fastidv","signup_services":"twitter,facebook,google,email,google-fastidv","android_rating_prompt_recommend_threshold":5,"google_sign_in_android":true,"enable_onboarding":true,"ios_custom_miro_url":"https://cdn-images-1.medium.com","reengagement_notification_duration":3,"enable_adsnative_integration":true,"browsable_stream_config_bucket":"curated-topics","ios_small_post_preview_truncation_length":5.5,"ios_large_post_preview_truncation_length":5.5,"disable_ios_catalog_badging":true,"enable_series_creation":true,"enable_your_series_pages":true,"enable_productionized_series":true,"enable_dedicated_series_tab_api_ios":true,"enable_clap_milestone_notifications":true,"enable_series_stats_page":true,"should_receive_daily_push_notification":true,"should_receive_daily_push_notification_actual":true,"enable_prepublish_share_settings":true,"enable_direct_auth_connect":true,"enable_post_import":true,"enable_sponsored_post_labelling":true,"enable_logged_in_follow_on_collection_post":true,"promoted_story_placement_locations":"POST_PAGE_FOOTER","show_topics":true,"enable_search_collection_by_tag_recency_filter":true,"search_collection_by_tag_filter_min_votes":10,"enable_sms_app_promo":true,"enable_export_members":true,"enable_series_card_background_creation":true,"enable_loyal_writers_onboarding":true,"enable_onboarding_hybrid_users":true,"enable_ios_onboarding_notifications":true,"can_see_subscription_branding":true,"enable_subscriptions_landing_page":true,"enable_partner_program_landing_page":true,"enable_hide_broken_links":true,"enable_pay_for_custom_domain":true,"enable_promos_from_dynamo":true,"enable_promos_in_placement":true,"enable_series_promo_in_email":true,"enable_sms":true,"enable_series_in_user_profiles":true,"enable_new_logged_out_bento_operation":true,"enable_topic_brief_relations":true},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","teamName":"Team Medium","fp":{"/icons/favicon.svg":"https://cdn-static-1.medium.com/_/fp/icons/favicon.KjTfUJo7yJH_fCoUzzH3cg.svg","/icons/favicon-dev-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-dev-editor.YKKRxBO8EMvIqhyCwIiJeQ.ico","/icons/favicon-hatch-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-hatch-editor.BuEyHIqlyh2s_XEk4Rl32Q.ico","/icons/favicon-medium-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"394474ced050e3911ae2249ecc774921","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","useDynamicCss":false,"faviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium.TAS6uQ-Y7kcKgi0xjcYHXw.ico","faviconImageId":"1*W0nmth_X8nFKjn6BZ388UQ.png","fontSets":[{"id":1,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-base.by5Oi_VbnwEIvhnWIsuUjA.css"},{"id":4,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-lazy-base.g08Jj5TZPAiuPWj5YNUsSg.css"},{"id":6,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-latin-base.141WxxXgxGxNcfeza73H7Q.css"},{"id":7,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-lazy-latin-base.jMU532QDmysQMOINr-cr2A.css"}],"editorFaviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrlRev":"moc.muidem//:sptth","isDnt":false,"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","archiveUploadSizeMb":100,"paymentData":{"currencies":{"1":{"label":"US Dollar","external":"usd"}},"countries":{"1":{"label":"United States of America","external":"US"}},"accountTypes":{"1":{"label":"Individual","external":"individual"},"2":{"label":"Company","external":"company"}}},"previewConfig2":{"weightThreshold":1,"weightImageParagraph":0.05,"raiseImage":true,"enforceHeaderHierarchy":true,"isImageInsetRight":true},"isAmp":false,"iosScheme":"medium","isSwBoot":false,"lightstep":{"accessToken":"ce5be895bef60919541332990ac9fef2","carrier":"{\"ot-tracer-spanid\":\"1e9773317b483469\",\"ot-tracer-traceid\":\"238aefa55e168f7f\",\"ot-tracer-sampled\":\"true\"}","host":"collector-medium.lightstep.com"},"facebook":{"key":"542599432471018","secret":"c14df7146e9052a1131f3c900c1f0644","token":"542599432471018|1JqjIwxSfY9jOt_KwjWEl1R7T6I","namespace":"medium-com","scope":{"default":["public_profile","email","user_friends"],"connect":["public_profile","email","user_friends"],"login":["public_profile","email","user_friends"],"share":["public_profile","email","user_friends","publish_actions"]},"smartPublishWhitelistedPublications":["bcc38c8f6edf","f3726e2a5878","828a270689e","81c7d351c056","f30e42fd7ff8","8bf1d7d3081b","d16afa0ae7c","d8f3f6ad9c31","e74de0cedea9","15f753907972","c8c6a6b01ebd","3412b9729488","2ce4bbcf83bb","544c7006046e","7bfcdbc6b30a","a268fd916824","458a773bccd2"],"instantArticles":{"published":true,"developmentMode":false}},"mailingListArchiveUploadSizeMb":2,"availableMembershipPlans":[],"editorsPicksTopicId":"3985d2a191c5","popularOnMediumTopicId":"9d34e48ecf94","memberContentTopicId":"13d7efd82fb2","isDoNotAuth":false,"goldfinchUrl":"https://goldfinch.medium.com"}
// ]]></script><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.2nXtJ8XknWJqOjh2ZNHRVw.js" async></script><script>// <![CDATA[
window["obvInit"]({"value":{"id":"d3d20fe0229f","versionId":"739760d57ff2","creatorId":"b773450fce8a","creator":{"userId":"b773450fce8a","name":"Sergey Vasiliev","username":"CPP_Coder","createdAt":1429010593050,"lastPostCreatedAt":1491915524127,"imageId":"0*tjWbXDbIHRTRpOvA.png","backgroundImageId":"","bio":"Developer of PVS-Studio static analyzer.","twitterScreenName":"CPP_Coder","socialStats":{"userId":"b773450fce8a","usersFollowedCount":2,"usersFollowedByCount":150,"type":"SocialStats"},"social":{"userId":"lo_e2d1ded67d25","targetUserId":"b773450fce8a","type":"Social"},"facebookAccountId":"","allowNotes":1,"type":"User"},"homeCollectionId":"","title":"War of the Machines: PVS-Studio vs. TensorFlow","detectedLanguage":"en","latestVersion":"739760d57ff2","latestPublishedVersion":"739760d57ff2","hasUnpublishedEdits":false,"latestRev":321,"createdAt":1491915524127,"updatedAt":1491916005794,"acceptedAt":0,"firstPublishedAt":1491915905186,"latestPublishedAt":1491916005794,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"“I’ll be back” ©. I think everybody knows this phrase. Although, today we aren’t going to talk about the return of the terminator, the…","bodyModel":{"paragraphs":[{"name":"8b80","type":3,"text":"War of the Machines: PVS-Studio vs. TensorFlow","markups":[]},{"name":"2406","type":4,"text":"","markups":[],"layout":4,"metadata":{"id":"0*y24BVsXdIggXnUwA.png","originalWidth":520,"originalHeight":287}},{"name":"f4a3","type":1,"text":"“I’ll be back” ©. I think everybody knows this phrase. Although, today we aren’t going to talk about the return of the terminator, the topic of the article is similar in some way. We’ll discuss the analysis of the the machine learning library TensorFlow and will try to find out, if we can sleep peacefully or Skynet is already coming…","markups":[]},{"name":"8ab2","type":3,"text":"TensorFlow","markups":[]},{"name":"2da8","type":4,"text":"","markups":[],"layout":4,"metadata":{"id":"0*J467PhQOyViajc3M.png","originalWidth":480,"originalHeight":270}},{"name":"1b69","type":1,"text":"TensorFlow is a machine learning library, developed by Google corporation and available as an open-source project since November, 9th, 2015 year. At the moment it is actively used in research work and in dozens of commercial products of Google, including Google Search, Gmail, YouTube, Photos, Translate, Assistant, etc. The source code is available at the repository on GitHub and on the Google Open Source platform.","markups":[{"type":3,"start":0,"end":10,"href":"https://www.tensorflow.org/","title":"","rel":"","anchorType":0},{"type":3,"start":353,"end":377,"href":"https://github.com/tensorflow/tensorflow","title":"","rel":"","anchorType":0},{"type":3,"start":389,"end":407,"href":"https://opensource.google.com/projects/tensorflow","title":"","rel":"","anchorType":0}]},{"name":"f830","type":1,"text":"Why was this project chosen?","markups":[]},{"name":"f68b","type":9,"text":"Google. If a project is developed by Google, Microsoft or any other famous developers, its analysis is a kind of a challenge for us. Besides that, a lot of people would be interested to see the mistakes made by developers from big name corporations.","markups":[]},{"name":"4400","type":9,"text":"Machine learning. Nowadays, this subject is gaining more and more popularity. For good reason, some of the results are truly impressive! I won’t bring the examples here, you may easily find them yourselves.","markups":[]},{"name":"2a89","type":9,"text":"Statistics on GitHub. This is also quite an important criterion, because the more popular is the project, the better. TensorFlow is breaking all the possible and impossible records! It takes one of the top places among C++ projects, has more than 50 000 stars and over 20 000 forks! It’s amazing!","markups":[]},{"name":"7b8a","type":1,"text":"Of course, we cannot miss a chance to check such a project. I don’t even know why my colleagues haven’t checked it yet. Well, it’s time to do this.","markups":[]},{"name":"be31","type":3,"text":"What was the tool of the analysis?","markups":[]},{"name":"f5eb","type":1,"text":"If you know what PVS-Studio is, then you know the answer. In case you are still not aware, please don’t rush reading on. For example, it could be interesting to know that we have a C# analyzer for more than a year, and a Linux version for roughly half a year.","markups":[{"type":3,"start":181,"end":213,"href":"https://www.viva64.com/en/b/0362/","title":"","rel":"","anchorType":0},{"type":3,"start":221,"end":234,"href":"https://www.viva64.com/en/b/0441/","title":"","rel":"","anchorType":0}]},{"name":"a114","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*NU2fxJIINiVK5lP7.png","originalWidth":226,"originalHeight":154}},{"name":"d233","type":1,"text":"Here is also the general information about the tool. The analysis was done using a static code analyzer PVS-Studio that finds bugs in programs written in C, C++ and C#. PVS-Studio works under Linux and Windows; currently it has more than 400 diagnostics, whose description you may find on this page.","markups":[{"type":3,"start":104,"end":114,"href":"https://www.viva64.com/en/pvs-studio/","title":"","rel":"","anchorType":0},{"type":3,"start":289,"end":298,"href":"https://www.viva64.com/en/w/","title":"","rel":"","anchorType":0}]},{"name":"387e","type":1,"text":"Besides developing the static analyzer, we also check open source projects and write reports about the results. By this moment we have checked more than 280 projects, where we found more than 10 800 errors. These aren’t some small and insignificant projects, but quite well known ones: Chromium, Clang, GCC, Roslyn, FreeBSD, Unreal Engine, Mono and others.","markups":[{"type":3,"start":153,"end":165,"href":"https://www.viva64.com/en/inspections/","title":"","rel":"","anchorType":0},{"type":3,"start":192,"end":205,"href":"https://www.viva64.com/en/examples/","title":"","rel":"","anchorType":0},{"type":3,"start":286,"end":294,"href":"https://www.viva64.com/en/b/0442/","title":"","rel":"","anchorType":0},{"type":3,"start":296,"end":301,"href":"https://www.viva64.com/en/b/0446/","title":"","rel":"","anchorType":0},{"type":3,"start":303,"end":306,"href":"https://www.viva64.com/en/b/0425/","title":"","rel":"","anchorType":0},{"type":3,"start":308,"end":314,"href":"https://www.viva64.com/en/b/0363/","title":"","rel":"","anchorType":0},{"type":3,"start":316,"end":323,"href":"https://www.viva64.com/en/b/0377/","title":"","rel":"","anchorType":0},{"type":3,"start":325,"end":338,"href":"https://www.viva64.com/en/b/0330/","title":"","rel":"","anchorType":0},{"type":3,"start":340,"end":344,"href":"https://www.viva64.com/en/b/0431/","title":"","rel":"","anchorType":0}]},{"name":"7504","type":1,"text":"PVS-Studio is available for download, that’s why I suggest trying it on your project and checking out what it may find in your code.","markups":[{"type":3,"start":14,"end":36,"href":"https://www.viva64.com/en/pvs-studio-download/","title":"","rel":"","anchorType":0}]},{"name":"4948","type":1,"text":"By the way, PVS-Studio has its own tag on StackOverflow (link). I recommend asking questions there, so that other developers could quickly find the necessary information without waiting for our reply by the e-mail. In our turn we are always glad to help our users.","markups":[{"type":3,"start":57,"end":61,"href":"https://stackoverflow.com/questions/tagged/pvs-studio","title":"","rel":"","anchorType":0}]},{"name":"9e94","type":3,"text":"The article format","markups":[]},{"name":"3bad","type":1,"text":"This time I want to divert from a traditional flow of the analysis: Downloaded the project — checked — wrote about the found bugs. I also want to tell about some analyzer settings and the ways they can be useful. In particular I will show how to fight against false positives, how to benefit from disabling certain diagnostics and excluding particular files from the analysis. Of course, we will have a look at the errors that PVS-Studio managed to find in the source code TensorFlow.","markups":[]},{"name":"50ae","type":3,"text":"Preparation for the analysis","markups":[]},{"name":"895b","type":1,"text":"Now that PVS-Studio is also available under Linux, we have a choice of how to perform the analysis: under Linux or Windows. Quite recently I checked one project under openSUSE, which was quite simple and convenient, but still I decided to check TensorFlow under Windows. It was more familiar for me. What’s more, it can be built using CMake which presupposes further work in the Visual Studio IDE, for which we have a special plugin (the latest version obtained code highlighting of erroneous fragments).","markups":[{"type":3,"start":9,"end":49,"href":"https://www.viva64.com/en/m/0036/","title":"","rel":"","anchorType":0}]},{"name":"dc08","type":1,"text":"Officially, the built of TensorFlow under Windows is not supported (according to the website). Nevertheless, there is also a link of how to build a project using CMake. I should say that it gets easily built according to these instructions.","markups":[{"type":3,"start":68,"end":92,"href":"https://www.tensorflow.org/install/install_sources","title":"","rel":"","anchorType":0},{"type":3,"start":221,"end":239,"href":"https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/cmake","title":"","rel":"","anchorType":0}]},{"name":"c99b","type":1,"text":"As a result we get a set of .vcxproj files, combined as one .sln, which means that further on it will be comfortable to work with the project from Visual Studio, which is great. I worked from the Visual Studio 2017 IDE, whose support was added to the PVS-Studio 6.14 release.","markups":[{"type":3,"start":251,"end":274,"href":"https://www.viva64.com/en/m/0010/","title":"","rel":"","anchorType":0},{"type":2,"start":28,"end":37},{"type":2,"start":60,"end":66}]},{"name":"bd3d","type":1,"text":"Note. It’s a good idea to build a project before the analysis and make sure that it gets compiled and there are no errors. It is necessary to reassure that the analysis will be done efficiently and the analyzer will have all the syntactic and semantic information. There is now a note on the TensorFlow site: By default, building TensorFlow from sources consumes a lot of RAM. Well, it’s okay, because I have a 16 GB RAM on the machine. What do you think? During the build I had a Fatal Error C1060 (compiler is out of heap space)! My machine ran our of memory! It was quite unexpected. No, I didn’t have five virtual machines running concurrently with the build. In all fairness it has to be added, that using bazel for build, you may limit the number of RAM used (the description is given in TensorFlow build instructions).","markups":[{"type":3,"start":481,"end":498,"href":"https://msdn.microsoft.com/en-us/library/yz7kx3y2.aspx","title":"","rel":"","anchorType":0},{"type":3,"start":711,"end":716,"href":"https://bazel.build/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":6},{"type":2,"start":309,"end":377}]},{"name":"6302","type":1,"text":"I couldn’t wait to press the sacred button “Analyze solution with PVS-Studio” and see those interesting bugs we found, but first it would be great to exclude those files from the analysis which aren’t much interesting: third-party libraries, for example. It can be easily done in the PVS-Studio settings: on the tab ‘Don’t Check Files’ we set masks of those files and paths, whose analysis is of no interest. The settings already have a certain set of paths (/boost/, for example). I have replenished it with two masks: /third_party/ and /external/. This allows not only excluding warnings from the output window, but also excluding the files of the directories from the analysis, which decreases the analysis time.","markups":[]},{"name":"e5d2","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*oJsBtRFIm7Z6LEjj.png","originalWidth":580,"originalHeight":337}},{"name":"808e","type":1,"text":"Figure 1 — Set exception analysis in PVS-Studio preferences","markups":[{"type":2,"start":0,"end":59}]},{"name":"352e","type":1,"text":"Finally, we can run the analysis and see what was found.","markups":[]},{"name":"fae0","type":1,"text":"Note. ‘Don’t Check Files’ can be configured before and after the analysis. I have just described the first case, the second scenario allows filtering the obtained log, which is also useful and can save you from viewing unnecessary warnings. This will be described below.","markups":[{"type":1,"start":0,"end":6}]},{"name":"ebd4","type":3,"text":"False positives: arithmetic and fun","markups":[]},{"name":"6424","type":13,"text":"Why false positives are important (and frustrating)","markups":[]},{"name":"fff7","type":1,"text":"False positives — a headache for everybody: for us, the developers of a static code analyzer and for the users because they clutter up useful output. A large number of false positives may repel people from using the tool. In addition, people usually judge the analyzer based on the criteria of the percentage of false positives. It is not that easy as it may seem, and this topic is for another article and discussion. My colleague has recently written an article about this, I recommend having a look at it.","markups":[{"type":3,"start":453,"end":474,"href":"https://www.viva64.com/en/b/0488/","title":"","rel":"","anchorType":0}]},{"name":"575c","type":13,"text":"How to fight against false positives?","markups":[]},{"name":"d453","type":1,"text":"Our task is to try getting rid of the false positives on the analysis stage, so that the users never see them. To do this, we add exceptions to the diagnostic rules, i.e. special cases, when the analyzer shouldn’t issue warnings at all. The number of these exceptions can vary greatly from the diagnostic to diagnostic: for some diagnostics we don’t have to write exceptions at all and sometimes we may have dozens of such exceptions implemented.","markups":[]},{"name":"dfb9","type":1,"text":"Nevertheless, we aren’t able to cover all the cases (sometimes they are too specific), that’s why our second task is to allow our user exclude the false positives from the analysis themselves. PVS-Studio provides several mechanisms for this: suppression by comments, configuration files and suppression bases. There is a separate article devoted to this, so I won’t go deep into details.","markups":[{"type":3,"start":321,"end":337,"href":"https://www.viva64.com/en/m/0017/","title":"","rel":"","anchorType":0}]},{"name":"28e9","type":3,"text":"False positives and TensorFlow","markups":[]},{"name":"7f66","type":1,"text":"Why have I started speaking about false positives in general? Firstly, because it is very important to fight against false positives, secondly, because of what I saw when I checked TensorFlow and filtered and output by the diagnostic rule V654.","markups":[{"type":3,"start":239,"end":243,"href":"https://www.viva64.com/en/w/v654/","title":"","rel":"","anchorType":0}]},{"name":"c07a","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*UHHCLWwtECreV5Iy.png","originalWidth":580,"originalHeight":154}},{"name":"fed2","type":1,"text":"Figure 2 — All the found warnings of V654 have the same pattern","markups":[{"type":2,"start":0,"end":63}]},{"name":"aa03","type":1,"text":"64 warnings and all of them have the same pattern — the following code:","markups":[]},{"name":"7a24","type":8,"text":"false && expr","markups":[{"type":10,"start":0,"end":13}]},{"name":"0e9b","type":1,"text":"In the code itself, these fragments look like this:","markups":[]},{"name":"58df","type":8,"text":"DCHECK(v);\nDCHECK(stream != nullptr);\nDCHECK(result != nullptr);","markups":[{"type":10,"start":0,"end":64}]},{"name":"c561","type":1,"text":"Here is how the macro DCHECK is declared:","markups":[{"type":2,"start":22,"end":29}]},{"name":"77b6","type":8,"text":"#ifndef NDEBUG\n....\n#define DCHECK(condition) CHECK(condition)\n....\n#else\n....\n#define DCHECK(condition) \\\n  while (false && (condition)) LOG(FATAL)\n....\n#endif","markups":[{"type":10,"start":0,"end":160},{"type":1,"start":1,"end":7},{"type":1,"start":21,"end":27},{"type":1,"start":69,"end":73},{"type":1,"start":80,"end":86},{"type":1,"start":155,"end":160}]},{"name":"302c","type":1,"text":"What follows from this code? DCHECK — is a debugging macro. In the debug version it is expanded to the check of the condition (CHECK(condition)), in the release version — to a loop that will never be executed — while (false && ….). Since I was building a release version of the code, the macro expanded correspondingly (to the while loop). As a result, the analyzer seems to complain correctly — because the result of the expression is always false. But what’s the point of these warnings, if they are issued for the code that was meant to be like this? So, the percentage of false positives for this diagnostic will be the same as on the diagram below.","markups":[{"type":2,"start":29,"end":35},{"type":2,"start":127,"end":143},{"type":2,"start":211,"end":230},{"type":2,"start":327,"end":332},{"type":2,"start":443,"end":448}]},{"name":"a63b","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*G95XhW0_LMn1agTO.png","originalWidth":465,"originalHeight":330}},{"name":"120b","type":1,"text":"Figure 3 — The ratio of good and false positives of diagnostics V654","markups":[{"type":3,"start":64,"end":68,"href":"https://www.viva64.com/en/w/v654/","title":"","rel":"","anchorType":0},{"type":2,"start":0,"end":68}]},{"name":"eeca","type":1,"text":"You may have thought that this was a joke? No, we are not kidding, there are 100% of false positives. This is exactly what I was talking about. I also said that there are various ways to fight against them. By pressing ‘Add selected messages to suppression base’ we can correct this to the opposite direction (the image is clickable).","markups":[]},{"name":"d2b8","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*P-_fnhLEg3Q30pEY.png","originalWidth":580,"originalHeight":154}},{"name":"ac65","type":1,"text":"Figure 4 — Fighting against false positives","markups":[{"type":2,"start":0,"end":43}]},{"name":"2bee","type":1,"text":"This is the way to suppress all current warnings by removing them from the output window. But it is not quite correct, because if you start using the DCHECK macro again when writing new code, you will get warnings again. There is a solution. We need to suppress the warning in the macro by leaving a special comment. Then the suppression code will be as follows:","markups":[{"type":2,"start":150,"end":156}]},{"name":"d956","type":8,"text":"//-V:DCHECK:654 \n#define DCHECK(condition) \\\n  while (false && (condition)) LOG(FATAL)","markups":[{"type":10,"start":0,"end":86},{"type":1,"start":18,"end":24}]},{"name":"f87b","type":1,"text":"The comment should be written in the same header file, where the macro is declared.","markups":[]},{"name":"cfcd","type":1,"text":"That’s it, we may forget about DCHECK macro, because the V654 warning will not be issued for it anymore. As a result, we have successfully dealt with false positives. After these simple actions, the diagram of false positives for V654 will be as follows.","markups":[{"type":3,"start":57,"end":61,"href":"https://www.viva64.com/en/w/v654/","title":"","rel":"","anchorType":0},{"type":3,"start":230,"end":234,"href":"https://www.viva64.com/en/w/v654/","title":"","rel":"","anchorType":0},{"type":2,"start":31,"end":37}]},{"name":"a706","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*O7-aGk9KyH-NESuq.png","originalWidth":465,"originalHeight":330}},{"name":"1724","type":1,"text":"Figure 5 — We successfully eliminated false positives","markups":[{"type":2,"start":0,"end":53}]},{"name":"abba","type":1,"text":"We see a completely different picture, as the percentage of false positives is 0. Quite an amusing arithmetic. Why did I start talking about false positives in general? I just wanted to explain that false positives are inevitable. The general aim of the analyzer is to decrease their number on the phase of the analysis, but you’ll probably have to deal with them due to some peculiarities of the project. I hope I managed to convey that false alarms can be handled (and should be handled), and it is quite simple.","markups":[]},{"name":"631d","type":3,"text":"A couple more settings","markups":[]},{"name":"5e1b","type":1,"text":"Perhaps, you can’t wait to take a look at the bugs we found, but please, be patient and read about couple more settings that will make the life easier during the work with the analysis results.","markups":[]},{"name":"5a5a","type":3,"text":"Warnings in automatically generated files","markups":[]},{"name":"ce2d","type":1,"text":"During the analysis we checked not only the code, which was written manually by the programmers, but the automatically generated. It won’t be interesting for us to warning for such code, that’s why we will exclude them from the analysis. ‘Don’t check files’ settings are coming to aid here. Specifically for this project, I specified the following file names:","markups":[]},{"name":"b414","type":8,"text":"pywrap_*\n*.pb.cc","markups":[{"type":10,"start":0,"end":16}]},{"name":"c1fa","type":1,"text":"This allowed hiding more than 100 warnings of general analysis (GA) of the medium certainty level.","markups":[]},{"name":"1880","type":3,"text":"Disabling specific diagnoses","markups":[]},{"name":"45d0","type":1,"text":"One more analyzer setting that turned out to be very useful — disabling groups of diagnostic rules. Why can it be relevant? For example, there were about 70 warnings V730 (not all the class members are initialized in the constructor). These warnings really need reviewing, because they might signal about hard-to-detect bugs. Nevertheless, it may not be clear to a person, who is not much familiar with the code, if the uninitialized member will lead to problems or there is another tricky way of it further initialization. For an article, these errors aren’t much interesting too. That’s why, the developers should really review them and we won’t focus on it here. Therefore, we have a goal — to disable a whole group of diagnostic rules. It can be easily done: in settings of the PVS-Studio plugin you should just uncheck the necessary diagnostic.","markups":[{"type":3,"start":166,"end":170,"href":"https://www.viva64.com/en/w/v730/","title":"","rel":"","anchorType":0}]},{"name":"1cd5","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*HQl1znd0rTR1nSIR.png","originalWidth":480,"originalHeight":279}},{"name":"9852","type":1,"text":"Figure 6 — Disabling irrelevant diagnoses","markups":[{"type":2,"start":0,"end":41}]},{"name":"532a","type":1,"text":"Disabling those diagnostic rules that are not relevant to your project, you simplify the further work with the output of the analyzer.","markups":[]},{"name":"196b","type":3,"text":"The analyzer warnings issued for the project","markups":[]},{"name":"f621","type":1,"text":"Well, now let’s move on to the most intriguing part — those code fragments that the analyzer found suspicious.","markups":[]},{"name":"575d","type":1,"text":"Usually, I like starting with a classic error, that is made both in C# and C++ projects — an error a == a, which gets detected by V501 and V3001 diagnostic rules. But there are no such errors here! In general, the bugs detected in this project… is quite peculiar… So, here we go.","markups":[{"type":3,"start":130,"end":134,"href":"https://www.viva64.com/en/w/v501/","title":"","rel":"","anchorType":0},{"type":3,"start":139,"end":144,"href":"https://www.viva64.com/en/w/v3001/","title":"","rel":"","anchorType":0},{"type":2,"start":99,"end":105}]},{"name":"2794","type":8,"text":"void ToGraphDef(const Graph* g, GraphDef* gdef, bool pretty) {\n  ....\n  gtl::InlinedVector\x3cconst Edge*, 4\x3e inputs;\n  ....\n  for (const Edge* e : inputs) {\n    const string srcname = NewName(e-\x3esrc(), pretty);\n    if (e == nullptr) {\n      ndef-\x3eadd_input(\"unknown\");\n    } else if (!e-\x3esrc()-\x3eIsOp()) {\n    } else if (e-\x3eIsControlEdge()) {\n      ndef-\x3eadd_input(strings::StrCat(\"^\", srcname));\n    } else if (e-\x3esrc_output() == 0) {\n      ndef-\x3eadd_input(srcname);\n    } else {\n      ndef-\x3eadd_input(strings::StrCat(srcname, \":\", \n                                      e-\x3esrc_output()));\n    }\n  }\n  ....\n}","markups":[{"type":10,"start":0,"end":606},{"type":1,"start":0,"end":4},{"type":1,"start":5,"end":15},{"type":1,"start":16,"end":21},{"type":1,"start":48,"end":52},{"type":1,"start":91,"end":96},{"type":1,"start":124,"end":127},{"type":1,"start":129,"end":134},{"type":1,"start":159,"end":164},{"type":1,"start":213,"end":215},{"type":1,"start":273,"end":277},{"type":1,"start":278,"end":280},{"type":1,"start":309,"end":313},{"type":1,"start":314,"end":316},{"type":1,"start":400,"end":404},{"type":1,"start":405,"end":407},{"type":1,"start":471,"end":475}]},{"name":"53a3","type":1,"text":"A link to GitHub.","markups":[{"type":3,"start":0,"end":16,"href":"https://github.com/tensorflow/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/core/common_runtime/function.cc","title":"","rel":"","anchorType":0}]},{"name":"e020","type":6,"text":"PVS-Studio warning: V595 The ‘e’ pointer was utilized before it was verified against nullptr. Check lines: 1044, 1045. function.cc 1044","markups":[{"type":3,"start":20,"end":24,"href":"https://www.viva64.com/en/w/v595/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":20},{"type":1,"start":24,"end":25},{"type":2,"start":0,"end":135}]},{"name":"10c5","type":1,"text":"In the loop we see that certain vector elements get iterated and depending on the value of the elements, certain actions are performed. The check e == nullptr presupposes that the pointer can be null. The thing is that we see the dereference of this pointer during the call of the function NewName: e-\x3esrc(). The result of such an operation is undefined behavior, which may lead, inter alia, to the program crash.","markups":[{"type":2,"start":146,"end":159},{"type":2,"start":290,"end":307}]},{"name":"7ff6","type":1,"text":"But the code of TensorFlow is not that simple. The filling of this vector (inputs) happens earlier and looks as follows:","markups":[{"type":2,"start":74,"end":82}]},{"name":"b2c5","type":8,"text":"for (const Edge* e : n-\x3ein_edges()) {\n  if (e-\x3eIsControlEdge()) {\n    inputs.push_back(e);\n  } else {\n    if (inputs[e-\x3edst_input()] == nullptr) {\n      inputs[e-\x3edst_input()] = e;\n    } else {\n      LOG(WARNING) \x3c\x3c \"Malformed graph node. multiple input edges: \"\n                   \x3c\x3c n-\x3eDebugString();\n    }\n  }\n}","markups":[{"type":10,"start":0,"end":314},{"type":1,"start":0,"end":3},{"type":1,"start":5,"end":10},{"type":1,"start":40,"end":42},{"type":1,"start":95,"end":99},{"type":1,"start":106,"end":108},{"type":1,"start":187,"end":191}]},{"name":"0877","type":1,"text":"Looking carefully at the code, you can understand that the null pointers will never be written to the inputs vector, because there will always be the null pointer dereference before adding the elements, besides that the check against nullptr is missing before the dereference of the pointer. Since the inputs vector won’t contain null pointers, it turns out that the statement e == nullptr, that we spoke about before, will always be false.","markups":[{"type":2,"start":234,"end":241},{"type":2,"start":302,"end":308},{"type":2,"start":377,"end":391},{"type":2,"start":434,"end":440}]},{"name":"facf","type":1,"text":"Anyway, this code is really tricky and PVS-Studio found it really successfully. Let’s move on.","markups":[]},{"name":"4896","type":8,"text":"Status MasterSession::StartStep(const BuildGraphOptions& opts, \n                                int64* count,\n                                ReffedClientGraph** rcg, \n                                bool is_partial) {\n  ....\n  ReffedClientGraph* to_unref = nullptr;\n  ....\n  if (to_unref) to_unref-\x3eUnref();\n  ....\n}","markups":[{"type":10,"start":0,"end":317},{"type":1,"start":32,"end":37},{"type":1,"start":200,"end":204},{"type":1,"start":276,"end":278}]},{"name":"fd20","type":1,"text":"A link to GitGub.","markups":[{"type":3,"start":0,"end":16,"href":"https://github.com/tensorflow/tensorflow/blob/c7b80d51da4fb6d51ea54a0bdf2601afa379d60c/tensorflow/core/distributed_runtime/master_session.cc","title":"","rel":"","anchorType":0}]},{"name":"5709","type":6,"text":"PVS-Studio warning: V547 Expression ‘to_unref’ is always false. master_session.cc 1114","markups":[{"type":3,"start":20,"end":24,"href":"https://www.viva64.com/en/w/v547/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":20},{"type":2,"start":0,"end":86}]},{"name":"b73c","type":1,"text":"In the body of the method we see that a local variable to_unref is declared, being initialized by the nullptr value. Before the if statement, this pointer is not used in any way, its value doesn’t get changed. Thus, the body of the if statement won’t be executed, because the pointer remained null. Perhaps, this code was left after the refactoring. There is a chance that this pointer was to be used somewhere between the initialization and the check, but instead of it, the programmer used another one (mixed them up), but I didn’t find similar names. Looks suspicious.","markups":[{"type":2,"start":55,"end":64},{"type":2,"start":102,"end":110},{"type":2,"start":128,"end":130}]},{"name":"fd93","type":1,"text":"Let’s go on.","markups":[]},{"name":"9651","type":8,"text":"struct LSTMBlockCellBprop ....\n{\n  ....\n  void operator()(...., bool use_peephole, ....) {\n  ....\n  if (use_peephole) {\n    cs_prev_grad.device(d) =\n        cs_prev_grad +\n        di * wci.reshape(p_shape).broadcast(p_broadcast_shape) +\n        df * wcf.reshape(p_shape).broadcast(p_broadcast_shape);\n  }","markups":[{"type":10,"start":0,"end":304},{"type":1,"start":0,"end":6},{"type":1,"start":42,"end":46},{"type":1,"start":47,"end":55},{"type":1,"start":64,"end":68},{"type":1,"start":100,"end":102}]},{"name":"7ece","type":8,"text":"  if (use_peephole) {\n    wci_grad.device(d) = \n      (di * cs_prev).sum(Eigen::array\x3cint, 1\x3e({0}));\n    wcf_grad.device(d) = \n      (df * cs_prev).sum(Eigen::array\x3cint, 1\x3e({0}));\n    wco_grad.device(d) = \n      (do_ * cs).sum(Eigen::array\x3cint, 1\x3e({0}));\n  }\n  ....\n  }\n};","markups":[{"type":10,"start":0,"end":272},{"type":1,"start":2,"end":4},{"type":1,"start":86,"end":89},{"type":1,"start":165,"end":168},{"type":1,"start":240,"end":243}]},{"name":"7597","type":1,"text":"A link to GitHub.","markups":[{"type":3,"start":0,"end":16,"href":"https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/contrib/rnn/kernels/lstm_ops.h","title":"","rel":"","anchorType":0}]},{"name":"535c","type":6,"text":"PVS-Studio warning: V581 The conditional expressions of the ‘if’ operators situated alongside each other are identical. Check lines: 277, 284. lstm_ops.h 284","markups":[{"type":3,"start":20,"end":24,"href":"https://www.viva64.com/en/w/v581/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":20},{"type":1,"start":24,"end":25},{"type":2,"start":0,"end":157}]},{"name":"9bd3","type":1,"text":"There are two conditional operators with an identical conditional statement, but between these statements, the expression (in this case the use_peephole parameter) doesn’t get changed. Sometimes it may indicate a serious enough error, when a wrong statement was used in one of the cases, but in this case, judging by the context, we can say that the conditional statements were just duplicated. I think it’s not a bug, but all the operations could be put in a single conditional statement.","markups":[{"type":2,"start":140,"end":153}]},{"name":"af6e","type":1,"text":"One does not simply write an write and skip copy-paste errors.","markups":[]},{"name":"70e2","type":8,"text":"struct CompressFlags {\n  ....\n  Format format;","markups":[{"type":10,"start":0,"end":46},{"type":1,"start":0,"end":6}]},{"name":"c75d","type":8,"text":"  ....\n  int quality = 95;","markups":[{"type":10,"start":0,"end":26},{"type":1,"start":9,"end":12}]},{"name":"7374","type":8,"text":"  ....\n  bool progressive = false;","markups":[{"type":10,"start":0,"end":34},{"type":1,"start":9,"end":13}]},{"name":"c057","type":8,"text":"  ....\n  bool optimize_jpeg_size = false;","markups":[{"type":10,"start":0,"end":41},{"type":1,"start":9,"end":13}]},{"name":"485b","type":8,"text":"  ....\n  bool chroma_downsampling = true;","markups":[{"type":10,"start":0,"end":41},{"type":1,"start":9,"end":13}]},{"name":"7267","type":8,"text":"  ....\n  int density_unit = 1;  \n  int x_density = 300;\n  int y_density = 300;","markups":[{"type":10,"start":0,"end":78},{"type":1,"start":9,"end":12},{"type":1,"start":35,"end":38},{"type":1,"start":58,"end":61}]},{"name":"3752","type":8,"text":"  ....\n  StringPiece xmp_metadata;","markups":[{"type":10,"start":0,"end":34}]},{"name":"7d02","type":8,"text":"  ....\n  int stride = 0;\n};","markups":[{"type":10,"start":0,"end":27},{"type":1,"start":9,"end":12}]},{"name":"e407","type":8,"text":"class EncodeJpegOp : public OpKernel {\n  ....\n  explicit EncodeJpegOp(OpKernelConstruction* context) :  \n    OpKernel(context) { \n    ....\n    OP_REQUIRES_OK(context, \n      context-\x3eGetAttr(\"quality\", &flags_.quality));\n    OP_REQUIRES(context, \n      0 \x3c= flags_.quality && flags_.quality \x3c= 100,\n      errors::InvalidArgument(\"quality must be in [0,100], got \",\n      flags_.quality));\n    OP_REQUIRES_OK(context,\n      context-\x3eGetAttr(\"progressive\", \n                       &flags_.progressive));\n    OP_REQUIRES_OK(context, \n      context-\x3eGetAttr(\"optimize_size\", \n                       &flags_.optimize_jpeg_size));\n    OP_REQUIRES_OK(context, \n      context-\x3eGetAttr(\"chroma_downsampling\",         // \x3c=\n                       &flags_.chroma_downsampling));\n    OP_REQUIRES_OK(context, \n      context-\x3eGetAttr(\"chroma_downsampling\",         // \x3c=\n                       &flags_.chroma_downsampling));\n    ....\n  }\n  ....  \n  jpeg::CompressFlags flags_;\n}","markups":[{"type":10,"start":0,"end":964},{"type":1,"start":0,"end":5},{"type":1,"start":21,"end":27},{"type":1,"start":48,"end":56},{"type":1,"start":57,"end":69},{"type":1,"start":109,"end":117}]},{"name":"c88d","type":1,"text":"A link to GitHub.","markups":[{"type":3,"start":0,"end":16,"href":"https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/kernels/encode_jpeg_op.cc","title":"","rel":"","anchorType":0}]},{"name":"1285","type":6,"text":"PVS-Studio warning: V760 Two identical blocks of text were found. The second block begins from line 58. encode_jpeg_op.cc 56","markups":[{"type":3,"start":20,"end":24,"href":"https://www.viva64.com/en/w/v760/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":20},{"type":2,"start":0,"end":124}]},{"name":"3aa3","type":1,"text":"As you can see in the code, the programmer checks the values of the flags, read from the field flags_ in the constructor of the EncodeJpegOp class via the macros OP_REQUIRES_OK and OP_REQUIRES. However, in the last lines of the given fragment, the value of the same flag is checked for the constructor. It looks very much like copy-paste: the code was copied, but not edited.","markups":[{"type":2,"start":95,"end":102},{"type":2,"start":128,"end":141},{"type":2,"start":162,"end":176},{"type":2,"start":181,"end":193}]},{"name":"d63c","type":1,"text":"The most interesting (and the hardest part) is to understand if the copy-paste redundant or something else was meant to be here. If the code is redundant, then there is nothing horrible, but the situation is completely different, if another code fragment was meant here, because we get a logical error here.","markups":[]},{"name":"fbaf","type":1,"text":"Having reviewed the body of the constructor, I haven’t found the check of the stride field. Perhaps, in one of the cases, this very check was meant to be. On the other hand, the order of the fields in the constructor is similar with the order of field declaration in the structure CompressFlags. Thus, it’s hard to say how this code should be fixed, we can only make assumptions. In any case, this code is worth paying attention to.","markups":[{"type":2,"start":78,"end":84},{"type":2,"start":281,"end":294}]},{"name":"f9eb","type":1,"text":"The analyzer also found several suspicious fragments related to the bit shifting. Let’s have a look at them. I want to remind, that incorrect use of the shift operations leads to undefined behavior.","markups":[]},{"name":"f407","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*hVem1cPjcIO4l90p.png","originalWidth":480,"originalHeight":375}},{"name":"2e13","type":8,"text":"class InferenceContext {\n  ....\n  inline int64 Value(DimensionOrConstant d) const {\n    return d.dim.IsSet() ? d.dim-\x3evalue_ : d.val;\n  }\n  ....\n}\nREGISTER_OP(\"UnpackPath\")\n    .Input(\"path: int32\")\n    .Input(\"path_values: float\")\n    .Output(\"unpacked_path: float\")\n    .SetShapeFn([](InferenceContext* c) {\n      ....\n      int64 num_nodes = InferenceContext::kUnknownDim;\n      if (c-\x3eValueKnown(tree_depth)) {\n        num_nodes = (1 \x3c\x3c c-\x3eValue(tree_depth)) - 1;    // \x3c=\n      }\n      ....\n    })\n....;","markups":[{"type":10,"start":0,"end":508},{"type":1,"start":0,"end":5},{"type":1,"start":34,"end":40},{"type":1,"start":47,"end":52},{"type":1,"start":76,"end":81},{"type":1,"start":88,"end":94},{"type":1,"start":382,"end":384}]},{"name":"58e1","type":1,"text":"A link to GitHub.","markups":[{"type":3,"start":0,"end":16,"href":"https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/contrib/tensor_forest/hybrid/core/ops/unpack_path_op.cc","title":"","rel":"","anchorType":0}]},{"name":"1b66","type":6,"text":"PVS-Studio warning: V629 Consider inspecting the ‘1 \x3c\x3c c-\x3eValue(tree_depth)’ expression. Bit shifting of the 32-bit value with a subsequent expansion to the 64-bit type. unpack_path_op.cc 55","markups":[{"type":3,"start":20,"end":24,"href":"https://www.viva64.com/en/w/v629/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":20},{"type":2,"start":0,"end":190}]},{"name":"e2f4","type":1,"text":"The strangeness of this code is in the fact that the 32 and 64 bit values are mixed in the shift and assignment operations. The literal 1 is a 32-bit value, for which a left-side shift is performed. The result of the shift still has a 32-bit type, but is written to the 64-bit variable. It is suspicious, because we may get undefined behavior if the value returned by the Value method is more than 32.","markups":[{"type":2,"start":136,"end":137},{"type":2,"start":372,"end":377}]},{"name":"b0c9","type":6,"text":"Here is a quote from the standard: The value of E1 \x3c\x3c E2 is E1 left-shifted E2 bit positions; vacated bits are zero-filled. If E1 has an unsigned type, the value of the result is E1 * 2^E2, reduced modulo one more than the maximum value representable in the result type. Otherwise, if E1 has a signed type and non-negative value, and E1*2^E2 is representable in the result type, then that is the resulting value; otherwise, the behavior is undefined.","markups":[{"type":1,"start":0,"end":35},{"type":1,"start":271,"end":449},{"type":2,"start":0,"end":450}]},{"name":"2f16","type":1,"text":"This code can be fixed by writing 1 as a 64-bit literal or doing the type extension via casting. More details on the shift operations can be found in the article “Wade not in unknown waters. Part three”.","markups":[{"type":3,"start":163,"end":201,"href":"https://www.viva64.com/en/b/0142/","title":"","rel":"","anchorType":0},{"type":2,"start":34,"end":35}]},{"name":"50bd","type":1,"text":"The extension through the casting was used in another fragment as well. Here is the code:","markups":[]},{"name":"e0da","type":8,"text":"AlphaNum::AlphaNum(Hex hex) {\n  ....\n  uint64 value = hex.value;\n  uint64 width = hex.spec;\n  // We accomplish minimum width by OR'ing in 0x10000 to the user's  \n  // value,\n  // where 0x10000 is the smallest hex number that is as wide as the \n  // user\n  // asked for.\n  uint64 mask = ((static_cast\x3cuint64\x3e(1) \x3c\x3c (width - 1) * 4)) | \n                  value;\n  ....\n}","markups":[{"type":10,"start":0,"end":368},{"type":1,"start":288,"end":299}]},{"name":"71e6","type":1,"text":"A link to GitHub.","markups":[{"type":3,"start":0,"end":16,"href":"https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/lib/strings/strcat.cc","title":"","rel":"","anchorType":0}]},{"name":"9433","type":6,"text":"PVS-Studio warning: V592 The expression was enclosed by parentheses twice: ((expression)). One pair of parentheses is unnecessary or misprint is present. strcat.cc 43","markups":[{"type":3,"start":20,"end":24,"href":"https://www.viva64.com/en/w/v592/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":20},{"type":2,"start":0,"end":166}]},{"name":"9f00","type":1,"text":"This code is actually correct, but the analyzer found it suspicious, having detected duplicate parentheses. The analyzer thinks in the following way: the double brackets do not affect the evaluation result, so perhaps one pair of brackets is placed not where it should be.","markups":[]},{"name":"cd99","type":1,"text":"We cannot exclude that the brackets were probably meant to explicitly underline the precedence of evaluations and to avoid remembering the priorities of the operations ‘\x3c\x3c’ and ‘*’. They aren’t much necessary as they are in the wrong place anyway. I reckon that this evaluation order is correct (first we specify a shift value, and then do the shift itself), so we just have to put the brackets in the correct order, so that they do not confuse people.","markups":[]},{"name":"2dfd","type":8,"text":"uint64 mask = (static_cast\x3cuint64\x3e(1) \x3c\x3c ((width - 1) * 4)) | value;","markups":[{"type":10,"start":0,"end":68},{"type":1,"start":15,"end":26}]},{"name":"397f","type":1,"text":"Let’s go on.","markups":[]},{"name":"0958","type":8,"text":"void Compute(OpKernelContext* context) override {\n  ....\n  int64 v = floor(in_x);\n  ....\n  v = ceil(in_x1);\n  x_interp.end = ceil(in_x1);\n  v = x_interp.end - 1;\n  ....\n}","markups":[{"type":10,"start":0,"end":170},{"type":1,"start":0,"end":4},{"type":1,"start":5,"end":12}]},{"name":"6f21","type":1,"text":"A link to GitHub.","markups":[{"type":3,"start":0,"end":16,"href":"https://github.com/tensorflow/tensorflow/blob/bbe056e5a0ab81b67fcb6053400812b3d5805fc7/tensorflow/core/kernels/resize_area_op.cc","title":"","rel":"","anchorType":0}]},{"name":"79a2","type":6,"text":"PVS-Studio warning: V519 The ‘v’ variable is assigned values twice successively. Perhaps this is a mistake. Check lines: 172, 174. resize_area_op.cc 174","markups":[{"type":3,"start":20,"end":24,"href":"https://www.viva64.com/en/w/v519/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":20},{"type":1,"start":24,"end":25},{"type":2,"start":0,"end":152}]},{"name":"36c1","type":1,"text":"The v variable is assigned twice, but between these assignments, the value of this variable is not used in any way. Moreover, the variable x_interp.end is assigned with the same value of the variable that was written to the v variable. Even if we omit the fact that the call of the ceil function is redundant here, as it is not critical (although…), the code looks strange: either it is weirdly written or it contains a tricky error.","markups":[{"type":2,"start":4,"end":5},{"type":2,"start":139,"end":152},{"type":2,"start":224,"end":226},{"type":2,"start":282,"end":287}]},{"name":"2fcd","type":1,"text":"What’s next?","markups":[]},{"name":"ec73","type":8,"text":"void Compute(OpKernelContext* context) override {\n  ....\n  int64 sparse_input_start;                                    // \x3c=\n  ....\n  if (sparse_input) {\n    num_total_features += GetNumSparseFeatures(\n      sparse_input_indices, *it, &sparse_input_start);         // \x3c=\n  }\n  if (num_total_features == 0) {\n    LOG(WARNING) \x3c\x3c \"num total features is zero.\";\n    break;\n  }\n  if (rand_feature \x3c input_spec_.dense_features_size()) {\n    ....\n  } else {\n    ....\n    const int32 sparse_index = sparse_input_start +            // \x3c=\n      rand_feature - input_spec_.dense_features_size();\n    ....\n  }\n  ....\n}","markups":[{"type":10,"start":0,"end":608},{"type":1,"start":0,"end":4},{"type":1,"start":5,"end":12},{"type":1,"start":135,"end":137},{"type":1,"start":278,"end":280},{"type":1,"start":364,"end":369},{"type":1,"start":377,"end":379},{"type":1,"start":446,"end":450},{"type":1,"start":466,"end":471}]},{"name":"4c80","type":1,"text":"A link to GitHub.","markups":[{"type":3,"start":0,"end":17,"href":"https://github.com/tensorflow/tensorflow/blob/eae70b8ee31d87bdfd339aecf05100f0a1633961/tensorflow/contrib/tensor_forest/kernels/sample_inputs_op.cc","title":"","rel":"","anchorType":0}]},{"name":"3cd9","type":6,"text":"PVS-Studio warning: V614 Potentially uninitialized variable ‘sparse_input_start’ used. sample_inputs_op.cc 351","markups":[{"type":3,"start":20,"end":24,"href":"https://www.viva64.com/en/w/v614/","title":"","rel":"","anchorType":0},{"type":1,"start":0,"end":20},{"type":2,"start":0,"end":110}]},{"name":"762c","type":1,"text":"The suspicious thing about this code is that during the initialization of the sparse_index constant, a potentially uninitialized variable sparse_input_start can also be used. At the time of declaration, this variable is not initialized with any value, i.e. it contains some junk. Further on, in case the statement sparse_input is true, the address of the variable sparse_input_start is passed to the function GetNumSparseFeatures, where perhaps, the variable initialization takes place. Otherwise, if the body of this conditional operator isn’t executed, sparse_input_start will remain uninitialized.","markups":[{"type":2,"start":78,"end":91},{"type":2,"start":138,"end":157},{"type":2,"start":314,"end":327},{"type":2,"start":364,"end":383},{"type":2,"start":409,"end":429},{"type":2,"start":555,"end":574}]},{"name":"3b70","type":1,"text":"Of course, we can suppose that in case if sparse_input_start remains uninitialized, it won’t get used, but it’s too bold and unobvious, so better to set a standard value for the variable.","markups":[{"type":2,"start":42,"end":61}]},{"name":"1731","type":3,"text":"Is that all?","markups":[]},{"name":"89ba","type":1,"text":"Well, yes and no. To be honest, I was hoping to find more defects and write an article in the style of the articles Qt, Mono, Unreal Engine 4 and similar to them, but it didn’t work. The project authors did a great job, there were not so many errors found. I was also hoping that the project would of a bigger size, but there were only 700 files checked in the chosen configuration, including the auto generated files.","markups":[{"type":3,"start":116,"end":118,"href":"https://www.viva64.com/en/b/0251/","title":"","rel":"","anchorType":0},{"type":3,"start":120,"end":124,"href":"https://www.viva64.com/en/b/0431/","title":"","rel":"","anchorType":0},{"type":3,"start":126,"end":141,"href":"https://www.viva64.com/en/b/0249/","title":"","rel":"","anchorType":0}]},{"name":"a514","type":1,"text":"Besides that, a lot of things were left outside the scope of this article, for example:","markups":[]},{"name":"203f","type":9,"text":"we reviewed only the warnings of the GA group;","markups":[]},{"name":"e2de","type":9,"text":"we did not review the warnings of the 3 (Low) level of certainty;","markups":[]},{"name":"dff8","type":9,"text":"the analyzer issued several dozens of V730 warnings, but it’s hard to judge about their criticality, so it’s up to developers to decide;","markups":[{"type":3,"start":38,"end":42,"href":"https://www.viva64.com/en/w/v730/","title":"","rel":"","anchorType":0}]},{"name":"5bc8","type":9,"text":"and many more.","markups":[]},{"name":"96c2","type":1,"text":"Nevertheless, there was quite a number of interesting fragments found, which we reviewed in this article.","markups":[]},{"name":"c35e","type":3,"text":"Summing up","markups":[]},{"name":"cf99","type":1,"text":"TensorFlow turned out to be quite an interesting and high-quality project in terms of code, but, as we saw, not without flaws. At the same time PVS-Studio proved once more that it is able to find errors even in the code of well-known developers.","markups":[]},{"name":"c284","type":1,"text":"In conclusion, I cannot but compliment all the developers of TensorFlow for the qualitative code and wish them the best of luck in the future.","markups":[]},{"name":"5f02","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"0*3xMCDgMbf4aMCGNF.png","originalWidth":379,"originalHeight":195}},{"name":"8750","type":1,"text":"Thank you for the attention to those who got to the end of the article and don’t forget to use PVS-Studio!","markups":[{"type":3,"start":95,"end":105,"href":"https://www.viva64.com/en/pvs-studio/","title":"","rel":"","anchorType":0}]}],"sections":[{"name":"a919","startIndex":0}]},"postDisplay":{"coverless":true}},"virtuals":{"allowNotes":true,"previewImage":{"imageId":"0*y24BVsXdIggXnUwA.png","filter":"","backgroundSize":"","originalWidth":520,"originalHeight":287,"strategy":"resample","height":0,"width":0},"wordCount":4427,"imageCount":11,"readingTime":18.005660377358492,"subtitle":"“I’ll be back” ©. I think everybody knows this phrase. Although, today we aren’t going to talk about the return of the terminator, the…","usersBySocialRecommends":[],"recommends":15,"socialRecommends":[],"isBookmarked":false,"tags":[{"slug":"tensorflow","name":"TensorFlow","postCount":390,"virtuals":{"isFollowing":false},"metadata":{"followerCount":1022,"postCount":390,"coverImage":{"id":"1*W2vzGrXR1ua5KN-X0m9oMw.jpeg","originalWidth":1920,"originalHeight":1431,"isFeatured":true}},"type":"Tag"},{"slug":"cpp","name":"Cpp","postCount":314,"virtuals":{"isFollowing":false},"metadata":{"followerCount":179,"postCount":314,"coverImage":{"id":"0*y24BVsXdIggXnUwA.png","originalWidth":520,"originalHeight":287}},"type":"Tag"},{"slug":"open-source","name":"Open Source","postCount":6103,"virtuals":{"isFollowing":false},"metadata":{"followerCount":4898,"postCount":6103,"coverImage":{"id":"1*-h1bH8gB3I7gPh5AG1HmsQ.png","originalWidth":2464,"originalHeight":1280}},"type":"Tag"},{"slug":"development","name":"Development","postCount":5632,"virtuals":{"isFollowing":false},"metadata":{"followerCount":1921,"postCount":5632,"coverImage":{"id":"1*wS8k6IlIgSb-7-lPhaNyrQ.png","originalWidth":1396,"originalHeight":1859}},"type":"Tag"},{"slug":"software","name":"Software","postCount":5714,"virtuals":{"isFollowing":false},"metadata":{"followerCount":801,"postCount":5714,"coverImage":{"id":"1*Hwt0oLwuzlNf5ERtkyZ-OQ.jpeg","originalWidth":4193,"originalHeight":2785}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":0,"links":{"entries":[],"version":"0.3","generatedAt":1491916006290},"isLockedPreviewOnly":false,"takeoverId":"","metaDescription":"","totalClapCount":0},"coverless":true,"slug":"war-of-the-machines-pvs-studio-vs-tensorflow","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f","previewContent":{"bodyModel":{"paragraphs":[{"name":"8b80","type":3,"text":"War of the Machines: PVS-Studio vs. TensorFlow","markups":[],"alignment":1},{"name":"2406","type":4,"text":"","markups":[],"layout":9,"metadata":{"id":"0*y24BVsXdIggXnUwA.png","originalWidth":520,"originalHeight":287}}],"sections":[{"startIndex":0}]},"isFullContent":false},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/@CPP_Coder/war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f","approvedHomeCollectionId":"","newsletterId":"","webCanonicalUrl":"https://medium.com/@CPP_Coder/war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f","mediumUrl":"https://medium.com/@CPP_Coder/war-of-the-machines-pvs-studio-vs-tensorflow-d3d20fe0229f","migrationId":"","notifyFollowers":true,"notifyTwitter":false,"isSponsored":false,"isRequestToPubDisabled":false,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"type":"Post"},"mentionedUsers":[],"collaborators":[],"membershipPlans":[],"collectionUserRelations":[],"mode":null,"references":{"User":{"b773450fce8a":{"userId":"b773450fce8a","name":"Sergey Vasiliev","username":"CPP_Coder","createdAt":1429010593050,"lastPostCreatedAt":1491915524127,"imageId":"0*tjWbXDbIHRTRpOvA.png","backgroundImageId":"","bio":"Developer of PVS-Studio static analyzer.","twitterScreenName":"CPP_Coder","socialStats":{"userId":"b773450fce8a","usersFollowedCount":2,"usersFollowedByCount":150,"type":"SocialStats"},"social":{"userId":"lo_e2d1ded67d25","targetUserId":"b773450fce8a","type":"Social"},"facebookAccountId":"","allowNotes":1,"type":"User"}},"Social":{"b773450fce8a":{"userId":"lo_e2d1ded67d25","targetUserId":"b773450fce8a","type":"Social"}},"SocialStats":{"b773450fce8a":{"userId":"b773450fce8a","usersFollowedCount":2,"usersFollowedByCount":150,"type":"SocialStats"}}}})
// ]]></script></body></html>