<!DOCTYPE html><html xmlns:cc="http://creativecommons.org/ns#"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# medium-com: http://ogp.me/ns/fb/medium-com#"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Tracking the Money — Scaling Financial Reporting at Airbnb</title><link rel="canonical" href="https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040"><meta name="title" content="Tracking the Money — Scaling Financial Reporting at Airbnb"><meta name="referrer" content="unsafe-url"><meta name="description" content="At Airbnb, the Payments team is responsible for everything related to moving money in Airbnb’s global marketplace. We build technology that powers Airbnb’s massive daily transaction volume to collect…"><meta property="og:title" content="Tracking the Money — Scaling Financial Reporting at Airbnb"><meta property="og:url" content="https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040"><meta property="og:image" content="https://cdn-images-1.medium.com/max/1200/1*2F3AL1MjQLNFM39Lt5abjg.png"><meta property="fb:app_id" content="542599432471018"><meta property="og:description" content="At Airbnb, the Payments team is responsible for everything related to moving money in Airbnb’s global marketplace."><meta name="twitter:description" content="At Airbnb, the Payments team is responsible for everything related to moving money in Airbnb’s global marketplace."><meta name="twitter:image:src" content="https://cdn-images-1.medium.com/max/1200/1*2F3AL1MjQLNFM39Lt5abjg.png"><link rel="publisher" href="https://plus.google.com/103654360130207659246"><link rel="author" href="https://medium.com/@sanitycannon"><meta property="author" content="Alice Liang"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="article:publisher" content="https://www.facebook.com/medium"><meta property="article:author" content="https://medium.com/@sanitycannon"><meta property="fb:smart_publish:robots" content="noauto"><meta name="robots" content="index, follow"><meta property="article:published_time" content="2017-03-16T17:28:16.089Z"><meta name="twitter:site" content="@Medium"><meta property="og:site_name" content="Medium"><meta name="twitter:label1" value="Reading time"><meta name="twitter:data1" value="13 min read"><script type="application/ld+json">{"@context":"http://schema.org","@type":"NewsArticle","image":{"@type":"ImageObject","width":848,"height":340,"url":"https://cdn-images-1.medium.com/max/848/1*2F3AL1MjQLNFM39Lt5abjg.png"},"datePublished":"2017-03-16T17:28:16.089Z","dateModified":"2017-03-17T08:47:25.340Z","headline":"Tracking the Money — Scaling Financial Reporting at Airbnb","name":"Tracking the Money — Scaling Financial Reporting at Airbnb","keywords":["Big Data","Analytics","Payments","Scala","Accounting"],"author":{"@type":"Person","name":"Alice Liang","url":"https://medium.com/@sanitycannon"},"creator":["Alice Liang"],"publisher":{"@type":"Organization","name":"Airbnb Engineering & Data Science","url":"https://medium.com/airbnb-engineering","logo":{"@type":"ImageObject","width":215,"height":60,"url":"https://cdn-images-1.medium.com/max/215/1*5ztbgEt4NqpVaxTc64C-XA.png"}},"mainEntityOfPage":"https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040"}</script><meta name="twitter:app:name:iphone" content="Medium"><meta name="twitter:app:id:iphone" content="828256236"><meta name="twitter:app:url:iphone" content="medium://p/6d742b80f040"><meta property="al:ios:app_name" content="Medium"><meta property="al:ios:app_store_id" content="828256236"><meta property="al:android:package" content="com.medium.reader"><meta property="al:android:app_name" content="Medium"><meta property="al:ios:url" content="medium://p/6d742b80f040"><meta property="al:android:url" content="medium://p/6d742b80f040"><meta property="al:web:url" content="https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040"><link rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml" /><link rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/6d742b80f040" /><meta name="theme-color" content="#000000"><link rel="stylesheet" href="https://cdn-static-1.medium.com/_/fp/css/main-base.g2e09PlZK_j3Lw2AgNmbfQ.css"><script>if (window.top !== window.self) window.top.location = window.self.location.href;var OB_startTime = new Date().getTime(); var OB_loadErrors = []; function _onerror(e) { OB_loadErrors.push(e) }; if (document.addEventListener) document.addEventListener("error", _onerror, true); else if (document.attachEvent) document.attachEvent("onerror", _onerror); function _asyncScript(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("script"); s.type = "text/javascript"; s.async = true; s.src = u; f.parentNode.insertBefore(s, f);}function _asyncStyles(u) {var d = document, f = d.getElementsByTagName("script")[0], s = d.createElement("link"); s.rel = "stylesheet"; s.href = u; f.parentNode.insertBefore(s, f); return s}var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-24232453-2"]); _gaq.push(["_setDomainName", window.location.hostname]); _gaq.push(["_setAllowLinker", true]); _gaq.push(["_trackPageview"]);_asyncScript(("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js");(new Image()).src = "/_/stat?event=pixel.load&origin=" + encodeURIComponent(location.origin);</script><script>(function () {var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth; document.write("<style>section.section-image--fullBleed.is-backgrounded {padding-top: " + Math.round(1.1 * height) + "px;}section.section-image--fullScreen.is-backgrounded, section.section-image--coverFade.is-backgrounded {min-height: " + height + "px; padding-top: " + Math.round(0.5 * height) + "px;}.u-sizeViewHeight100 {height: " + height + "px !important;}.u-sizeViewHeight110 {height: " + Math.round(1.1 * height) + "px !important;}.u-sizeViewHeightMin100 {min-height: " + height + "px !important;}.u-sizeViewHeightMax100 {max-height: " + height + "px !important;}section.section-image--coverFade {height: " + height + "px;}.section-aspectRatioViewportPlaceholder, .section-aspectRatioViewportCropPlaceholder {max-height: " + height + "px;}.section-aspectRatioViewportBottomSpacer, .section-aspectRatioViewportBottomPlaceholder {max-height: " + Math.round(0.5 * height) + "px;}.zoomable:before {top: " + (-1 * height) + "px; left: " + (-1 * width) + "px; padding: " + height + "px " + width + "px;}</style>");})()</script><!--[if lt IE 9]><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js"></script><![endif]--><link rel="icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon-medium.TAS6uQ-Y7kcKgi0xjcYHXw.ico" class="js-favicon"><link rel="apple-touch-icon" sizes="152x152" href="https://cdn-images-1.medium.com/fit/c/152/152/1*MlNQKg-sieBGW5prWoe9HQ.jpeg"><link rel="apple-touch-icon" sizes="120x120" href="https://cdn-images-1.medium.com/fit/c/120/120/1*MlNQKg-sieBGW5prWoe9HQ.jpeg"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn-images-1.medium.com/fit/c/76/76/1*MlNQKg-sieBGW5prWoe9HQ.jpeg"><link rel="apple-touch-icon" sizes="60x60" href="https://cdn-images-1.medium.com/fit/c/60/60/1*MlNQKg-sieBGW5prWoe9HQ.jpeg"><link rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/favicon.KjTfUJo7yJH_fCoUzzH3cg.svg" color="#171717"></head><body itemscope class=" postShowScreen is-noJs"><script>document.body.className = document.body.className.replace(/(^|\s)is-noJs(\s|$)/, "$1is-js$2")</script><div class="site-main" id="container"><div class="butterBar butterBar--error"></div><div class="surface"><div id="prerendered" class="screenContent"><canvas class="canvas-renderer"></canvas><div class="container u-maxWidth740 u-xs-margin0 notesPositionContainer js-notesPositionContainer"></div><div class="metabar u-clearfix js-metabar u-textColorTransparentWhiteDarker u-tintBgColor u-tintSpectrum"><div class="metabar-inner u-marginAuto u-maxWidth1000 u-paddingLeft20 u-paddingRight20 js-metabarMiddle"><div class="metabar-block metabar-block--left u-floatLeft u-height65 u-xs-height56"><a href="https://medium.com/" class="siteNav-logo" data-log-event="home"><span class="svgIcon svgIcon--logoNew svgIcon--45px is-flushLeft"><svg class="svgIcon-use" width="45" height="45"  viewBox="-17 18 45 45" data-multipart="true"><path d="M11.525 28.078c-.472-.225-.858.002-.858.506v20.044l8.616 4.113c.948.46 1.717.14 1.717-.7v-19.3a.22.22 0 0 0-.124-.19l-9.35-4.46v-.01z"/><path d="M.333 43.696l9.83-15.247c.278-.43.89-.6 1.36-.38l9.364 4.47c.06.03.082.1.047.15L10.666 48.63.333 43.698v-.002z"/><path d="M-8.57 28.35c-.786-.375-1.053-.096-.592.62L.333 43.696l10.333 4.932L.356 32.635a.156.156 0 0 0-.06-.054l-8.866-4.23z"/><path d="M.333 52.033c0 .84-.643 1.22-1.43.844l-8.045-3.84c-.472-.224-.858-.82-.858-1.325V28.89c0-.672.515-.976 1.145-.675l9.133 4.36a.092.092 0 0 1 .055.084v19.37z"/></svg></span><span class="u-textScreenReader">Homepage</span></a><div class="u-alignMiddle u-inlineBlock u-verticalAlignTop u-height65 u-xs-height56"><div class="u-alignBlock"><span class="u-inlineBlock u-height28 u-xs-height24 u-verticalAlignTop u-marginRight20 u-borderRightTransparentWhiteLighter"></span></div></div><div class="u-alignMiddle u-inlineBlock u-verticalAlignTop u-height65 u-xs-height56 u-marginRight18"><div class="u-alignBlock"><a class="js-logCollection" href="https://medium.com/airbnb-engineering?source=logo-lo_ef9687d53417---53c7c27702d5"><span class="u-uiTextBold u-fontSize18 u-lineHeight18 u-xs-fontSize22 u-xs-lineHeight22 u-xs-noWrapWithEllipsis u-inlineBlock u-xs-maxWidth200">Airbnb Engineering &amp; Data Science</span></a></div></div><div class="u-alignMiddle u-inlineBlock u-verticalAlignTop u-height65 u-xs-height56 u-xs-hide"><div class="u-alignBlock"><div class="buttonSet u-lineHeightInherit u-marginLeft0"><div class="buttonSet-inner"><button class="button button--primary u-paddingLeft10 u-paddingRight10 u-height19 u-lineHeight13 u-verticalAlignMiddle u-fontSize12 u-uiTextMedium button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal js-relationshipButton is-smallPill"  data-action="sign-in-prompt" data-sign-in-action="toggle-follow-collection" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/collection/airbnb-engineering" data-collection-id="53c7c27702d5"><span class="button-label  js-buttonLabel">Follow</span></button></div><a class="button button--light button--chromeless is-touchIconBlackPulse u-baseColor--buttonLight button--withIcon button--withSvgIcon"  href="https://twitter.com/AirbnbEng" title="Visit “Airbnb Engineering &amp; Data Science” on Twitter" aria-label="Visit “Airbnb Engineering &amp; Data Science” on Twitter" rel="me" target="_blank"><span class="button-defaultState"><span class="svgIcon svgIcon--twitterFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25" ><path d="M21.725 5.338c-.744.47-1.605.804-2.513 1.006a3.978 3.978 0 0 0-2.942-1.293c-2.22 0-4.02 1.81-4.02 4.02 0 .32.034.63.07.94-3.31-.18-6.27-1.78-8.255-4.23a4.544 4.544 0 0 0-.574 2.01c.04 1.43.74 2.66 1.8 3.38-.63-.01-1.25-.19-1.79-.5v.08c0 1.93 1.38 3.56 3.23 3.95-.34.07-.7.12-1.07.14-.25-.02-.5-.04-.72-.07.49 1.58 1.97 2.74 3.74 2.8a8.49 8.49 0 0 1-5.02 1.72c-.3-.03-.62-.04-.93-.07A11.447 11.447 0 0 0 8.88 21c7.386 0 11.43-6.13 11.414-11.414.015-.21.01-.38 0-.578a7.604 7.604 0 0 0 2.01-2.08 7.27 7.27 0 0 1-2.297.645 3.856 3.856 0 0 0 1.72-2.23"/></svg></span></span></a><a class="button button--light button--chromeless is-touchIconBlackPulse u-baseColor--buttonLight button--withIcon button--withSvgIcon u-paddingLeft0"  href="//facebook.com/airbnbeng" title="Visit “Airbnb Engineering &amp; Data Science” on Facebook" aria-label="Visit “Airbnb Engineering &amp; Data Science” on Facebook" rel="me" target="_blank"><span class="button-defaultState"><span class="svgIcon svgIcon--facebookFilled svgIcon--25px"><svg class="svgIcon-use" width="25" height="25" viewBox="0 0 25 25" ><path d="M21 12.646C21 7.65 16.97 3.6 12 3.6s-9 4.05-9 9.046a9.026 9.026 0 0 0 7.59 8.924v-6.376H8.395V12.64h2.193v-1.88c0-2.186 1.328-3.375 3.267-3.375.93 0 1.728.07 1.96.1V9.77H14.47c-1.055 0-1.26.503-1.26 1.242v1.63h2.517l-.33 2.554H13.21V21.6c4.398-.597 7.79-4.373 7.79-8.954"/></svg></span></span></a></div></div></div></div><div class="metabar-block u-floatRight u-xs-absolute u-xs-textAlignRight u-xs-right0 u-xs-marginRight20 u-height65 u-xs-height56"><div class="u-alignMiddle u-inlineBlock u-verticalAlignTop u-height65 u-xs-height56"><div class="u-alignBlock"><div class="buttonSet u-lineHeightInherit"><a class="button button--primary button--light button--chromeless u-accentColor--buttonNormal is-inSiteNavBar u-lineHeight30 u-height32"  href="https://medium.com/m/signin?redirect=https%3A%2F%2Fmedium.com%2Fairbnb-engineering%2Ftracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040" data-action="sign-in-prompt" data-redirect="https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040" data-action-source="nav_signup">Sign in / Sign up</a></div></div></div></div></div><div class="metabar-inner u-marginAuto u-maxWidth1000 js-metabarBottom"><nav role="navigation" class="metabar-block metabar-block--below u-overflowHiddenY u-height40"><ul class="u-textAlignLeft u-noWrap u-overflowX js-collectionNavItems u-sm-paddingLeft20 u-sm-paddingRight20 u-paddingBottom100"><li class="metabar-navItem js-collectionNavItem u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken js-homeNav u-baseColor--link"  href="https://medium.com/airbnb-engineering">Home</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline js-navItemLink u-baseColor--link"  href="https://medium.com/airbnb-engineering/tagged/data-science">Data Science</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline js-navItemLink u-baseColor--link"  href="https://medium.com/airbnb-engineering/tagged/open-source">Open Source</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline js-navItemLink u-baseColor--link"  href="https://medium.com/airbnb-engineering/tagged/machine-learning">Machine Learning</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline js-navItemLink u-baseColor--link"  href="https://medium.com/airbnb-engineering/tagged/payments">Payments</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline js-navItemLink u-baseColor--link"  href="https://medium.com/airbnb-engineering/tagged/security">Security</a></li><li class="metabar-navItem js-collectionNavItem  u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="link link--darken u-accentColor--textDarken link--noUnderline js-navItemLink u-baseColor--link"  href="https://medium.com/airbnb-engineering/tagged/mobile">Mobile</a></li><li class="metabar-navItem js-collectionNavItem u-uiTextMedium u-fontSize14 u-inlineBlock u-textUppercase u-letterSpacing003 u-textColorNormal u-xs-paddingRight12 u-xs-marginRight0 u-paddingTop5 u-xs-paddingTop10"><a class="button button--chromeless u-baseColor--buttonNormal button--withIcon button--withSvgIcon u-top1"  href="https://medium.com/airbnb-engineering/search" title="Search" aria-label="Search"><span class="button-defaultState"><span class="svgIcon svgIcon--search svgIcon--25px"><svg class="svgIcon-use" width="25" height="25"  viewBox="0 0 25 25"><path d="M20.067 18.933l-4.157-4.157a6 6 0 1 0-.884.884l4.157 4.157a.624.624 0 1 0 .884-.884zM6.5 11c0-2.62 2.13-4.75 4.75-4.75S16 8.38 16 11s-2.13 4.75-4.75 4.75S6.5 13.62 6.5 11z"/></svg></span></span></a></li></ul></nav></div></div><div class="metabar metabar--spacer js-metabarSpacer u-tintBgColor  u-height105 u-xs-height95"></div><main role="main"><article class=" u-sizeViewHeightMin100 u-overflowHidden postArticle postArticle--full is-withAccentColors u-marginBottom40"  lang="en"><header class="container u-maxWidth740"><div class="postMetaHeader u-paddingBottom10 row"><div class="col u-size12of12 js-postMetaLockup"><div class="postMetaLockup postMetaLockup--authorWithBio u-flex js-postMetaLockup"><div class="u-flex0"><a class="link avatar u-baseColor--link"  href="https://medium.com/@sanitycannon?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="d701357ebd99" data-action-type="hover" data-user-id="d701357ebd99" dir="auto"><img  src="https://cdn-images-1.medium.com/fit/c/60/60/0*RcWkrH0w7euJvJ-A.jpg" class="avatar-image avatar-image--small" alt="Go to the profile of Alice Liang"></a></div><div class="u-flex1 u-paddingLeft15 u-overflowHidden"><a class="link link link--darken link--darker u-baseColor--link"  href="https://medium.com/@sanitycannon?source=post_header_lockup" data-action="show-user-card" data-action-source="post_header_lockup" data-action-value="d701357ebd99" data-action-type="hover" data-user-id="d701357ebd99" dir="auto">Alice Liang</a><span class="followState js-followState buttonSet-inner" data-user-id="d701357ebd99"><button class="button u-paddingLeft10 u-paddingRight10 u-height19 u-lineHeight13 u-verticalAlignMiddle u-fontSize12 u-uiTextMedium u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton u-marginLeft10 u-marginTopNegative2 u-xs-hide"  data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="post_header_lockup"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary u-paddingLeft10 u-paddingRight10 u-height19 u-lineHeight13 u-verticalAlignMiddle u-fontSize12 u-uiTextMedium u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton u-marginLeft10 u-marginTopNegative2 u-xs-hide"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/d701357ebd99" data-action-source="post_header_lockup_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span><div class="postMetaInline u-noWrapWithEllipsis u-xs-normalWrap u-xs-lineClamp2">software engineer at Airbnb</div><div class="postMetaInline js-testPostMetaInlineSupplemental"><time datetime="2017-03-16T17:28:16.089Z">Mar 16</time><span class="middotDivider u-fontSize12"></span><span class="readingTime" title="13 min read"></span></div></div></div></div></div></header><div class="postArticle-content js-postField js-notesSource js-trackedPost"  data-post-id="6d742b80f040" data-source="post_page" data-collection-id="53c7c27702d5" data-tracking-context="postPage"><section name="8a1f" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="3de6" id="3de6" class="graf graf--h3 graf--leading graf--title">Tracking the Money — Scaling Financial Reporting at Airbnb</h1><figure name="4da4" id="4da4" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 281px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 40.1%;"></div><img class="graf-image" data-image-id="1*2F3AL1MjQLNFM39Lt5abjg.png" data-width="848" data-height="340" data-action="zoom" data-action-value="1*2F3AL1MjQLNFM39Lt5abjg.png" src="https://cdn-images-1.medium.com/max/800/1*2F3AL1MjQLNFM39Lt5abjg.png"></div></figure><p name="2f18" id="2f18" class="graf graf--p graf-after--figure">At Airbnb, the Payments team is responsible for everything related to moving money in Airbnb’s global marketplace. We build technology that powers Airbnb’s massive daily transaction volume to collect payments from guests and distribute payouts to hosts. Our goal is to make the payment experience on Airbnb delightful, magical, and intuitive.</p><p name="8608" id="8608" class="graf graf--p graf-after--p"><a href="https://medium.com/airbnb-engineering/scaling-airbnbs-payment-platform-43ebfc99b324#.3gu3yi77b" data-href="https://medium.com/airbnb-engineering/scaling-airbnbs-payment-platform-43ebfc99b324#.3gu3yi77b" class="markup--anchor markup--p-anchor" target="_blank">Historically, the payments team’s focus was to implement new features, currencies, and payment methods to make payments local in a global business</a>. Our sphere has grown to include compliance (sales taxes, earnings taxes, licenses, and more) as well as reconciliation and financial accounting according to generally accepted accounting principles.</p><p name="e62f" id="e62f" class="graf graf--p graf-after--p">Currently, Airbnb’s payment and financial accounting system is a complex ecosystem that transacts in 191 countries, with 70+ currencies and 20+ processors. Not only has Airbnb’s transaction volume experienced exponential transaction growth every year, we have also rapidly increased features and products on our platform. Airbnb hopes to become a premier end-to-end travel service, not only helping people with accommodations but also <a href="https://www.airbnb.com/experiences" data-href="https://www.airbnb.com/experiences" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">trip experiences</a> as well.</p><p name="dc5d" id="dc5d" class="graf graf--p graf-after--p">The challenge to maintain the existing financial accounting system to support new products as well as the increasing data volume has become a “mission impossible” sort of a task.</p><p name="575d" id="575d" class="graf graf--p graf-after--p">Airbnb’s Finance Infrastructure engineering team is responsible for delivering accurate, reliable, and comprehensive business/financial data to our stakeholders. In this blog post, we’ll talk about how we manage to keep track of where all of our money is and how it moves in a scalable way in the face of exploding data size and complexity, as well as to support new Airbnb initiatives and payment products. We’ll share the workflow of our deprecated finance system, illustrate its challenges and issues and then describe the new system that we built to replace it.</p><h3 name="a4ac" id="a4ac" class="graf graf--h3 graf-after--p">The prior financial system: a MySQL-based data pipeline</h3><p name="991e" id="991e" class="graf graf--p graf-after--h3">Built in early 2012 and retired in late 2016, our previous financial system was a MySQL data pipeline. It was a parameterized MySQL ETL that ran nightly to provide financial reporting, and served us faithfully for the past few years. The workflow was as follows:</p><figure name="453c" id="453c" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 532px; max-height: 103px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 19.400000000000002%;"></div><img class="graf-image" data-image-id="1*EzX1NLoTGNYuhtd46QxzUQ.jpeg" data-width="532" data-height="103" src="https://cdn-images-1.medium.com/max/800/1*EzX1NLoTGNYuhtd46QxzUQ.jpeg"></div></figure><ul class="postList"><li name="f776" id="f776" class="graf graf--li graf-after--figure">We enabled <a href="http://dev.mysql.com/doc/refman/5.7/en/triggers.html" data-href="http://dev.mysql.com/doc/refman/5.7/en/triggers.html" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">MySQL database triggers</a> for all our main tables to be able to capture each change to Airbnb reservation and payment records as they happen in real time on a per row basis. This way, we enforced immutability, and ensured all financially relevant events would be captured. This was meant to be a temporary solution to deal with the inherent mutability of the production data. We acknowledge that it wasn’t a great pattern, but it was necessary at the time.</li><li name="a9f3" id="a9f3" class="graf graf--li graf-after--li">By being able to replay the history of events with database triggers, we built a set of intermediate helper tables that assist in calculating different reports. For example, we kept track of recognized revenue, guest receivables, future host payouts (liabilities), and other essential components of financial reporting.</li><li name="837f" id="837f" class="graf graf--li graf-after--li">Based on those helper tables, we built all the financial reporting.</li></ul><h3 name="13cb" id="13cb" class="graf graf--h3 graf-after--li">The Scaling Challenge</h3><p name="b780" id="b780" class="graf graf--p graf-after--h3">There were some advantages to this approach. Since we only relied on MySQL DB triggers and MySQL guarantees data accuracy, engineers had lots of flexibility to change the business logic and to move very fast. SQL based reports can be written very fast when the logic is simple.</p><p name="11e7" id="11e7" class="graf graf--p graf-after--p">However, the SQL-based ETL approach was not scaling well:</p><h4 name="42e5" id="42e5" class="graf graf--h4 graf-after--p"><em class="markup--em markup--h4-em">It wasn’t the right language for the programming model</em></h4><ul class="postList"><li name="d3f3" id="d3f3" class="graf graf--li graf-after--h4">SQL is good for lightweight data transformation. It is not designed to handle complicated business data flow. Modern software design principles can not be easily applied to decompose the complexity.</li><li name="739d" id="739d" class="graf graf--li graf-after--li">The original logic was tightly coupled with our core reservation logic. As Airbnb grew, the company needed to support product logic other than the original reservation flow, e.g. we needed to pay professional photographers, translators, and so on. Every product change had a unique money flow, and thus, financial and accounting impacts. As a result, we had to build many additional reports to meet each business need. Because the MySQL logic was structured around reservation logic, it was hard to modify and was extremely error prone when adding new logic for other products.</li><li name="786a" id="786a" class="graf graf--li graf-after--li">Validation and testing became impossible. To get a comprehensive result, we pulled the data separately for all the different reports and our finance team combined them at their discretion. Because we built all the reports separately, it could be very difficult to tell which change in which report caused issues if there were number mismatches. This was not scalable when the company wanted to change the product or add new products more frequently.</li><li name="ee51" id="ee51" class="graf graf--li graf-after--li">As we added more and more reporting logic, and as our transaction volume grew, developing reports using SQL scripts became more complex, and prohibitively so. It became extremely difficult and time consuming to test the logic for accuracy.</li></ul><h4 name="b3cc" id="b3cc" class="graf graf--h4 graf-after--li"><em class="markup--em markup--h4-em">The nightly runs were taking too much time</em></h4><p name="0755" id="0755" class="graf graf--p graf-after--h4">As our transaction volume grew and our transformation logic became more complex, the nightly pipeline took more time. A relational database is hard to scale up. It is difficult to shard the data and difficult to leverage a distributed system to process a massive amount of data. Towards the end of its life, we were only able to run it every other day due to its runtime of over 24 hours.</p><h3 name="1ec6" id="1ec6" class="graf graf--h3 graf-after--p">Our Goals:</h3><p name="80bd" id="80bd" class="graf graf--p graf-after--h3">As we grow, we needed to be able to cope with dramatically increasing data size and the frequent addition of new Airbnb products and payment channels. Thus, we had two goals for our new system:</p><ul class="postList"><li name="f22e" id="f22e" class="graf graf--li graf-after--p">The new system should give us enough flexibility to support more products as well as deal with product changes or accounting logic changes. To do this,<strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em"> we need to decouple the financial logic from the product logic.</em></strong> The representation of those product behaviors can be very generic in our financial system, e.g. how to book the receivable / payable / revenue / tax / etc. Thus we can build very sustainable financial reports based on highly normalized data.</li><li name="202c" id="202c" class="graf graf--li graf-after--li">The new system should scale horizontally. As volume grows, we should be able to scale out our system by just adding machines.</li></ul><h3 name="dbbd" id="dbbd" class="graf graf--h3 graf-after--li">Introducing our new financial reporting pipeline</h3><p name="a964" id="a964" class="graf graf--p graf-after--h3">Our event based financial report is designed to:</p><ul class="postList"><li name="6a3e" id="6a3e" class="graf graf--li graf-after--p">support all current and future product types in our platform</li><li name="aed8" id="aed8" class="graf graf--li graf-after--li">have a holistic view of all events with financial impact on our platform</li><li name="cc71" id="cc71" class="graf graf--li graf-after--li">horizontally scale as our transaction volume grows</li></ul><p name="59d2" id="59d2" class="graf graf--p graf-after--li">It is powered by <a href="http://spark.apache.org/" data-href="http://spark.apache.org/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Apache Spark</a>, stored on our <a href="http://hortonworks.com/apache/hdfs/" data-href="http://hortonworks.com/apache/hdfs/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">HDFS</a> cluster, and written in <a href="https://www.scala-lang.org/what-is-scala.html" data-href="https://www.scala-lang.org/what-is-scala.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">Scala</a>. Spark is a fast and general engine for large-scale data processing, with implicit parallelism and fault-tolerance. We chose Scala as the language because we wanted the latest features of Spark, as well as the other benefits of the language, like types, closures, immutability, lazy evaluation, etc.</p><p name="2e4f" id="2e4f" class="graf graf--p graf-after--p">This is huge considering our previous language was SQL.</p><h3 name="fac0" id="fac0" class="graf graf--h3 graf-after--p">A brief overview of how it works</h3><p name="e735" id="e735" class="graf graf--p graf-after--h3">Our new financial reporting system has a concept of different product types, of which reservations are only one. Each product type has its own set of platform and payment events, and a corresponding set of financial events. Thus we can address each product type individually and systematically build up to a holistic report.</p><p name="9d2c" id="9d2c" class="graf graf--p graf-after--p">The system can be thought of as many event handlers that calculate the accounting impact of different products at different points in their life cycle. Because Scala has a strong static type system, while providing full support for functional programming, it is easy to design and write handlers about different products and how to process them.</p><p name="4289" id="4289" class="graf graf--p graf-after--p">Below is a diagram of how the data flows through the system. Don’t worry, we’ll explain everything.</p><figure name="c4cb" id="c4cb" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 492px; max-height: 582px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 118.30000000000001%;"></div><img class="graf-image" data-image-id="1*1HCBBvi5d3OhjzSHVwn4lA.jpeg" data-width="492" data-height="582" src="https://cdn-images-1.medium.com/max/800/1*1HCBBvi5d3OhjzSHVwn4lA.jpeg"></div></figure><p name="fb9b" id="fb9b" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Platform events are events that provide information about product related changes</em></strong>, like reservations, reservation alterations, photography, cancellations, etc. These usually have some financial expectation associated with them, but it is not always the case. Each time a product is created or updated, we derive an event for that product. For example, when a reservation is booked, we emit a booking event for the reservation product type. A day after the reservation starts, we consider the reservation to have “services rendered”. When the service is delivered to the customer (the guest in this case), we can then recognize revenue. These events are important because they have financial accounting implications, and we will talk about those more below.</p><p name="fbd1" id="fbd1" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Payment events describe money movement.</em></strong> They can be events where real money moves in and out of Airbnb bank accounts. Payment events also describe stored value, like when someone buys and uses gift cards. There are other kinds of payment events where money may not actually move, but we still have to account for the lack of cash movement. This can be when someone sends someone else a gift card, and that person claims it. We consider those to be balance transfers, or virtual movement. An example of no money movement would be when a guest uses a coupon. The money from the coupon is funded from the marketing budget, but no money has actually moved accounts — we just need to account for it somewhere. <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Money in must equal money out.</em></strong> Because coupons are on the guest side and don’t impact the original host payout amount and likewise the other host side operations, we need to take these into account so the money equation balances.</p><p name="2dc2" id="2dc2" class="graf graf--p graf-after--p">These events are currently generated from examining the aforementioned accounting audit rows for changes. If the change has an accounting impact, then a platform or payment event is generated. This system was designed as a central place for all the data to pass through from different systems. The financial reporting system processes these platform and payment events with event handlers, and produces accounting events that describe the accounting impact of those events.</p><p name="aeca" id="aeca" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Accounting events are generated by event handlers that build them from the payment and platform events</em></strong><em class="markup--em markup--p-em">.</em> We introduced this layer of abstraction to represent the relationship between the different platform and payment events for each product, as well as the accounting logic. Sometimes, as you’ll see below, a single platform event can generate more than one accounting event, because it has multiple accounting impacts at different times. These events basically keep track of what happened by assigning a unique identifier, the product type and the product id, to a set of activity. For us, we consider the product type and id to be the smallest accounting unit that we operate on.</p><p name="e68f" id="e68f" class="graf graf--p graf-after--p">From accounting events, we generate the subledger, which is the basis for all of our financial accounting. <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Each entry is a detailed accounting record that includes information about the time a transaction occurred</em></strong> (payment or reservation booking), the amount, the currency, the direction of the monetary impact (credit or debit) and the account that it impacts.</p><p name="4a67" id="4a67" class="graf graf--p graf-after--p">The subledger is generated using <a href="https://en.wikipedia.org/wiki/Double-entry_bookkeeping_system" data-href="https://en.wikipedia.org/wiki/Double-entry_bookkeeping_system" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">double entry accounting</a>. Double entry accounting allows us to be sure that everything is accounted for properly in the system. This means no money appears or disappears without a source.</p><p name="d9cd" id="d9cd" class="graf graf--p graf-after--p">Even though each product type may behave differently, we’ve found a generic life cycle that all product types share. Let’s walk through how a reservation would look in this framework.</p><figure name="4eb3" id="4eb3" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 682px; max-height: 497px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 72.89999999999999%;"></div><img class="graf-image" data-image-id="1*h3_yS91yfS5UzuNiAcDVWw.jpeg" data-width="682" data-height="497" src="https://cdn-images-1.medium.com/max/800/1*h3_yS91yfS5UzuNiAcDVWw.jpeg"></div></figure><p name="da3f" id="da3f" class="graf graf--p graf-after--figure">An event happens that introduces some accounting liability, and a contract is created. No money has moved at this point, but expectations for future money flow are set up here. The accounting events at this point describe the contract that has been created.</p><ul class="postList"><li name="1053" id="1053" class="graf graf--li graf-after--p">Here, a guest has confirmed a two night reservation for $100. We refer to this time as booking date, and treat it as the contract start date. Of the $100, $90 is the price of the stay, $10 are fees. (This price breakdown is for example purposes only, and does not reflect any real reservation. We’ve also left the host fees out of this to simplify the explanation.)</li><li name="4a51" id="4a51" class="graf graf--li graf-after--li">The guest and the host have entered into a contract with each other, with Airbnb acting as the platform and payment collection agent. In exchange for staying at this listing for two nights, the guest will pay Airbnb $100, and the host will receive $90 some time after check-in. On the date of the reservation confirmation, we have a guest receivable of $100, and a future host payable of $90, due to the host when we consider the reservation to be fulfilled. These expectations are set up as soon as the reservation is confirmed.</li></ul><p name="6dc5" id="6dc5" class="graf graf--p graf-after--li">An event’s money flow occurs. This can happen anytime after the contract has been created. The accounting events here describe the direction and for what liability the amount is fulfilling.</p><ul class="postList"><li name="cf00" id="cf00" class="graf graf--li graf-after--p">Here, the guest successfully pays $100 for the reservation. We would consider the guest receivable then fulfilled.</li></ul><p name="335c" id="335c" class="graf graf--p graf-after--li">The event happens and so the contracted service is fulfilled.</p><ul class="postList"><li name="8f39" id="8f39" class="graf graf--li graf-after--p">This is after the check-in time. This is the point in which we would recognize revenue and losses, if there are any. In this example, we didn’t have any. This is also the time that the scheduled $90 payout for the host should be delivered to the host. This means that the future host payable is now a host payable because it is now due.</li></ul><p name="d225" id="d225" class="graf graf--p graf-after--li">More money flows may occur.</p><ul class="postList"><li name="d022" id="d022" class="graf graf--li graf-after--p">This is when we successfully deliver the $90 payout to the host. Now Airbnb’s host payable is $0 for this particular host.</li></ul><p name="5540" id="5540" class="graf graf--p graf-after--li">Sometimes, there are alterations on a product or a payment. Examples would be a guest adding dates to a reservation inducing a reservation price change. To properly account for the price differences from an alteration, we “unbook” and “rebook” the reservation entirely at the time of alteration.</p><ul class="postList"><li name="8285" id="8285" class="graf graf--li graf-after--p">For example, if the reservation was previously booked for $100, and now it is $150 because the guest extended their stay at a later date, we could either book an additional $50 on the later date, or unbook the reservation for $100 and rebook it for $150 on that day. Why do you think we chose to do the latter? It’s because when alterations add up, it’s much easier to just unbook and rebook, instead of computing the delta every time. It’s the cleanest way we can deal with product alterations and data backfills. Just imagine how alterations on a long term reservation would look in our system!</li></ul><p name="f41d" id="f41d" class="graf graf--p graf-after--li">Now that we’ve built the subledgers from the platform and payment events, and their handlers, we can easily query for the financial impact to different accounts that any event generates.</p><p name="353b" id="353b" class="graf graf--p graf-after--p">An example of how revenue would be queried from the subledger is as follows:</p><figure name="d0e9" id="d0e9" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="iframeContainer"><IFRAME width="700" height="250" src="/media/b777d104e6a55d7fc1e1d322fdba1df5?postId=6d742b80f040" data-media-id="b777d104e6a55d7fc1e1d322fdba1df5" allowfullscreen frameborder="0"></IFRAME></div></div></figure><h3 name="74fa" id="74fa" class="graf graf--h3 graf-after--figure">Key Takeaways</h3><h4 name="b99f" id="b99f" class="graf graf--h4 graf-after--h3"><em class="markup--em markup--h4-em">It scales while maintaining quality and performance</em></h4><p name="3873" id="3873" class="graf graf--p graf-after--h4">Our financial reporting pipeline scales both on a product basis, and on a runtime basis. We can easily support new products on the financial engineering side because we’ve built a framework around the right abstractions, instead of tying it too closely with one specific product’s life cycle. We can also scale horizontally. This is much better than being limited by an Amazon RDS instance, no matter how beefy it may be. Our nightly runtime is 4–5 hours and has not been growing too much as of March 2017.</p><h4 name="ec83" id="ec83" class="graf graf--h4 graf-after--p"><em class="markup--em markup--h4-em">It made troubleshooting much simpler</em></h4><p name="6208" id="6208" class="graf graf--p graf-after--h4">Before, when our Finance team needed comprehensive reports, we pulled the data separately for all the different reports and our finance team combined them at their discretion. Because we built all the reports separately, it could be very difficult to tell which change in which report caused unexpected deviances. This was not scalable when the company wanted to change the product or add new products more frequently. Now when there’s an issue, we investigate data from a single source of truth, significantly simplifying the troubleshooting process.</p><h4 name="ba4f" id="ba4f" class="graf graf--h4 graf-after--p"><em class="markup--em markup--h4-em">It made coding much simpler</em></h4><p name="8e34" id="8e34" class="graf graf--p graf-after--h4">Going from declarative programming to functional programming has been a powerful paradigm shift for us to think about financial processing and accounting. We can now think of this system as a straightforward actor/handler system rather than getting mired in complicated SQL-join logic.</p><h4 name="b1b5" id="b1b5" class="graf graf--h4 graf-after--p"><em class="markup--em markup--h4-em">The nightly runs are timely and well monitored</em></h4><p name="08c6" id="08c6" class="graf graf--p graf-after--h4">Originally, the MySQL ETL was scheduled via a crontab, and was dependent on data arriving via a different pipeline. Instead of taking upwards of a day to complete, the nightly run takes around 4–5 hours to complete. We no longer have to babysit a legacy system that quite frequently encounters snags caused by upstream changes, taking hours of developer time each week to resolve.</p><h4 name="1578" id="1578" class="graf graf--h4 graf-after--p"><em class="markup--em markup--h4-em">We built a comprehensive test framework</em></h4><p name="481a" id="481a" class="graf graf--p graf-after--h4">This is perhaps the important part of the picture. Because our financial processing and reporting is no longer in SQL, we are now also able to write extensive suites of unit tests against specific handlers. Together with integration tests and smoke tests, we can easily identify regressions and other errors. Smoke tests are rules we expect our data to follow and when rule violations occur, they are logged and addressed. This gives us a high degree of confidence in the quality of our data and lets us quickly vet new changes and roll them out. We have built an extensive (and ever expanding) test suite of real transactions, in which we check how we expect them to look in the system individually as well as in aggregate. This test framework is critical when we have time sensitive requests from our various partners in Finance and Legal, as well as from our audit partners, and need to be confident in our reporting.</p><h3 name="245c" id="245c" class="graf graf--h3 graf-after--p">Future looking</h3><p name="a626" id="a626" class="graf graf--p graf-after--h3">In the future, we will be moving towards an entirely event-based system. The financial reporting system will consume events emitted from other systems. Stay tuned to read about that in a future blog post. This will help us with even greater financial integrity and a richer vocabulary with which we can express different products and payment flows.</p><p name="eb00" id="eb00" class="graf graf--p graf-after--p">In the end, what we want most at Airbnb is to have is complete, accurate and extensible financial reporting for all of our current and future products at Airbnb. We believe that we have designed the financial reporting system to be a strong foundation of all financial processing at Airbnb. Because of the clean decoupling of business logic and accounting logic, this system is product agnostic, extensible, and future-proof, which gives us confidence it will serve us well for many years to come. This is just the start of our back office financial systems at Airbnb.</p><p name="d680" id="d680" class="graf graf--p graf-after--p">If you enjoyed reading this and thought this was an interesting challenge, the payments team is always looking for talented people to join the team, whether you are a <a href="https://www.airbnb.com/careers/departments/engineering" data-href="https://www.airbnb.com/careers/departments/engineering" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">software engineer</a> or a <a href="https://www.airbnb.com/careers/departments/data-science-analytics" data-href="https://www.airbnb.com/careers/departments/data-science-analytics" class="markup--anchor markup--p-anchor" rel="noopener nofollow" target="_blank">data scientist</a>.</p><p name="2eb1" id="2eb1" class="graf graf--p graf-after--p">Please stay tuned for more on the Payments ecosystem at Airbnb!</p><p name="8c38" id="8c38" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">Many thanks to Sarah Hagstrom, Lou Kosak, Shawn Yan, Brian Wey, Jiangming Yang, and Ian Logan for reading through many drafts and helping me to write this post.</em></p></div></div></section></div><footer class="u-paddingTop10"><div class="container u-maxWidth740"><div class="row"><div class="col u-size12of12"></div></div><div class="row"><div class="col u-size12of12 js-postTags"><div class="u-paddingBottom10"><ul class="tags tags--postTags tags--borderless"><li><a class="link u-baseColor--link"  href="https://medium.com/tag/big-data?source=post" data-action-source="post">Big Data</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/analytics?source=post" data-action-source="post">Analytics</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/payments?source=post" data-action-source="post">Payments</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/scala?source=post" data-action-source="post">Scala</a></li><li><a class="link u-baseColor--link"  href="https://medium.com/tag/accounting?source=post" data-action-source="post">Accounting</a></li></ul></div></div></div><div class="row js-postActionsFooter"><div class="postActions col u-size12of12"><div class="u-floatLeft buttonSet buttonSet--withLabels"><div class="buttonSet-inner"><div class="js-actionRecommend" data-post-id="6d742b80f040" data-is-icon-29px="true" data-has-recommend-list="true" data-source="post_actions_footer"><button class="button button--primary button--large button--chromeless is-touchIconFadeInPulse u-accentColor--buttonNormal button--withIcon button--withSvgIcon u-accentColor--iconLight js-actionRecommendButton"  title="Recommend to share this article with your followers and let the author know you liked it" aria-label="Recommend to share this article with your followers and let the author know you liked it" data-action="sign-in-prompt" data-sign-in-action="upvote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/6d742b80f040" data-action-source="post_actions_footer"><span class="button-defaultState"><span class="svgIcon svgIcon--heart svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.215 23.716c-.348.288-.984.826-1.376 1.158a.526.526 0 0 1-.68 0c-.36-.307-.92-.78-1.22-1.03C9.22 20.734 3 15.527 3 10.734 3 7.02 5.916 4 9.5 4c1.948 0 3.77.898 5 2.434C15.73 4.898 17.552 4 19.5 4c3.584 0 6.5 3.02 6.5 6.734 0 4.9-6.125 9.96-9.785 12.982zM19.5 5.2c-1.774 0-3.423.923-4.41 2.468a.699.699 0 0 1-.59.323.706.706 0 0 1-.59-.32c-.988-1.54-2.637-2.47-4.41-2.47-2.922 0-5.3 2.49-5.3 5.54 0 4.23 6.19 9.41 9.517 12.19.217.18.566.48.783.66l.952-.79c3.496-2.88 9.348-7.72 9.348-12.05 0-3.05-2.378-5.53-5.3-5.53z"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--heartFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.5 4c-1.948 0-3.77.898-5 2.434C13.27 4.898 11.448 4 9.5 4 5.916 4 3 7.02 3 10.734c0 4.793 6.227 10 9.95 13.11.296.25.853.723 1.212 1.03.196.166.48.166.677 0 .39-.332 1.02-.87 1.37-1.158 3.66-3.022 9.79-8.08 9.79-12.982C26 7.02 23.08 4 19.5 4z" fill-rule="evenodd"/></svg></span></span></button><button class="button button--chromeless u-baseColor--buttonNormal"  data-action="show-recommends" data-action-value="6d742b80f040">300</button></div></div><div class="buttonSet-inner"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  data-action="scroll-to-responses" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--response svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.27 20.058c1.89-1.826 2.754-4.17 2.754-6.674C24.024 8.21 19.67 4 14.1 4 8.53 4 4 8.21 4 13.384c0 5.175 4.53 9.385 10.1 9.385 1.007 0 2-.14 2.95-.41.285.25.592.49.918.7 1.306.87 2.716 1.31 4.19 1.31.276-.01.494-.14.6-.36a.625.625 0 0 0-.052-.65c-.61-.84-1.042-1.71-1.282-2.58a5.417 5.417 0 0 1-.154-.75zm-3.85 1.324l-.083-.28-.388.12a9.72 9.72 0 0 1-2.85.424c-4.96 0-8.99-3.706-8.99-8.262 0-4.556 4.03-8.263 8.99-8.263 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32c0 .07 0 .19.02.37.03.29.1.6.19.92.19.7.49 1.4.89 2.08-.93-.14-1.83-.49-2.67-1.06-.34-.22-.88-.48-1.16-.74z"/></svg></span></button><button class="button button--chromeless u-baseColor--buttonNormal"  data-action="scroll-to-responses">10</button></div></div><div class="u-floatRight buttonSet buttonSet--narrow"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"/></svg></span></button><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_actions_footer"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"/></svg></span></button></div></div></div></div><div class="js-postPromotionWrapper postPromotionWrapper" data-location-id="footer_above_post_attribution"></div><div class="container u-maxWidth740 js-postAttributionFooterContainer u-paddingTop20 u-paddingBottom20 u-marginTop10 u-borderTopLightest u-xs-paddingTop10 u-xs-paddingBottom10"><div class="row js-postFooterInfo"><div class="col u-size6of12 u-xs-size12of12"><li class="u-block u-paddingBottom18 js-cardUser"><div class="u-marginLeft20 u-floatRight"><span class="followState js-followState buttonSet-inner" data-user-id="d701357ebd99"><button class="button button--small u-noUserSelect button--withChrome u-baseColor--buttonNormal button--withHover button--unblock js-unblockButton"  data-action="sign-in-prompt" data-sign-in-action="toggle-block-user" data-requires-token="true" data-action-source="footer_card"><span class="button-label  button-defaultState">Blocked</span><span class="button-label button-hoverState">Unblock</span></button><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal button--follow js-followButton"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-user" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/user/d701357ebd99" data-action-source="footer_card_follow"><span class="button-label  button-defaultState js-buttonLabel">Follow</span><span class="button-label button-activeState">Following</span></button></span></div><div class="u-tableCell "><a class="link avatar u-baseColor--link"  href="https://medium.com/@sanitycannon?source=footer_card" title="Go to the profile of Alice Liang" aria-label="Go to the profile of Alice Liang" data-action-source="footer_card" data-user-id="d701357ebd99" dir="auto"><img  src="https://cdn-images-1.medium.com/fit/c/60/60/0*RcWkrH0w7euJvJ-A.jpg" class="avatar-image avatar-image--small" alt="Go to the profile of Alice Liang"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal"  href="https://medium.com/@sanitycannon" property="cc:attributionName" title="Go to the profile of Alice Liang" aria-label="Go to the profile of Alice Liang" rel="author cc:attributionUrl" data-user-id="d701357ebd99" dir="auto">Alice Liang</a></h3><p class="u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">software engineer at Airbnb</p></div></li></div><div class="col u-size6of12 u-xs-size12of12 u-xs-marginTop30"><li class="u-block u-paddingBottom18 js-cardCollection"><div class="u-marginLeft20 u-floatRight"><button class="button button--primary button--small u-noUserSelect button--withChrome u-accentColor--buttonNormal js-relationshipButton"  data-action="sign-in-prompt" data-sign-in-action="toggle-follow-collection" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/collection/airbnb-engineering" data-collection-id="53c7c27702d5"><span class="button-label  js-buttonLabel">Follow</span></button></div><div class="u-tableCell "><a class="link avatar avatar--roundedRectangle u-baseColor--link"  href="https://medium.com/airbnb-engineering?source=footer_card" title="Go to Airbnb Engineering &amp; Data Science" aria-label="Go to Airbnb Engineering &amp; Data Science" data-action-source="footer_card"><img src="https://cdn-images-1.medium.com/fit/c/60/60/1*MlNQKg-sieBGW5prWoe9HQ.jpeg" class="avatar-image u-size60x60" alt="Airbnb Engineering &amp; Data Science"></a></div><div class="u-tableCell u-verticalAlignMiddle u-breakWord u-paddingLeft15"><h3 class="u-fontSize18 u-lineHeightTighter u-marginBottom4"><a class="link link--primary u-accentColor--hoverTextNormal"  href="https://medium.com/airbnb-engineering?source=footer_card" rel="collection" data-action-source="footer_card">Airbnb Engineering &amp; Data Science</a></h3><p class="u-fontSize14 u-lineHeightBaseSans u-textColorDark u-marginBottom4">Creative engineers and data scientists building a world where you can belong anywhere. <a rel="nofollow" href="http://airbnb.io">http://airbnb.io</a></p><div class="buttonSet"></div></div></li></div></div></div><div class="js-postFooterPlacements"></div><div class="u-padding0 u-clearfix u-backgroundGrayLightest u-print-hide supplementalPostContent js-responsesWrapper"></div><div class="supplementalPostContent js-readNext"></div><div class="supplementalPostContent js-heroPromo"></div></footer></article></main><div class="u-marginAuto u-maxWidth1000"><div class="js-postShareWidget u-foreground u-sm-hide u-transition--fadeOut300 u-fixed"><ul><li class="u-uiTextSemibold u-textAlignCenter u-textColorNormal u-fontSize12 u-textUppercase">Share</li><li class="u-textAlignCenter"><div class="js-actionRecommend" data-post-id="6d742b80f040" data-is-icon-29px="true" data-is-vertical="true" data-has-recommend-list="true" data-source="post_share_widget"><button class="button button--primary button--large button--chromeless is-touchIconFadeInPulse u-accentColor--buttonNormal button--withIcon button--withSvgIcon u-accentColor--iconLight js-actionRecommendButton"  title="Recommend to share this article with your followers and let the author know you liked it" aria-label="Recommend to share this article with your followers and let the author know you liked it" data-action="sign-in-prompt" data-sign-in-action="upvote" data-requires-token="true" data-redirect="https://medium.com/_/vote/p/6d742b80f040" data-action-source="post_share_widget"><span class="button-defaultState"><span class="svgIcon svgIcon--heart svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.215 23.716c-.348.288-.984.826-1.376 1.158a.526.526 0 0 1-.68 0c-.36-.307-.92-.78-1.22-1.03C9.22 20.734 3 15.527 3 10.734 3 7.02 5.916 4 9.5 4c1.948 0 3.77.898 5 2.434C15.73 4.898 17.552 4 19.5 4c3.584 0 6.5 3.02 6.5 6.734 0 4.9-6.125 9.96-9.785 12.982zM19.5 5.2c-1.774 0-3.423.923-4.41 2.468a.699.699 0 0 1-.59.323.706.706 0 0 1-.59-.32c-.988-1.54-2.637-2.47-4.41-2.47-2.922 0-5.3 2.49-5.3 5.54 0 4.23 6.19 9.41 9.517 12.19.217.18.566.48.783.66l.952-.79c3.496-2.88 9.348-7.72 9.348-12.05 0-3.05-2.378-5.53-5.3-5.53z"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--heartFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.5 4c-1.948 0-3.77.898-5 2.434C13.27 4.898 11.448 4 9.5 4 5.916 4 3 7.02 3 10.734c0 4.793 6.227 10 9.95 13.11.296.25.853.723 1.212 1.03.196.166.48.166.677 0 .39-.332 1.02-.87 1.37-1.158 3.66-3.022 9.79-8.08 9.79-12.982C26 7.02 23.08 4 19.5 4z" fill-rule="evenodd"/></svg></span></span></button><button class="button button--chromeless u-baseColor--buttonNormal  u-block u-marginAuto u-marginTopNegative5"  data-action="show-recommends" data-action-value="6d742b80f040">300</button></div></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Twitter" aria-label="Share on Twitter" data-action="share-on-twitter" data-action-source="post_share_widget"><span class="svgIcon svgIcon--twitter svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M21.967 11.8c.018 5.93-4.607 11.18-11.177 11.18-2.172 0-4.25-.62-6.047-1.76l-.268.422-.038.5.186.013.168.012c.3.02.44.032.6.046 2.06-.026 3.95-.686 5.49-1.86l1.12-.85-1.4-.048c-1.57-.055-2.92-1.08-3.36-2.51l-.48.146-.05.5c.22.03.48.05.75.08.48-.02.87-.07 1.25-.15l2.33-.49-2.32-.49c-1.68-.35-2.91-1.83-2.91-3.55 0-.05 0-.01-.01.03l-.49-.1-.25.44c.63.36 1.35.57 2.07.58l1.7.04L7.4 13c-.978-.662-1.59-1.79-1.618-3.047a4.08 4.08 0 0 1 .524-1.8l-.825.07a12.188 12.188 0 0 0 8.81 4.515l.59.033-.06-.59v-.02c-.05-.43-.06-.63-.06-.87a3.617 3.617 0 0 1 6.27-2.45l.2.21.28-.06c1.01-.22 1.94-.59 2.73-1.09l-.75-.56c-.1.36-.04.89.12 1.36.23.68.58 1.13 1.17.85l-.21-.45-.42-.27c-.52.8-1.17 1.48-1.92 2L22 11l.016.28c.013.2.014.35 0 .52v.04zm.998.038c.018-.22.017-.417 0-.66l-.498.034.284.41a8.183 8.183 0 0 0 2.2-2.267l.97-1.48-1.6.755c.17-.08.3-.02.34.03a.914.914 0 0 1-.13-.292c-.1-.297-.13-.64-.1-.766l.36-1.254-1.1.695c-.69.438-1.51.764-2.41.963l.48.15a4.574 4.574 0 0 0-3.38-1.484 4.616 4.616 0 0 0-4.61 4.613c0 .29.02.51.08.984l.01.02.5-.06.03-.5c-3.17-.18-6.1-1.7-8.08-4.15l-.48-.56-.36.64c-.39.69-.62 1.48-.65 2.28.04 1.61.81 3.04 2.06 3.88l.3-.92c-.55-.02-1.11-.17-1.6-.45l-.59-.34-.14.67c-.02.08-.02.16 0 .24-.01 2.12 1.55 4.01 3.69 4.46l.1-.49-.1-.49c-.33.07-.67.12-1.03.14-.18-.02-.43-.05-.64-.07l-.76-.09.23.73c.57 1.84 2.29 3.14 4.28 3.21l-.28-.89a8.252 8.252 0 0 1-4.85 1.66c-.12-.01-.26-.02-.56-.05l-.17-.01-.18-.01L2.53 21l1.694 1.07a12.233 12.233 0 0 0 6.58 1.917c7.156 0 12.2-5.73 12.18-12.18l-.002.04z"/></svg></span></button></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconBlackPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon"  title="Share on Facebook" aria-label="Share on Facebook" data-action="share-on-facebook" data-action-source="post_share_widget"><span class="svgIcon svgIcon--facebook svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M16.39 23.61v-5.808h1.846a.55.55 0 0 0 .546-.48l.36-2.797a.551.551 0 0 0-.547-.62H16.39V12.67c0-.67.12-.813.828-.813h1.474a.55.55 0 0 0 .55-.55V8.803a.55.55 0 0 0-.477-.545c-.436-.06-1.36-.116-2.22-.116-2.5 0-4.13 1.62-4.13 4.248v1.513H10.56a.551.551 0 0 0-.55.55v2.797c0 .304.248.55.55.55h1.855v5.76c-4.172-.96-7.215-4.7-7.215-9.1 0-5.17 4.17-9.36 9.31-9.36 5.14 0 9.31 4.19 9.31 9.36 0 4.48-3.155 8.27-7.43 9.15M14.51 4C8.76 4 4.1 8.684 4.1 14.46c0 5.162 3.75 9.523 8.778 10.32a.55.55 0 0 0 .637-.543v-6.985a.551.551 0 0 0-.55-.55H11.11v-1.697h1.855a.55.55 0 0 0 .55-.55v-2.063c0-2.02 1.136-3.148 3.03-3.148.567 0 1.156.027 1.597.06v1.453h-.924c-1.363 0-1.93.675-1.93 1.912v1.78c0 .3.247.55.55.55h2.132l-.218 1.69H15.84c-.305 0-.55.24-.55.55v7.02c0 .33.293.59.623.54 5.135-.7 9.007-5.11 9.007-10.36C24.92 8.68 20.26 4 14.51 4"/></svg></span></button></li><li class="u-textAlignCenter"><button class="button button--large button--dark button--chromeless is-touchIconFadeInPulse u-baseColor--buttonDark button--withIcon button--withSvgIcon button--bookmark js-bookmarkButton"  title="Bookmark this story to read later" aria-label="Bookmark this story to read later" data-action="sign-in-prompt" data-sign-in-action="add-to-bookmarks" data-requires-token="true" data-redirect="https://medium.com/_/bookmark/p/6d742b80f040"><span class="button-defaultState"><span class="svgIcon svgIcon--bookmark svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4zM21 23l-5.91-3.955-.148-.107a.751.751 0 0 0-.884 0l-.147.107L8 23V6.615C8 5.725 8.725 5 9.615 5h9.77C20.275 5 21 5.725 21 6.615V23z" fill-rule="evenodd"/></svg></span></span><span class="button-activeState"><span class="svgIcon svgIcon--bookmarkFilled svgIcon--29px"><svg class="svgIcon-use" width="29" height="29" viewBox="0 0 29 29" ><path d="M19.385 4h-9.77A2.623 2.623 0 0 0 7 6.615V23.01a1.022 1.022 0 0 0 1.595.847l5.905-4.004 5.905 4.004A1.022 1.022 0 0 0 22 23.011V6.62A2.625 2.625 0 0 0 19.385 4z" fill-rule="evenodd"/></svg></span></span></button></li></ul></div></div><div class="u-fixed u-bottom0 u-sizeFullWidth u-backgroundWhite u-boxShadowTop u-borderBox u-paddingTop10 u-paddingBottom10 u-zIndexMetabar u-xs-paddingLeft10 u-xs-paddingRight10 js-stickyFooter"><div class="u-maxWidth700 u-marginAuto u-flexCenter"><div class="u-fontSize16 u-flex1 u-flexCenter"><div class="u-flex0 u-inlineBlock u-paddingRight20 u-xs-paddingRight10"><a class="link avatar avatar--roundedRectangle u-baseColor--link"  href="https://medium.com/airbnb-engineering" title="Go to Airbnb Engineering &amp; Data Science" aria-label="Go to Airbnb Engineering &amp; Data Science"><img src="https://cdn-images-1.medium.com/fit/c/40/40/1*MlNQKg-sieBGW5prWoe9HQ.jpeg" class="avatar-image avatar-image--smaller" alt="Airbnb Engineering &amp; Data Science"></a></div><div class="u-flex1 u-inlineBlock"><div class="u-xs-hide">Never miss a story from<strong> Airbnb Engineering &amp; Data Science</strong>, when you sign up for Medium. <a class="link link--accent u-accentColor--textNormal u-accentColor--textDarken u-baseColor--link"  href="https://medium.com/@Medium/personalize-your-medium-experience-with-users-publications-tags-26a41ab1ee0c#.hx4zuv3mg" data-action-source="sticky_footer">Learn more</a></div><div class="u-xs-show">Never miss a story from<strong> Airbnb Engineering &amp; Data Science</strong></div></div></div><div class="u-marginLeft50 u-xs-marginAuto"><button class="button button--primary button--dark is-active u-noUserSelect button--withChrome u-accentColor--buttonDark u-uiTextSemibold u-textUppercase u-fontSize12 button--followCollection js-followCollectionButton"  data-action="sign-in-prompt" data-sign-in-action="toggle-subscribe-collection" data-requires-token="true" data-redirect="https://medium.com/_/subscribe/collection/airbnb-engineering" data-action-source="sticky_footer_collection_follow"><span class="button-label  button-defaultState js-buttonLabel">Get updates</span><span class="button-label button-activeState">Get updates</span></button></div></div></div><style class="js-collectionStyle">
.u-accentColor--borderLight {border-color: #E04147 !important;}
.u-accentColor--borderNormal {border-color: #E04147 !important;}
.u-accentColor--borderDark {border-color: #BE3D40 !important;}
.u-accentColor--iconLight .svgIcon,.u-accentColor--iconLight.svgIcon {fill: #E04147 !important;}
.u-accentColor--iconNormal .svgIcon,.u-accentColor--iconNormal.svgIcon {fill: #E04147 !important;}
.u-accentColor--iconDark .svgIcon,.u-accentColor--iconDark.svgIcon {fill: #BE3D40 !important;}
.u-accentColor--textNormal {color: #BE3D40 !important;}
.u-accentColor--hoverTextNormal:hover {color: #BE3D40 !important;}
.u-accentColor--textNormal.u-accentColor--textDarken:hover {color: #AD3A3C !important;}
.u-accentColor--textDark {color: #AD3A3C !important;}
.u-accentColor--backgroundLight {background-color: #E04147 !important;}
.u-accentColor--backgroundNormal {background-color: #E04147 !important;}
.u-accentColor--backgroundDark {background-color: #BE3D40 !important;}
.u-accentColor--buttonDark {border-color: #BE3D40 !important; color: #AD3A3C !important;}
.u-accentColor--buttonDark:hover {border-color: #AD3A3C !important;}
.u-accentColor--buttonDark .icon:before,.u-accentColor--buttonDark .svgIcon{color: #BE3D40 !important; fill: #BE3D40 !important;}
.u-accentColor--buttonNormal {border-color: #E04147 !important; color: #BE3D40 !important;}
.u-accentColor--buttonNormal:hover {border-color: #BE3D40 !important;}
.u-accentColor--buttonNormal .icon:before,.u-accentColor--buttonNormal .svgIcon{color: #E04147 !important; fill: #E04147 !important;}
.u-accentColor--buttonNormal.button--filled .icon:before,.u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-accentColor--buttonDark.button--filled,.u-accentColor--buttonDark.button--withChrome.is-active,.u-accentColor--fillWhenActive.is-active {background-color: #BE3D40 !important; border-color: #BE3D40 !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-accentColor--buttonNormal.button--filled,.u-accentColor--buttonNormal.button--withChrome.is-active {background-color: #E04147 !important; border-color: #E04147 !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.postArticle.is-withAccentColors .markup--user,.postArticle.is-withAccentColors .markup--query {color: #BE3D40 !important;}.u-tintBgColor {background-color: rgba(255, 88, 91, 1) !important;}.u-tintBgColor .u-fadeLeft:before {background-image: linear-gradient(to right, rgba(255, 88, 91, 1) 0%, rgba(255, 88, 91, 0) 100%) !important;}.u-tintBgColor .u-fadeRight:after {background-image: linear-gradient(to right, rgba(255, 88, 91, 0) 0%, rgba(255, 88, 91, 1) 100%) !important;}
.u-tintSpectrum .u-baseColor--borderLight {border-color: #FFA7A2 !important;}
.u-tintSpectrum .u-baseColor--borderNormal {border-color: #FFC5C0 !important;}
.u-tintSpectrum .u-baseColor--borderDark {border-color: #FFE2DD !important;}
.u-tintSpectrum .u-baseColor--iconLight .svgIcon,.u-tintSpectrum .u-baseColor--iconLight.svgIcon {fill: #FFA7A2 !important;}
.u-tintSpectrum .u-baseColor--iconNormal .svgIcon,.u-tintSpectrum .u-baseColor--iconNormal.svgIcon {fill: #FFC5C0 !important;}
.u-tintSpectrum .u-baseColor--iconDark .svgIcon,.u-tintSpectrum .u-baseColor--iconDark.svgIcon {fill: #FFE2DD !important;}
.u-tintSpectrum .u-baseColor--textNormal {color: #FFC5C0 !important;}
.u-tintSpectrum .u-baseColor--textNormal.u-baseColor--textDarken:hover {color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--textDark {color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--backgroundLight {background-color: #FFA7A2 !important;}
.u-tintSpectrum .u-baseColor--backgroundNormal {background-color: #FFC5C0 !important;}
.u-tintSpectrum .u-baseColor--backgroundDark {background-color: #FFE2DD !important;}
.u-tintSpectrum .u-baseColor--buttonLight {border-color: #FFA7A2 !important; color: #FFA7A2 !important;}
.u-tintSpectrum .u-baseColor--buttonLight:hover {border-color: #FFA7A2 !important;}
.u-tintSpectrum .u-baseColor--buttonLight .icon:before,.u-tintSpectrum .u-baseColor--buttonLight .svgIcon {color: #FFA7A2 !important; fill: #FFA7A2 !important;}
.u-tintSpectrum .u-baseColor--buttonDark {border-color: #FFE2DD !important; color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--buttonDark:hover {border-color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--buttonDark .icon:before,.u-tintSpectrum .u-baseColor--buttonDark .svgIcon {color: #FFE2DD !important; fill: #FFE2DD !important;}
.u-tintSpectrum .u-baseColor--buttonNormal {border-color: #FFC5C0 !important; color: #FFC5C0 !important;}
.u-tintSpectrum .u-baseColor--buttonNormal:hover {border-color: #FFE2DD !important;}
.u-tintSpectrum .u-baseColor--buttonNormal .icon:before,.u-tintSpectrum .u-baseColor--buttonNormal .svgIcon {color: #FFC5C0 !important; fill: #FFC5C0 !important;}
.u-tintSpectrum .u-baseColor--buttonDark.button--filled,.u-tintSpectrum .u-baseColor--buttonDark.button--withChrome.is-active {background-color: #FFE2DD !important; border-color: #FFE2DD !important; color: rgba(255, 88, 91, 1) !important; fill: rgba(255, 88, 91, 1) !important;}
.u-tintSpectrum .u-baseColor--buttonNormal.button--filled,.u-tintSpectrum .u-baseColor--buttonNormal.button--withChrome.is-active {background-color: #FFC5C0 !important; border-color: #FFC5C0 !important; color: rgba(255, 88, 91, 1) !important; fill: rgba(255, 88, 91, 1) !important;}
.u-tintSpectrum .u-baseColor--link {color: #FFC5C0 !important;}
.u-tintSpectrum .u-baseColor--link.link--darkenOnHover:hover {color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--link.link--darken:hover,.u-tintSpectrum .u-baseColor--link.link--darken:focus,.u-tintSpectrum .u-baseColor--link.link--darken:active {color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--link.link--dark {color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--link.link--dark.link--darken:hover,.u-tintSpectrum .u-baseColor--link.link--dark.link--darken:focus,.u-tintSpectrum .u-baseColor--link.link--dark.link--darken:active {color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--link.link--darker {color: #FFF0EC !important;}
.u-tintSpectrum .u-baseColor--placeholderNormal ::-webkit-input-placeholder {color: #FFA7A2;}
.u-tintSpectrum .u-baseColor--placeholderNormal ::-moz-placeholder {color: #FFA7A2;}
.u-tintSpectrum .u-baseColor--placeholderNormal :-ms-input-placeholder {color: #FFA7A2;}
.u-tintSpectrum .svgIcon--logoNew path:nth-child(1) {stroke: none !important; fill: #FF7977 !important;}
.u-tintSpectrum .svgIcon--logoNew path:nth-child(2) {stroke: none !important; fill: #FF8985 !important;}
.u-tintSpectrum .svgIcon--logoNew path:nth-child(3) {stroke: none !important; fill: #FFA7A2 !important;}
.u-tintSpectrum .svgIcon--logoNew path:nth-child(4) {stroke: none !important; fill: #FFC5C0 !important;}
.u-tintSpectrum .u-accentColor--borderLight {border-color: #FFA7A2 !important;}
.u-tintSpectrum .u-accentColor--borderNormal {border-color: #FFC5C0 !important;}
.u-tintSpectrum .u-accentColor--borderDark {border-color: #FFE2DD !important;}
.u-tintSpectrum .u-accentColor--iconLight .svgIcon,.u-tintSpectrum .u-accentColor--iconLight.svgIcon {fill: #FFA7A2 !important;}
.u-tintSpectrum .u-accentColor--iconNormal .svgIcon,.u-tintSpectrum .u-accentColor--iconNormal.svgIcon {fill: #FFC5C0 !important;}
.u-tintSpectrum .u-accentColor--iconDark .svgIcon,.u-tintSpectrum .u-accentColor--iconDark.svgIcon {fill: #FFE2DD !important;}
.u-tintSpectrum .u-accentColor--textNormal {color: #FFC5C0 !important;}
.u-tintSpectrum .u-accentColor--hoverTextNormal:hover {color: #FFC5C0 !important;}
.u-tintSpectrum .u-accentColor--textNormal.u-accentColor--textDarken:hover {color: #FFF0EC !important;}
.u-tintSpectrum .u-accentColor--textDark {color: #FFF0EC !important;}
.u-tintSpectrum .u-accentColor--backgroundLight {background-color: #FFA7A2 !important;}
.u-tintSpectrum .u-accentColor--backgroundNormal {background-color: #FFC5C0 !important;}
.u-tintSpectrum .u-accentColor--backgroundDark {background-color: #FFE2DD !important;}
.u-tintSpectrum .u-accentColor--buttonDark {border-color: #FFE2DD !important; color: #FFF0EC !important;}
.u-tintSpectrum .u-accentColor--buttonDark:hover {border-color: #FFF0EC !important;}
.u-tintSpectrum .u-accentColor--buttonDark .icon:before,.u-tintSpectrum .u-accentColor--buttonDark .svgIcon{color: #FFE2DD !important; fill: #FFE2DD !important;}
.u-tintSpectrum .u-accentColor--buttonNormal {border-color: #FFC5C0 !important; color: #FFC5C0 !important;}
.u-tintSpectrum .u-accentColor--buttonNormal:hover {border-color: #FFE2DD !important;}
.u-tintSpectrum .u-accentColor--buttonNormal .icon:before,.u-tintSpectrum .u-accentColor--buttonNormal .svgIcon{color: #FFC5C0 !important; fill: #FFC5C0 !important;}
.u-tintSpectrum .u-accentColor--buttonNormal.button--filled .icon:before,.u-tintSpectrum .u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(255, 88, 91, 1) !important; fill: rgba(255, 88, 91, 1) !important;}
.u-tintSpectrum .u-accentColor--buttonDark.button--filled,.u-tintSpectrum .u-accentColor--buttonDark.button--withChrome.is-active,.u-tintSpectrum .u-accentColor--fillWhenActive.is-active {background-color: #FFE2DD !important; border-color: #FFE2DD !important; color: rgba(255, 88, 91, 1) !important; fill: rgba(255, 88, 91, 1) !important;}
.u-tintSpectrum .u-accentColor--buttonNormal.button--filled,.u-tintSpectrum .u-accentColor--buttonNormal.button--withChrome.is-active {background-color: #FFC5C0 !important; border-color: #FFC5C0 !important; color: rgba(255, 88, 91, 1) !important; fill: rgba(255, 88, 91, 1) !important;}
.u-tintSpectrum .postArticle.is-withAccentColors .markup--user,.u-tintSpectrum .postArticle.is-withAccentColors .markup--query {color: #FFC5C0 !important;}
.u-accentColor--highlightFaint {background-color: rgba(255, 219, 215, 1) !important;}
.u-accentColor--highlightStrong.is-active .svgIcon {fill: rgba(255, 170, 165, 1) !important;}
.postArticle.is-withAccentColors .markup--quote.is-other {background-color: rgba(255, 219, 215, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-other {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 219, 215, 1), rgba(255, 219, 215, 1));}
.postArticle.is-withAccentColors .markup--quote.is-me {background-color: rgba(255, 192, 187, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-me {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 192, 187, 1), rgba(255, 192, 187, 1));}
.postArticle.is-withAccentColors .markup--quote.is-targeted {background-color: rgba(255, 170, 165, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-targeted {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 170, 165, 1), rgba(255, 170, 165, 1));}
.postArticle.is-withAccentColors .markup--quote.is-selected {background-color: rgba(255, 170, 165, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--quote.is-selected {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 170, 165, 1), rgba(255, 170, 165, 1));}
.postArticle.is-withAccentColors .markup--highlight {background-color: rgba(255, 170, 165, 1) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .markup--highlight {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 170, 165, 1), rgba(255, 170, 165, 1));}</style><style class="js-collectionStyleConstant">.u-imageBgColor {background-color: rgba(0, 0, 0, 0.24705882352941178);}
.u-imageSpectrum .u-baseColor--borderLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-baseColor--borderNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-baseColor--borderDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--iconLight .svgIcon,.u-imageSpectrum .u-baseColor--iconLight.svgIcon {fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--iconNormal .svgIcon,.u-imageSpectrum .u-baseColor--iconNormal.svgIcon {fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--iconDark .svgIcon,.u-imageSpectrum .u-baseColor--iconDark.svgIcon {fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--textNormal {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--textNormal.u-baseColor--textDarken:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--textDark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--backgroundLight {background-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-baseColor--backgroundNormal {background-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--backgroundDark {background-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important; color: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--buttonLight:hover {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-baseColor--buttonLight .icon:before,.u-imageSpectrum .u-baseColor--buttonLight .svgIcon {color: rgba(255, 255, 255, 0.8) !important; fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-baseColor--buttonDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonDark:hover {border-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonDark .icon:before,.u-imageSpectrum .u-baseColor--buttonDark .svgIcon {color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important; color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal:hover {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal .icon:before,.u-imageSpectrum .u-baseColor--buttonNormal .svgIcon {color: rgba(255, 255, 255, 0.9490196078431372) !important; fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--buttonDark.button--filled,.u-imageSpectrum .u-baseColor--buttonDark.button--withChrome.is-active {background-color: rgba(255, 255, 255, 1) !important; border-color: rgba(255, 255, 255, 1) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-baseColor--buttonNormal.button--filled,.u-imageSpectrum .u-baseColor--buttonNormal.button--withChrome.is-active {background-color: rgba(255, 255, 255, 0.9490196078431372) !important; border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-baseColor--link {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-baseColor--link.link--darkenOnHover:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--darken:hover,.u-imageSpectrum .u-baseColor--link.link--darken:focus,.u-imageSpectrum .u-baseColor--link.link--darken:active {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--dark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:hover,.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:focus,.u-imageSpectrum .u-baseColor--link.link--dark.link--darken:active {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--link.link--darker {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-baseColor--placeholderNormal ::-webkit-input-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .u-baseColor--placeholderNormal ::-moz-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .u-baseColor--placeholderNormal :-ms-input-placeholder {color: rgba(255, 255, 255, 0.8);}
.u-imageSpectrum .svgIcon--logoNew path:nth-child(1) {stroke: none !important; fill: rgba(255, 255, 255, 0.4) !important;}
.u-imageSpectrum .svgIcon--logoNew path:nth-child(2) {stroke: none !important; fill: rgba(255, 255, 255, 0.4980392156862745) !important;}
.u-imageSpectrum .svgIcon--logoNew path:nth-child(3) {stroke: none !important; fill: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .svgIcon--logoNew path:nth-child(4) {stroke: none !important; fill: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-accentColor--borderLight {border-color: rgba(255, 255, 255, 0.6980392156862745) !important;}
.u-imageSpectrum .u-accentColor--borderNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-accentColor--borderDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--iconLight .svgIcon,.u-imageSpectrum .u-accentColor--iconLight.svgIcon {fill: rgba(255, 255, 255, 0.8) !important;}
.u-imageSpectrum .u-accentColor--iconNormal .svgIcon,.u-imageSpectrum .u-accentColor--iconNormal.svgIcon {fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--iconDark .svgIcon,.u-imageSpectrum .u-accentColor--iconDark.svgIcon {fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--textNormal {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--hoverTextNormal:hover {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--textNormal.u-accentColor--textDarken:hover {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--textDark {color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--backgroundLight {background-color: rgba(255, 255, 255, 0.8980392156862745) !important;}
.u-imageSpectrum .u-accentColor--backgroundNormal {background-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--backgroundDark {background-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark {border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark:hover {border-color: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonDark .icon:before,.u-imageSpectrum .u-accentColor--buttonDark .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal {border-color: rgba(255, 255, 255, 0.8980392156862745) !important; color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal:hover {border-color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal .icon:before,.u-imageSpectrum .u-accentColor--buttonNormal .svgIcon{color: rgba(255, 255, 255, 0.9490196078431372) !important; fill: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal.button--filled .icon:before,.u-imageSpectrum .u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-accentColor--buttonDark.button--filled,.u-imageSpectrum .u-accentColor--buttonDark.button--withChrome.is-active,.u-imageSpectrum .u-accentColor--fillWhenActive.is-active {background-color: rgba(255, 255, 255, 1) !important; border-color: rgba(255, 255, 255, 1) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .u-accentColor--buttonNormal.button--filled,.u-imageSpectrum .u-accentColor--buttonNormal.button--withChrome.is-active {background-color: rgba(255, 255, 255, 0.9490196078431372) !important; border-color: rgba(255, 255, 255, 0.9490196078431372) !important; color: rgba(0, 0, 0, 0.24705882352941178) !important; fill: rgba(0, 0, 0, 0.24705882352941178) !important;}
.u-imageSpectrum .postArticle.is-withAccentColors .markup--user,.u-imageSpectrum .postArticle.is-withAccentColors .markup--query {color: rgba(255, 255, 255, 0.9490196078431372) !important;}
.u-imageSpectrum .u-accentColor--highlightFaint {background-color: rgba(255, 255, 255, 0.2) !important;}
.u-imageSpectrum .u-accentColor--highlightStrong.is-active .svgIcon {fill: rgba(255, 255, 255, 0.6) !important;}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-other {background-color: rgba(255, 255, 255, 0.2) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-other {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.2));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-me {background-color: rgba(255, 255, 255, 0.4) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-me {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.4));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-targeted {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-targeted {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-selected {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--quote.is-selected {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}
.postArticle.is-withAccentColors .u-imageSpectrum .markup--highlight {background-color: rgba(255, 255, 255, 0.6) !important;}
body.is-withMagicUnderlines .postArticle.is-withAccentColors .u-imageSpectrum .markup--highlight {background-color: transparent !important; background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));}.u-resetSpectrum .u-tintBgColor {background-color: rgba(255, 255, 255, 1) !important;}.u-resetSpectrum .u-tintBgColor .u-fadeLeft:before {background-image: linear-gradient(to right, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0) 100%) !important;}.u-resetSpectrum .u-tintBgColor .u-fadeRight:after {background-image: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100%) !important;}
.u-resetSpectrum .u-baseColor--borderLight {border-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--borderNormal {border-color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--borderDark {border-color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--iconLight .svgIcon,.u-resetSpectrum .u-baseColor--iconLight.svgIcon {fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--iconNormal .svgIcon,.u-resetSpectrum .u-baseColor--iconNormal.svgIcon {fill: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--iconDark .svgIcon,.u-resetSpectrum .u-baseColor--iconDark.svgIcon {fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--textNormal {color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--textNormal.u-baseColor--textDarken:hover {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--textDark {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--backgroundLight {background-color: rgba(0, 0, 0, 0.09803921568627451) !important;}
.u-resetSpectrum .u-baseColor--backgroundNormal {background-color: rgba(0, 0, 0, 0.2) !important;}
.u-resetSpectrum .u-baseColor--backgroundDark {background-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight {border-color: rgba(0, 0, 0, 0.2980392156862745) !important; color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight:hover {border-color: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonLight .icon:before,.u-resetSpectrum .u-baseColor--buttonLight .svgIcon {color: rgba(0, 0, 0, 0.2980392156862745) !important; fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonDark {border-color: rgba(0, 0, 0, 0.6) !important; color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonDark:hover {border-color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--buttonDark .icon:before,.u-resetSpectrum .u-baseColor--buttonDark .svgIcon {color: rgba(0, 0, 0, 0.6) !important; fill: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal {border-color: rgba(0, 0, 0, 0.4980392156862745) !important; color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal:hover {border-color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal .icon:before,.u-resetSpectrum .u-baseColor--buttonNormal .svgIcon {color: rgba(0, 0, 0, 0.4980392156862745) !important; fill: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--buttonDark.button--filled,.u-resetSpectrum .u-baseColor--buttonDark.button--withChrome.is-active {background-color: rgba(0, 0, 0, 0.2980392156862745) !important; border-color: rgba(0, 0, 0, 0.2980392156862745) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-baseColor--buttonNormal.button--filled,.u-resetSpectrum .u-baseColor--buttonNormal.button--withChrome.is-active {background-color: rgba(0, 0, 0, 0.2) !important; border-color: rgba(0, 0, 0, 0.2) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-baseColor--link {color: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-baseColor--link.link--darkenOnHover:hover {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--darken:hover,.u-resetSpectrum .u-baseColor--link.link--darken:focus,.u-resetSpectrum .u-baseColor--link.link--darken:active {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--dark {color: rgba(0, 0, 0, 0.6) !important;}
.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:hover,.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:focus,.u-resetSpectrum .u-baseColor--link.link--dark.link--darken:active {color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--link.link--darker {color: rgba(0, 0, 0, 0.8) !important;}
.u-resetSpectrum .u-baseColor--placeholderNormal ::-webkit-input-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .u-baseColor--placeholderNormal ::-moz-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .u-baseColor--placeholderNormal :-ms-input-placeholder {color: rgba(0, 0, 0, 0.2980392156862745);}
.u-resetSpectrum .svgIcon--logoNew path:nth-child(1) {stroke: none !important; fill: rgba(0, 0, 0, 0.2) !important;}
.u-resetSpectrum .svgIcon--logoNew path:nth-child(2) {stroke: none !important; fill: rgba(0, 0, 0, 0.2980392156862745) !important;}
.u-resetSpectrum .svgIcon--logoNew path:nth-child(3) {stroke: none !important; fill: rgba(0, 0, 0, 0.4) !important;}
.u-resetSpectrum .svgIcon--logoNew path:nth-child(4) {stroke: none !important; fill: rgba(0, 0, 0, 0.4980392156862745) !important;}
.u-resetSpectrum .u-accentColor--borderLight {border-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--borderNormal {border-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--borderDark {border-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--iconLight .svgIcon,.u-resetSpectrum .u-accentColor--iconLight.svgIcon {fill: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--iconNormal .svgIcon,.u-resetSpectrum .u-accentColor--iconNormal.svgIcon {fill: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--iconDark .svgIcon,.u-resetSpectrum .u-accentColor--iconDark.svgIcon {fill: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--textNormal {color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--hoverTextNormal:hover {color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--textNormal.u-accentColor--textDarken:hover {color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--textDark {color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundLight {background-color: rgba(2, 184, 117, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundNormal {background-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--backgroundDark {background-color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark {border-color: rgba(0, 171, 107, 1) !important; color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark:hover {border-color: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark .icon:before,.u-resetSpectrum .u-accentColor--buttonDark .svgIcon{color: rgba(28, 153, 99, 1) !important; fill: rgba(28, 153, 99, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal {border-color: rgba(2, 184, 117, 1) !important; color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal:hover {border-color: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal .icon:before,.u-resetSpectrum .u-accentColor--buttonNormal .svgIcon{color: rgba(0, 171, 107, 1) !important; fill: rgba(0, 171, 107, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal.button--filled .icon:before,.u-resetSpectrum .u-accentColor--buttonNormal.button--filled .svgIcon{color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonDark.button--filled,.u-resetSpectrum .u-accentColor--buttonDark.button--withChrome.is-active,.u-resetSpectrum .u-accentColor--fillWhenActive.is-active {background-color: rgba(28, 153, 99, 1) !important; border-color: rgba(28, 153, 99, 1) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .u-accentColor--buttonNormal.button--filled,.u-resetSpectrum .u-accentColor--buttonNormal.button--withChrome.is-active {background-color: rgba(0, 171, 107, 1) !important; border-color: rgba(0, 171, 107, 1) !important; color: rgba(255, 255, 255, 1) !important; fill: rgba(255, 255, 255, 1) !important;}
.u-resetSpectrum .postArticle.is-withAccentColors .markup--user,.u-resetSpectrum .postArticle.is-withAccentColors .markup--query {color: rgba(0, 171, 107, 1) !important;}</style></div></div></div><div class="loadingBar"></div><script>// <![CDATA[
window["obvInit"] = function (opt_embedded) {window["obvInit"]["embedded"] = opt_embedded; window["obvInit"]["ready"] = true;}
// ]]></script><script>// <![CDATA[
var GLOBALS = {"audioUrl":"https://d1fcbxp97j4nb2.cloudfront.net","baseUrl":"https://medium.com","buildLabel":"28586-6143d83","currentUser":{"userId":"lo_ef9687d53417","isVerified":false,"subscriberEmail":""},"currentUserHasUnverifiedEmail":false,"isAuthenticated":false,"isCurrentUserVerified":false,"mediumTwitterScreenName":"medium","miroUrl":"https://cdn-images-1.medium.com","moduleUrls":{"base":"https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.2nXtJ8XknWJqOjh2ZNHRVw.js","notes":"https://cdn-static-1.medium.com/_/fp/gen-js/main-notes.bundle.AouowiblLn4SBKZF6cWDtA.js","posters":"https://cdn-static-1.medium.com/_/fp/gen-js/main-posters.bundle.4rYp3nph7xNXmlmak5XWxQ.js","common-async":"https://cdn-static-1.medium.com/_/fp/gen-js/main-common-async.bundle.R35emyz9xZL7YdHbIl-SvQ.js","stats":"https://cdn-static-1.medium.com/_/fp/gen-js/main-stats.bundle.XUyD-cfC9DG2nc9iq5x7GA.js","home-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-home-screens.bundle.0oM8iNH9LgWeJY00O_ao2Q.js","misc-screens":"https://cdn-static-1.medium.com/_/fp/gen-js/main-misc-screens.bundle.caQfKUCZ18Wg2IbFBoaXiA.js"},"previewConfig":{"weightThreshold":1,"weightImageParagraph":0.51,"weightIframeParagraph":0.8,"weightTextParagraph":0.08,"weightEmptyParagraph":0,"weightP":0.003,"weightH":0.005,"weightBq":0.003,"minPTextLength":60,"truncateBoundaryChars":20,"detectTitle":true,"detectTitleLevThreshold":0.15},"productName":"Medium","supportsEdit":false,"termsUrl":"//medium.com/policy/9db0094a1e0f","textshotHost":"textshot.medium.com","transactionId":"1492157151903:52f7fad216d9","useragent":{"browser":"python requests","family":"","os":"","version":2.2,"supportsDesktopEdit":false,"supportsInteract":false,"supportsView":true,"isMobile":false,"isTablet":false,"isNative":false,"supportsFileAPI":false,"isTier1":false,"clientVersion":"","unknownParagraphsBad":false,"clientChannel":"","supportsRealScrollEvents":false,"supportsVhUnits":false,"ruinsViewportSections":false,"supportsHtml5Video":false,"supportsMagicUnderlines":false,"isWebView":false,"isFacebookWebView":false,"supportsProgressiveMedia":false,"supportsPromotedPosts":true,"isBot":false,"isNativeIphone":false,"supportsCssVariables":false,"supportsScrollableMetabar":false},"variants":{"allow_access":true,"allow_signup":true,"allow_test_auth":"disallow","signin_services":"twitter,facebook,google,email,google-fastidv","signup_services":"twitter,facebook,google,email,google-fastidv","android_rating_prompt_recommend_threshold":5,"google_sign_in_android":true,"enable_onboarding":true,"ios_custom_miro_url":"https://cdn-images-1.medium.com","reengagement_notification_duration":3,"browsable_stream_config_bucket":"curated-topics","ios_small_post_preview_truncation_length":5.5,"ios_large_post_preview_truncation_length":5.5,"disable_ios_catalog_badging":true,"enable_series_creation":true,"enable_your_series_pages":true,"enable_productionized_series":true,"enable_dedicated_series_tab_api_ios":true,"enable_clap_milestone_notifications":true,"enable_series_stats_page":true,"enable_prepublish_share_settings":true,"enable_direct_auth_connect":true,"enable_post_import":true,"enable_sponsored_post_labelling":true,"enable_logged_in_follow_on_collection_post":true,"promoted_story_placement_locations":"POST_PAGE_FOOTER","show_topics":true,"enable_search_collection_by_tag_recency_filter":true,"search_collection_by_tag_filter_min_votes":10,"enable_sms_app_promo":true,"enable_export_members":true,"enable_series_card_background_creation":true,"can_see_subscription_branding":true,"enable_subscriptions_landing_page":true,"enable_partner_program_landing_page":true,"enable_hide_broken_links":true,"enable_pay_for_custom_domain":true,"enable_promos_from_dynamo":true,"enable_promos_in_placement":true,"enable_series_promo_in_email":true,"enable_sms":true,"enable_series_in_user_profiles":true,"enable_new_logged_out_bento_operation":true,"enable_topic_brief_relations":true},"xsrfToken":"","iosAppId":"828256236","supportEmail":"yourfriends@medium.com","teamName":"Team Medium","fp":{"/icons/favicon.svg":"https://cdn-static-1.medium.com/_/fp/icons/favicon.KjTfUJo7yJH_fCoUzzH3cg.svg","/icons/favicon-dev-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-dev-editor.YKKRxBO8EMvIqhyCwIiJeQ.ico","/icons/favicon-hatch-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-hatch-editor.BuEyHIqlyh2s_XEk4Rl32Q.ico","/icons/favicon-medium-editor.ico":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrl":"https://medium.com","imageUploadSizeMb":25,"isAuthDomainRequest":true,"algoliaApiEndpoint":"https://MQ57UUUQZ2-dsn.algolia.net","algoliaAppId":"MQ57UUUQZ2","algoliaSearchOnlyApiKey":"394474ced050e3911ae2249ecc774921","iosAppStoreUrl":"https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&mt=8","iosAppLinkBaseUrl":"medium:","algoliaIndexPrefix":"medium_","androidPlayStoreUrl":"https://play.google.com/store/apps/details?id=com.medium.reader","googleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","androidPackage":"com.medium.reader","androidPlayStoreMarketScheme":"market://details?id=com.medium.reader","googleAuthUri":"https://accounts.google.com/o/oauth2/auth","androidScheme":"medium","layoutData":{"useDynamicScripts":false,"googleAnalyticsTrackingCode":"UA-24232453-2","jsShivUrl":"https://cdn-static-1.medium.com/_/fp/js/shiv.RI2ePTZ5gFmMgLzG5bEVAA.js","useDynamicCss":false,"faviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium.TAS6uQ-Y7kcKgi0xjcYHXw.ico","faviconImageId":"1*W0nmth_X8nFKjn6BZ388UQ.png","fontSets":[{"id":1,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-base.by5Oi_VbnwEIvhnWIsuUjA.css"},{"id":4,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-lazy-base.g08Jj5TZPAiuPWj5YNUsSg.css"},{"id":6,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-latin-base.141WxxXgxGxNcfeza73H7Q.css"},{"id":7,"url":"https://cdn-static-1.medium.com/_/fp/css/fonts-lazy-latin-base.jMU532QDmysQMOINr-cr2A.css"}],"editorFaviconUrl":"https://cdn-static-1.medium.com/_/fp/icons/favicon-medium-editor.PiakrZWB7Yb80quUVQWM6g.ico"},"authBaseUrlRev":"moc.muidem//:sptth","isDnt":false,"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","archiveUploadSizeMb":100,"paymentData":{"currencies":{"1":{"label":"US Dollar","external":"usd"}},"countries":{"1":{"label":"United States of America","external":"US"}},"accountTypes":{"1":{"label":"Individual","external":"individual"},"2":{"label":"Company","external":"company"}}},"previewConfig2":{"weightThreshold":1,"weightImageParagraph":0.05,"raiseImage":true,"enforceHeaderHierarchy":true,"isImageInsetRight":true},"isAmp":false,"iosScheme":"medium","isSwBoot":false,"lightstep":{"accessToken":"ce5be895bef60919541332990ac9fef2","carrier":"{\"ot-tracer-spanid\":\"633944643f0f482b\",\"ot-tracer-traceid\":\"1b09e916522d46d1\",\"ot-tracer-sampled\":\"true\"}","host":"collector-medium.lightstep.com"},"facebook":{"key":"542599432471018","secret":"c14df7146e9052a1131f3c900c1f0644","token":"542599432471018|1JqjIwxSfY9jOt_KwjWEl1R7T6I","namespace":"medium-com","scope":{"default":["public_profile","email","user_friends"],"connect":["public_profile","email","user_friends"],"login":["public_profile","email","user_friends"],"share":["public_profile","email","user_friends","publish_actions"]},"smartPublishWhitelistedPublications":["bcc38c8f6edf","f3726e2a5878","828a270689e","81c7d351c056","f30e42fd7ff8","8bf1d7d3081b","d16afa0ae7c","d8f3f6ad9c31","e74de0cedea9","15f753907972","c8c6a6b01ebd","3412b9729488","2ce4bbcf83bb","544c7006046e","7bfcdbc6b30a","a268fd916824","458a773bccd2"],"instantArticles":{"published":true,"developmentMode":false}},"mailingListArchiveUploadSizeMb":2,"availableMembershipPlans":[],"editorsPicksTopicId":"3985d2a191c5","popularOnMediumTopicId":"9d34e48ecf94","memberContentTopicId":"13d7efd82fb2","isDoNotAuth":false,"goldfinchUrl":"https://goldfinch.medium.com"}
// ]]></script><script charset="UTF-8" src="https://cdn-static-1.medium.com/_/fp/gen-js/main-base.bundle.2nXtJ8XknWJqOjh2ZNHRVw.js" async></script><script>// <![CDATA[
window["obvInit"]({"value":{"id":"6d742b80f040","versionId":"ee5122a2b93e","creatorId":"d701357ebd99","creator":{"userId":"d701357ebd99","name":"Alice Liang","username":"sanitycannon","createdAt":1451753267327,"lastPostCreatedAt":1489524500468,"imageId":"0*RcWkrH0w7euJvJ-A.jpg","backgroundImageId":"","bio":"software engineer at Airbnb","twitterScreenName":"","socialStats":{"userId":"d701357ebd99","usersFollowedCount":156,"usersFollowedByCount":324,"type":"SocialStats"},"social":{"userId":"lo_9f9742b1b1f3","targetUserId":"d701357ebd99","type":"Social"},"facebookAccountId":"2851866929841","allowNotes":1,"type":"User"},"homeCollection":{"id":"53c7c27702d5","name":"Airbnb Engineering & Data Science","slug":"airbnb-engineering","tags":["DATA SCIENCE","WEB DEVELOPMENT","OPEN SOURCE"],"creatorId":"ebe93072cafd","description":"Creative engineers and data scientists building a world where you can belong anywhere. http://airbnb.io","shortDescription":"Creative engineers and data scientists building a world…","image":{"imageId":"1*MlNQKg-sieBGW5prWoe9HQ.jpeg","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":9730,"postCount":24,"activeAt":1490122513650},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":""},"logo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"twitterUsername":"AirbnbEng","facebookPageName":"airbnbeng","collectionMastheadId":"7e48cc52dce0","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Airbnb Engineering & Data Science","description":"","backgroundImage":{},"logoImage":{},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":4,"postIds":["6d742b80f040","4ff4a0afac0e","e8619e3e5043","43ebfc99b324"]}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":3,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":4,"layout":5,"number":5,"postIds":[],"tagSlug":"Open Source","sectionHeader":"Open Source"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Data Science","sectionHeader":"Data Science"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Frontend","sectionHeader":"Frontend"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Payments","sectionHeader":"Payments"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[]}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[],"sectionHeader":"Latest"}}],"tintColor":"#FFFF585B","lightText":true,"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FFE04147","point":0},{"color":"#FFCF4044","point":0.1},{"color":"#FFBE3D40","point":0.2},{"color":"#FFAD3A3C","point":0.3},{"color":"#FF9B3737","point":0.4},{"color":"#FF893232","point":0.5},{"color":"#FF772D2D","point":0.6},{"color":"#FF652827","point":0.7},{"color":"#FF522120","point":0.8},{"color":"#FF3F1918","point":0.9},{"color":"#FF2B1010","point":1}],"backgroundColor":"#FFFFFFFF"},"tintBackgroundSpectrum":{"colorPoints":[{"color":"#FFFF585B","point":0},{"color":"#FFFF6969","point":0.1},{"color":"#FFFF7977","point":0.2},{"color":"#FFFF8985","point":0.3},{"color":"#FFFF9894","point":0.4},{"color":"#FFFFA7A2","point":0.5},{"color":"#FFFFB6B1","point":0.6},{"color":"#FFFFC5C0","point":0.7},{"color":"#FFFFD3CF","point":0.8},{"color":"#FFFFE2DD","point":0.9},{"color":"#FFFFF0EC","point":1}],"backgroundColor":"#FFFF585B"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFE0DC","point":0},{"color":"#FFFFDBD7","point":0.1},{"color":"#FFFFD6D1","point":0.2},{"color":"#FFFFD1CC","point":0.3},{"color":"#FFFFCBC6","point":0.4},{"color":"#FFFFC6C1","point":0.5},{"color":"#FFFFC0BB","point":0.6},{"color":"#FFFFBBB5","point":0.7},{"color":"#FFFFB5B0","point":0.8},{"color":"#FFFFAFAB","point":0.9},{"color":"#FFFFAAA5","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":1,"title":"Data Science","tagSlug":"data-science","url":"https://medium.com/airbnb-engineering/tagged/data-science","source":"tagSlug"},{"type":1,"title":"Open Source","tagSlug":"open-source","url":"https://medium.com/airbnb-engineering/tagged/open-source","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/airbnb-engineering/tagged/machine-learning","source":"tagSlug"},{"type":1,"title":"Payments","tagSlug":"payments","url":"https://medium.com/airbnb-engineering/tagged/payments","source":"tagSlug"},{"type":1,"title":"Security","tagSlug":"security","url":"https://medium.com/airbnb-engineering/tagged/security","source":"tagSlug"},{"type":1,"title":"Mobile","tagSlug":"mobile","url":"https://medium.com/airbnb-engineering/tagged/mobile","source":"tagSlug"}],"colorBehavior":2,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Airbnb Engineering & Data Science","description":"","backgroundImage":{},"logoImage":{},"alignment":2,"layout":5},"type":"Collection"},"homeCollectionId":"53c7c27702d5","title":"Tracking the Money — Scaling Financial Reporting at Airbnb","detectedLanguage":"en","latestVersion":"ee5122a2b93e","latestPublishedVersion":"ee5122a2b93e","hasUnpublishedEdits":false,"latestRev":805,"createdAt":1489524500468,"updatedAt":1489740445340,"acceptedAt":0,"firstPublishedAt":1489685296089,"latestPublishedAt":1489740445340,"vote":false,"experimentalCss":"","displayAuthor":"","content":{"subtitle":"At Airbnb, the Payments team is responsible for everything related to moving money in Airbnb’s global marketplace. We build technology that…","bodyModel":{"paragraphs":[{"name":"3de6","type":3,"text":"Tracking the Money — Scaling Financial Reporting at Airbnb","markups":[]},{"name":"4da4","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*2F3AL1MjQLNFM39Lt5abjg.png","originalWidth":848,"originalHeight":340}},{"name":"2f18","type":1,"text":"At Airbnb, the Payments team is responsible for everything related to moving money in Airbnb’s global marketplace. We build technology that powers Airbnb’s massive daily transaction volume to collect payments from guests and distribute payouts to hosts. Our goal is to make the payment experience on Airbnb delightful, magical, and intuitive.","markups":[]},{"name":"8608","type":1,"text":"Historically, the payments team’s focus was to implement new features, currencies, and payment methods to make payments local in a global business. Our sphere has grown to include compliance (sales taxes, earnings taxes, licenses, and more) as well as reconciliation and financial accounting according to generally accepted accounting principles.","markups":[{"type":3,"start":0,"end":146,"href":"https://medium.com/airbnb-engineering/scaling-airbnbs-payment-platform-43ebfc99b324#.3gu3yi77b","title":"","rel":"","anchorType":0}]},{"name":"e62f","type":1,"text":"Currently, Airbnb’s payment and financial accounting system is a complex ecosystem that transacts in 191 countries, with 70+ currencies and 20+ processors. Not only has Airbnb’s transaction volume experienced exponential transaction growth every year, we have also rapidly increased features and products on our platform. Airbnb hopes to become a premier end-to-end travel service, not only helping people with accommodations but also trip experiences as well.","markups":[{"type":3,"start":435,"end":451,"href":"https://www.airbnb.com/experiences","title":"","rel":"","anchorType":0}]},{"name":"dc5d","type":1,"text":"The challenge to maintain the existing financial accounting system to support new products as well as the increasing data volume has become a “mission impossible” sort of a task.","markups":[]},{"name":"575d","type":1,"text":"Airbnb’s Finance Infrastructure engineering team is responsible for delivering accurate, reliable, and comprehensive business/financial data to our stakeholders. In this blog post, we’ll talk about how we manage to keep track of where all of our money is and how it moves in a scalable way in the face of exploding data size and complexity, as well as to support new Airbnb initiatives and payment products. We’ll share the workflow of our deprecated finance system, illustrate its challenges and issues and then describe the new system that we built to replace it.","markups":[]},{"name":"a4ac","type":3,"text":"The prior financial system: a MySQL-based data pipeline","markups":[]},{"name":"991e","type":1,"text":"Built in early 2012 and retired in late 2016, our previous financial system was a MySQL data pipeline. It was a parameterized MySQL ETL that ran nightly to provide financial reporting, and served us faithfully for the past few years. The workflow was as follows:","markups":[]},{"name":"453c","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*EzX1NLoTGNYuhtd46QxzUQ.jpeg","originalWidth":532,"originalHeight":103}},{"name":"f776","type":9,"text":"We enabled MySQL database triggers for all our main tables to be able to capture each change to Airbnb reservation and payment records as they happen in real time on a per row basis. This way, we enforced immutability, and ensured all financially relevant events would be captured. This was meant to be a temporary solution to deal with the inherent mutability of the production data. We acknowledge that it wasn’t a great pattern, but it was necessary at the time.","markups":[{"type":3,"start":11,"end":34,"href":"http://dev.mysql.com/doc/refman/5.7/en/triggers.html","title":"","rel":"","anchorType":0}]},{"name":"a9f3","type":9,"text":"By being able to replay the history of events with database triggers, we built a set of intermediate helper tables that assist in calculating different reports. For example, we kept track of recognized revenue, guest receivables, future host payouts (liabilities), and other essential components of financial reporting.","markups":[]},{"name":"837f","type":9,"text":"Based on those helper tables, we built all the financial reporting.","markups":[]},{"name":"13cb","type":3,"text":"The Scaling Challenge","markups":[]},{"name":"b780","type":1,"text":"There were some advantages to this approach. Since we only relied on MySQL DB triggers and MySQL guarantees data accuracy, engineers had lots of flexibility to change the business logic and to move very fast. SQL based reports can be written very fast when the logic is simple.","markups":[]},{"name":"11e7","type":1,"text":"However, the SQL-based ETL approach was not scaling well:","markups":[]},{"name":"42e5","type":13,"text":"It wasn’t the right language for the programming model","markups":[{"type":2,"start":0,"end":54}]},{"name":"d3f3","type":9,"text":"SQL is good for lightweight data transformation. It is not designed to handle complicated business data flow. Modern software design principles can not be easily applied to decompose the complexity.","markups":[]},{"name":"739d","type":9,"text":"The original logic was tightly coupled with our core reservation logic. As Airbnb grew, the company needed to support product logic other than the original reservation flow, e.g. we needed to pay professional photographers, translators, and so on. Every product change had a unique money flow, and thus, financial and accounting impacts. As a result, we had to build many additional reports to meet each business need. Because the MySQL logic was structured around reservation logic, it was hard to modify and was extremely error prone when adding new logic for other products.","markups":[]},{"name":"786a","type":9,"text":"Validation and testing became impossible. To get a comprehensive result, we pulled the data separately for all the different reports and our finance team combined them at their discretion. Because we built all the reports separately, it could be very difficult to tell which change in which report caused issues if there were number mismatches. This was not scalable when the company wanted to change the product or add new products more frequently.","markups":[]},{"name":"ee51","type":9,"text":"As we added more and more reporting logic, and as our transaction volume grew, developing reports using SQL scripts became more complex, and prohibitively so. It became extremely difficult and time consuming to test the logic for accuracy.","markups":[]},{"name":"b3cc","type":13,"text":"The nightly runs were taking too much time","markups":[{"type":2,"start":0,"end":42}]},{"name":"0755","type":1,"text":"As our transaction volume grew and our transformation logic became more complex, the nightly pipeline took more time. A relational database is hard to scale up. It is difficult to shard the data and difficult to leverage a distributed system to process a massive amount of data. Towards the end of its life, we were only able to run it every other day due to its runtime of over 24 hours.","markups":[]},{"name":"1ec6","type":3,"text":"Our Goals:","markups":[]},{"name":"80bd","type":1,"text":"As we grow, we needed to be able to cope with dramatically increasing data size and the frequent addition of new Airbnb products and payment channels. Thus, we had two goals for our new system:","markups":[]},{"name":"f22e","type":9,"text":"The new system should give us enough flexibility to support more products as well as deal with product changes or accounting logic changes. To do this, we need to decouple the financial logic from the product logic. The representation of those product behaviors can be very generic in our financial system, e.g. how to book the receivable / payable / revenue / tax / etc. Thus we can build very sustainable financial reports based on highly normalized data.","markups":[{"type":1,"start":151,"end":215},{"type":2,"start":151,"end":215}]},{"name":"202c","type":9,"text":"The new system should scale horizontally. As volume grows, we should be able to scale out our system by just adding machines.","markups":[]},{"name":"dbbd","type":3,"text":"Introducing our new financial reporting pipeline","markups":[]},{"name":"a964","type":1,"text":"Our event based financial report is designed to:","markups":[]},{"name":"6a3e","type":9,"text":"support all current and future product types in our platform","markups":[]},{"name":"aed8","type":9,"text":"have a holistic view of all events with financial impact on our platform","markups":[]},{"name":"cc71","type":9,"text":"horizontally scale as our transaction volume grows","markups":[]},{"name":"59d2","type":1,"text":"It is powered by Apache Spark, stored on our HDFS cluster, and written in Scala. Spark is a fast and general engine for large-scale data processing, with implicit parallelism and fault-tolerance. We chose Scala as the language because we wanted the latest features of Spark, as well as the other benefits of the language, like types, closures, immutability, lazy evaluation, etc.","markups":[{"type":3,"start":17,"end":29,"href":"http://spark.apache.org/","title":"","rel":"","anchorType":0},{"type":3,"start":45,"end":49,"href":"http://hortonworks.com/apache/hdfs/","title":"","rel":"","anchorType":0},{"type":3,"start":74,"end":79,"href":"https://www.scala-lang.org/what-is-scala.html","title":"","rel":"","anchorType":0}]},{"name":"2e4f","type":1,"text":"This is huge considering our previous language was SQL.","markups":[]},{"name":"fac0","type":3,"text":"A brief overview of how it works","markups":[]},{"name":"e735","type":1,"text":"Our new financial reporting system has a concept of different product types, of which reservations are only one. Each product type has its own set of platform and payment events, and a corresponding set of financial events. Thus we can address each product type individually and systematically build up to a holistic report.","markups":[]},{"name":"9d2c","type":1,"text":"The system can be thought of as many event handlers that calculate the accounting impact of different products at different points in their life cycle. Because Scala has a strong static type system, while providing full support for functional programming, it is easy to design and write handlers about different products and how to process them.","markups":[]},{"name":"4289","type":1,"text":"Below is a diagram of how the data flows through the system. Don’t worry, we’ll explain everything.","markups":[]},{"name":"c4cb","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*1HCBBvi5d3OhjzSHVwn4lA.jpeg","originalWidth":492,"originalHeight":582}},{"name":"fb9b","type":1,"text":"Platform events are events that provide information about product related changes, like reservations, reservation alterations, photography, cancellations, etc. These usually have some financial expectation associated with them, but it is not always the case. Each time a product is created or updated, we derive an event for that product. For example, when a reservation is booked, we emit a booking event for the reservation product type. A day after the reservation starts, we consider the reservation to have “services rendered”. When the service is delivered to the customer (the guest in this case), we can then recognize revenue. These events are important because they have financial accounting implications, and we will talk about those more below.","markups":[{"type":1,"start":0,"end":81},{"type":2,"start":0,"end":81}]},{"name":"fbd1","type":1,"text":"Payment events describe money movement. They can be events where real money moves in and out of Airbnb bank accounts. Payment events also describe stored value, like when someone buys and uses gift cards. There are other kinds of payment events where money may not actually move, but we still have to account for the lack of cash movement. This can be when someone sends someone else a gift card, and that person claims it. We consider those to be balance transfers, or virtual movement. An example of no money movement would be when a guest uses a coupon. The money from the coupon is funded from the marketing budget, but no money has actually moved accounts — we just need to account for it somewhere. Money in must equal money out. Because coupons are on the guest side and don’t impact the original host payout amount and likewise the other host side operations, we need to take these into account so the money equation balances.","markups":[{"type":1,"start":0,"end":39},{"type":1,"start":705,"end":735},{"type":2,"start":0,"end":39},{"type":2,"start":705,"end":735}]},{"name":"2dc2","type":1,"text":"These events are currently generated from examining the aforementioned accounting audit rows for changes. If the change has an accounting impact, then a platform or payment event is generated. This system was designed as a central place for all the data to pass through from different systems. The financial reporting system processes these platform and payment events with event handlers, and produces accounting events that describe the accounting impact of those events.","markups":[]},{"name":"aeca","type":1,"text":"Accounting events are generated by event handlers that build them from the payment and platform events. We introduced this layer of abstraction to represent the relationship between the different platform and payment events for each product, as well as the accounting logic. Sometimes, as you’ll see below, a single platform event can generate more than one accounting event, because it has multiple accounting impacts at different times. These events basically keep track of what happened by assigning a unique identifier, the product type and the product id, to a set of activity. For us, we consider the product type and id to be the smallest accounting unit that we operate on.","markups":[{"type":1,"start":0,"end":102},{"type":2,"start":0,"end":103}]},{"name":"e68f","type":1,"text":"From accounting events, we generate the subledger, which is the basis for all of our financial accounting. Each entry is a detailed accounting record that includes information about the time a transaction occurred (payment or reservation booking), the amount, the currency, the direction of the monetary impact (credit or debit) and the account that it impacts.","markups":[{"type":1,"start":107,"end":213},{"type":2,"start":107,"end":213}]},{"name":"4a67","type":1,"text":"The subledger is generated using double entry accounting. Double entry accounting allows us to be sure that everything is accounted for properly in the system. This means no money appears or disappears without a source.","markups":[{"type":3,"start":33,"end":56,"href":"https://en.wikipedia.org/wiki/Double-entry_bookkeeping_system","title":"","rel":"","anchorType":0}]},{"name":"d9cd","type":1,"text":"Even though each product type may behave differently, we’ve found a generic life cycle that all product types share. Let’s walk through how a reservation would look in this framework.","markups":[]},{"name":"4eb3","type":4,"text":"","markups":[],"layout":1,"metadata":{"id":"1*h3_yS91yfS5UzuNiAcDVWw.jpeg","originalWidth":682,"originalHeight":497}},{"name":"da3f","type":1,"text":"An event happens that introduces some accounting liability, and a contract is created. No money has moved at this point, but expectations for future money flow are set up here. The accounting events at this point describe the contract that has been created.","markups":[]},{"name":"1053","type":9,"text":"Here, a guest has confirmed a two night reservation for $100. We refer to this time as booking date, and treat it as the contract start date. Of the $100, $90 is the price of the stay, $10 are fees. (This price breakdown is for example purposes only, and does not reflect any real reservation. We’ve also left the host fees out of this to simplify the explanation.)","markups":[]},{"name":"4a51","type":9,"text":"The guest and the host have entered into a contract with each other, with Airbnb acting as the platform and payment collection agent. In exchange for staying at this listing for two nights, the guest will pay Airbnb $100, and the host will receive $90 some time after check-in. On the date of the reservation confirmation, we have a guest receivable of $100, and a future host payable of $90, due to the host when we consider the reservation to be fulfilled. These expectations are set up as soon as the reservation is confirmed.","markups":[]},{"name":"6dc5","type":1,"text":"An event’s money flow occurs. This can happen anytime after the contract has been created. The accounting events here describe the direction and for what liability the amount is fulfilling.","markups":[]},{"name":"cf00","type":9,"text":"Here, the guest successfully pays $100 for the reservation. We would consider the guest receivable then fulfilled.","markups":[]},{"name":"335c","type":1,"text":"The event happens and so the contracted service is fulfilled.","markups":[]},{"name":"8f39","type":9,"text":"This is after the check-in time. This is the point in which we would recognize revenue and losses, if there are any. In this example, we didn’t have any. This is also the time that the scheduled $90 payout for the host should be delivered to the host. This means that the future host payable is now a host payable because it is now due.","markups":[]},{"name":"d225","type":1,"text":"More money flows may occur.","markups":[]},{"name":"d022","type":9,"text":"This is when we successfully deliver the $90 payout to the host. Now Airbnb’s host payable is $0 for this particular host.","markups":[]},{"name":"5540","type":1,"text":"Sometimes, there are alterations on a product or a payment. Examples would be a guest adding dates to a reservation inducing a reservation price change. To properly account for the price differences from an alteration, we “unbook” and “rebook” the reservation entirely at the time of alteration.","markups":[]},{"name":"8285","type":9,"text":"For example, if the reservation was previously booked for $100, and now it is $150 because the guest extended their stay at a later date, we could either book an additional $50 on the later date, or unbook the reservation for $100 and rebook it for $150 on that day. Why do you think we chose to do the latter? It’s because when alterations add up, it’s much easier to just unbook and rebook, instead of computing the delta every time. It’s the cleanest way we can deal with product alterations and data backfills. Just imagine how alterations on a long term reservation would look in our system!","markups":[]},{"name":"f41d","type":1,"text":"Now that we’ve built the subledgers from the platform and payment events, and their handlers, we can easily query for the financial impact to different accounts that any event generates.","markups":[]},{"name":"353b","type":1,"text":"An example of how revenue would be queried from the subledger is as follows:","markups":[]},{"name":"d0e9","type":11,"text":"","markups":[],"layout":1,"iframe":{"mediaResourceId":"b777d104e6a55d7fc1e1d322fdba1df5"}},{"name":"74fa","type":3,"text":"Key Takeaways","markups":[]},{"name":"b99f","type":13,"text":"It scales while maintaining quality and performance","markups":[{"type":2,"start":0,"end":51}]},{"name":"3873","type":1,"text":"Our financial reporting pipeline scales both on a product basis, and on a runtime basis. We can easily support new products on the financial engineering side because we’ve built a framework around the right abstractions, instead of tying it too closely with one specific product’s life cycle. We can also scale horizontally. This is much better than being limited by an Amazon RDS instance, no matter how beefy it may be. Our nightly runtime is 4–5 hours and has not been growing too much as of March 2017.","markups":[]},{"name":"ec83","type":13,"text":"It made troubleshooting much simpler","markups":[{"type":2,"start":0,"end":36}]},{"name":"6208","type":1,"text":"Before, when our Finance team needed comprehensive reports, we pulled the data separately for all the different reports and our finance team combined them at their discretion. Because we built all the reports separately, it could be very difficult to tell which change in which report caused unexpected deviances. This was not scalable when the company wanted to change the product or add new products more frequently. Now when there’s an issue, we investigate data from a single source of truth, significantly simplifying the troubleshooting process.","markups":[]},{"name":"ba4f","type":13,"text":"It made coding much simpler","markups":[{"type":2,"start":0,"end":27}]},{"name":"8e34","type":1,"text":"Going from declarative programming to functional programming has been a powerful paradigm shift for us to think about financial processing and accounting. We can now think of this system as a straightforward actor/handler system rather than getting mired in complicated SQL-join logic.","markups":[]},{"name":"b1b5","type":13,"text":"The nightly runs are timely and well monitored","markups":[{"type":2,"start":0,"end":46}]},{"name":"08c6","type":1,"text":"Originally, the MySQL ETL was scheduled via a crontab, and was dependent on data arriving via a different pipeline. Instead of taking upwards of a day to complete, the nightly run takes around 4–5 hours to complete. We no longer have to babysit a legacy system that quite frequently encounters snags caused by upstream changes, taking hours of developer time each week to resolve.","markups":[]},{"name":"1578","type":13,"text":"We built a comprehensive test framework","markups":[{"type":2,"start":0,"end":39}]},{"name":"481a","type":1,"text":"This is perhaps the important part of the picture. Because our financial processing and reporting is no longer in SQL, we are now also able to write extensive suites of unit tests against specific handlers. Together with integration tests and smoke tests, we can easily identify regressions and other errors. Smoke tests are rules we expect our data to follow and when rule violations occur, they are logged and addressed. This gives us a high degree of confidence in the quality of our data and lets us quickly vet new changes and roll them out. We have built an extensive (and ever expanding) test suite of real transactions, in which we check how we expect them to look in the system individually as well as in aggregate. This test framework is critical when we have time sensitive requests from our various partners in Finance and Legal, as well as from our audit partners, and need to be confident in our reporting.","markups":[]},{"name":"245c","type":3,"text":"Future looking","markups":[]},{"name":"a626","type":1,"text":"In the future, we will be moving towards an entirely event-based system. The financial reporting system will consume events emitted from other systems. Stay tuned to read about that in a future blog post. This will help us with even greater financial integrity and a richer vocabulary with which we can express different products and payment flows.","markups":[]},{"name":"eb00","type":1,"text":"In the end, what we want most at Airbnb is to have is complete, accurate and extensible financial reporting for all of our current and future products at Airbnb. We believe that we have designed the financial reporting system to be a strong foundation of all financial processing at Airbnb. Because of the clean decoupling of business logic and accounting logic, this system is product agnostic, extensible, and future-proof, which gives us confidence it will serve us well for many years to come. This is just the start of our back office financial systems at Airbnb.","markups":[]},{"name":"d680","type":1,"text":"If you enjoyed reading this and thought this was an interesting challenge, the payments team is always looking for talented people to join the team, whether you are a software engineer or a data scientist.","markups":[{"type":3,"start":167,"end":184,"href":"https://www.airbnb.com/careers/departments/engineering","title":"","rel":"noopener","anchorType":0},{"type":3,"start":190,"end":204,"href":"https://www.airbnb.com/careers/departments/data-science-analytics","title":"","rel":"noopener","anchorType":0}]},{"name":"2eb1","type":1,"text":"Please stay tuned for more on the Payments ecosystem at Airbnb!","markups":[]},{"name":"8c38","type":1,"text":"Many thanks to Sarah Hagstrom, Lou Kosak, Shawn Yan, Brian Wey, Jiangming Yang, and Ian Logan for reading through many drafts and helping me to write this post.","markups":[{"type":2,"start":0,"end":160}]}],"sections":[{"name":"8a1f","startIndex":0}]},"postDisplay":{"coverless":true}},"virtuals":{"statusForCollection":"APPROVED","allowNotes":true,"previewImage":{"imageId":"1*2F3AL1MjQLNFM39Lt5abjg.png","filter":"","backgroundSize":"","originalWidth":848,"originalHeight":340,"strategy":"resample","height":0,"width":0},"wordCount":3107,"imageCount":4,"readingTime":12.424528301886792,"subtitle":"At Airbnb, the Payments team is responsible for everything related to moving money in Airbnb’s global marketplace. We build technology that…","publishedInCount":1,"usersBySocialRecommends":[],"recommends":300,"socialRecommends":[],"isBookmarked":false,"tags":[{"slug":"big-data","name":"Big Data","postCount":10884,"virtuals":{"isFollowing":false},"metadata":{"followerCount":7121,"postCount":10884,"coverImage":{"id":"1*xHF26U0WHM9YuBWo9V7AAQ.jpeg","originalWidth":3840,"originalHeight":2560}},"type":"Tag"},{"slug":"analytics","name":"Analytics","postCount":6541,"virtuals":{"isFollowing":false},"metadata":{"followerCount":3131,"postCount":6541,"coverImage":{"id":"1*lxE-2kVXgfn9p34Fc9-Q0w.jpeg","originalWidth":1240,"originalHeight":705}},"type":"Tag"},{"slug":"payments","name":"Payments","postCount":4376,"virtuals":{"isFollowing":false},"metadata":{"followerCount":534,"postCount":4376,"coverImage":{"id":"1*ggdqgfuBElURkHByGVg7WQ.png","originalWidth":1600,"originalHeight":300,"isFeatured":true}},"type":"Tag"},{"slug":"scala","name":"Scala","postCount":704,"virtuals":{"isFollowing":false},"metadata":{"followerCount":934,"postCount":704,"coverImage":{"id":"1*nSyYUuo4dMlcajXuGt9dwQ.jpeg","originalWidth":800,"originalHeight":407}},"type":"Tag"},{"slug":"accounting","name":"Accounting","postCount":2581,"virtuals":{"isFollowing":false},"metadata":{"followerCount":195,"postCount":2581,"coverImage":{"id":"1*lQAfXpYh9DtzyH1bZEu1Dw.png","originalWidth":1792,"originalHeight":858}},"type":"Tag"}],"socialRecommendsCount":0,"responsesCreatedCount":10,"links":{"entries":[{"url":"https://medium.com/airbnb-engineering/scaling-airbnbs-payment-platform-43ebfc99b324#.3gu3yi77b","alts":[{"type":2,"url":"medium://p/43ebfc99b324"},{"type":3,"url":"medium://p/43ebfc99b324"}]}],"version":"0.3","generatedAt":1489740446566},"isLockedPreviewOnly":false,"takeoverId":"","metaDescription":"","totalClapCount":0},"coverless":true,"slug":"tracking-the-money-scaling-financial-reporting-at-airbnb","translationSourcePostId":"","translationSourceCreatorId":"","isApprovedTranslation":false,"inResponseToPostId":"","inResponseToRemovedAt":0,"isTitleSynthesized":true,"allowResponses":true,"importedUrl":"","importedPublishedAt":0,"visibility":0,"uniqueSlug":"tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040","previewContent":{"bodyModel":{"paragraphs":[{"name":"3de6","type":3,"text":"Tracking the Money — Scaling Financial Reporting at Airbnb","markups":[],"alignment":1},{"name":"4da4","type":4,"text":"","markups":[],"layout":9,"metadata":{"id":"1*2F3AL1MjQLNFM39Lt5abjg.png","originalWidth":848,"originalHeight":340}}],"sections":[{"startIndex":0}]},"isFullContent":false},"license":0,"inResponseToMediaResourceId":"","canonicalUrl":"https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040","approvedHomeCollectionId":"53c7c27702d5","approvedHomeCollection":{"id":"53c7c27702d5","name":"Airbnb Engineering & Data Science","slug":"airbnb-engineering","tags":["DATA SCIENCE","WEB DEVELOPMENT","OPEN SOURCE"],"creatorId":"ebe93072cafd","description":"Creative engineers and data scientists building a world where you can belong anywhere. http://airbnb.io","shortDescription":"Creative engineers and data scientists building a world…","image":{"imageId":"1*MlNQKg-sieBGW5prWoe9HQ.jpeg","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":9730,"postCount":24,"activeAt":1490122513650},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":""},"logo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"twitterUsername":"AirbnbEng","facebookPageName":"airbnbeng","collectionMastheadId":"7e48cc52dce0","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Airbnb Engineering & Data Science","description":"","backgroundImage":{},"logoImage":{},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":4,"postIds":["6d742b80f040","4ff4a0afac0e","e8619e3e5043","43ebfc99b324"]}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":3,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":4,"layout":5,"number":5,"postIds":[],"tagSlug":"Open Source","sectionHeader":"Open Source"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Data Science","sectionHeader":"Data Science"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Frontend","sectionHeader":"Frontend"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Payments","sectionHeader":"Payments"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[]}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[],"sectionHeader":"Latest"}}],"tintColor":"#FFFF585B","lightText":true,"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FFE04147","point":0},{"color":"#FFCF4044","point":0.1},{"color":"#FFBE3D40","point":0.2},{"color":"#FFAD3A3C","point":0.3},{"color":"#FF9B3737","point":0.4},{"color":"#FF893232","point":0.5},{"color":"#FF772D2D","point":0.6},{"color":"#FF652827","point":0.7},{"color":"#FF522120","point":0.8},{"color":"#FF3F1918","point":0.9},{"color":"#FF2B1010","point":1}],"backgroundColor":"#FFFFFFFF"},"tintBackgroundSpectrum":{"colorPoints":[{"color":"#FFFF585B","point":0},{"color":"#FFFF6969","point":0.1},{"color":"#FFFF7977","point":0.2},{"color":"#FFFF8985","point":0.3},{"color":"#FFFF9894","point":0.4},{"color":"#FFFFA7A2","point":0.5},{"color":"#FFFFB6B1","point":0.6},{"color":"#FFFFC5C0","point":0.7},{"color":"#FFFFD3CF","point":0.8},{"color":"#FFFFE2DD","point":0.9},{"color":"#FFFFF0EC","point":1}],"backgroundColor":"#FFFF585B"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFE0DC","point":0},{"color":"#FFFFDBD7","point":0.1},{"color":"#FFFFD6D1","point":0.2},{"color":"#FFFFD1CC","point":0.3},{"color":"#FFFFCBC6","point":0.4},{"color":"#FFFFC6C1","point":0.5},{"color":"#FFFFC0BB","point":0.6},{"color":"#FFFFBBB5","point":0.7},{"color":"#FFFFB5B0","point":0.8},{"color":"#FFFFAFAB","point":0.9},{"color":"#FFFFAAA5","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":1,"title":"Data Science","tagSlug":"data-science","url":"https://medium.com/airbnb-engineering/tagged/data-science","source":"tagSlug"},{"type":1,"title":"Open Source","tagSlug":"open-source","url":"https://medium.com/airbnb-engineering/tagged/open-source","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/airbnb-engineering/tagged/machine-learning","source":"tagSlug"},{"type":1,"title":"Payments","tagSlug":"payments","url":"https://medium.com/airbnb-engineering/tagged/payments","source":"tagSlug"},{"type":1,"title":"Security","tagSlug":"security","url":"https://medium.com/airbnb-engineering/tagged/security","source":"tagSlug"},{"type":1,"title":"Mobile","tagSlug":"mobile","url":"https://medium.com/airbnb-engineering/tagged/mobile","source":"tagSlug"}],"colorBehavior":2,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Airbnb Engineering & Data Science","description":"","backgroundImage":{},"logoImage":{},"alignment":2,"layout":5},"type":"Collection"},"newsletterId":"","webCanonicalUrl":"https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040","mediumUrl":"https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040","migrationId":"","notifyFollowers":true,"notifyTwitter":false,"isSponsored":false,"isRequestToPubDisabled":false,"notifyFacebook":false,"responseHiddenOnParentPostAt":0,"isSeries":false,"isSubscriptionLocked":false,"seriesLastAppendedAt":0,"type":"Post"},"mentionedUsers":[],"collaborators":[],"membershipPlans":[],"collectionUserRelations":[],"mode":null,"references":{"User":{"d701357ebd99":{"userId":"d701357ebd99","name":"Alice Liang","username":"sanitycannon","createdAt":1451753267327,"lastPostCreatedAt":1489524500468,"imageId":"0*RcWkrH0w7euJvJ-A.jpg","backgroundImageId":"","bio":"software engineer at Airbnb","twitterScreenName":"","socialStats":{"userId":"d701357ebd99","usersFollowedCount":156,"usersFollowedByCount":324,"type":"SocialStats"},"social":{"userId":"lo_9f9742b1b1f3","targetUserId":"d701357ebd99","type":"Social"},"facebookAccountId":"2851866929841","allowNotes":1,"type":"User"}},"Collection":{"53c7c27702d5":{"id":"53c7c27702d5","name":"Airbnb Engineering & Data Science","slug":"airbnb-engineering","tags":["DATA SCIENCE","WEB DEVELOPMENT","OPEN SOURCE"],"creatorId":"ebe93072cafd","description":"Creative engineers and data scientists building a world where you can belong anywhere. http://airbnb.io","shortDescription":"Creative engineers and data scientists building a world…","image":{"imageId":"1*MlNQKg-sieBGW5prWoe9HQ.jpeg","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"metadata":{"followerCount":9730,"postCount":24,"activeAt":1490122513650},"virtuals":{"permissions":{"canPublish":false,"canPublishAll":false,"canRepublish":false,"canRemove":false,"canManageAll":false,"canSubmit":false,"canEditPosts":false,"canAddWriters":false,"canViewStats":false,"canSendNewsletter":false,"canViewLockedPosts":false,"canViewCloaked":false,"canEditOwnPosts":false,"canBeAssignedAuthor":false},"isSubscribed":false,"isNewsletterSubscribed":false,"memberOfMembershipPlanId":""},"logo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"twitterUsername":"AirbnbEng","facebookPageName":"airbnbeng","collectionMastheadId":"7e48cc52dce0","sections":[{"type":2,"collectionHeaderMetadata":{"title":"Airbnb Engineering & Data Science","description":"","backgroundImage":{},"logoImage":{},"alignment":2,"layout":5}},{"type":1,"postListMetadata":{"source":3,"layout":4,"number":4,"postIds":["6d742b80f040","4ff4a0afac0e","e8619e3e5043","43ebfc99b324"]}},{"type":1,"postListMetadata":{"source":1,"layout":5,"number":3,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":4,"layout":5,"number":5,"postIds":[],"tagSlug":"Open Source","sectionHeader":"Open Source"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Data Science","sectionHeader":"Data Science"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Frontend","sectionHeader":"Frontend"}},{"type":1,"postListMetadata":{"source":4,"layout":4,"number":3,"postIds":[],"tagSlug":"Payments","sectionHeader":"Payments"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[],"sectionHeader":"Latest"}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[]}},{"type":1,"postListMetadata":{"source":1,"layout":4,"number":3,"postIds":[],"sectionHeader":"Latest"}}],"tintColor":"#FFFF585B","lightText":true,"favicon":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"colorPalette":{"defaultBackgroundSpectrum":{"colorPoints":[{"color":"#FFE04147","point":0},{"color":"#FFCF4044","point":0.1},{"color":"#FFBE3D40","point":0.2},{"color":"#FFAD3A3C","point":0.3},{"color":"#FF9B3737","point":0.4},{"color":"#FF893232","point":0.5},{"color":"#FF772D2D","point":0.6},{"color":"#FF652827","point":0.7},{"color":"#FF522120","point":0.8},{"color":"#FF3F1918","point":0.9},{"color":"#FF2B1010","point":1}],"backgroundColor":"#FFFFFFFF"},"tintBackgroundSpectrum":{"colorPoints":[{"color":"#FFFF585B","point":0},{"color":"#FFFF6969","point":0.1},{"color":"#FFFF7977","point":0.2},{"color":"#FFFF8985","point":0.3},{"color":"#FFFF9894","point":0.4},{"color":"#FFFFA7A2","point":0.5},{"color":"#FFFFB6B1","point":0.6},{"color":"#FFFFC5C0","point":0.7},{"color":"#FFFFD3CF","point":0.8},{"color":"#FFFFE2DD","point":0.9},{"color":"#FFFFF0EC","point":1}],"backgroundColor":"#FFFF585B"},"highlightSpectrum":{"colorPoints":[{"color":"#FFFFE0DC","point":0},{"color":"#FFFFDBD7","point":0.1},{"color":"#FFFFD6D1","point":0.2},{"color":"#FFFFD1CC","point":0.3},{"color":"#FFFFCBC6","point":0.4},{"color":"#FFFFC6C1","point":0.5},{"color":"#FFFFC0BB","point":0.6},{"color":"#FFFFBBB5","point":0.7},{"color":"#FFFFB5B0","point":0.8},{"color":"#FFFFAFAB","point":0.9},{"color":"#FFFFAAA5","point":1}],"backgroundColor":"#FFFFFFFF"}},"navItems":[{"type":1,"title":"Data Science","tagSlug":"data-science","url":"https://medium.com/airbnb-engineering/tagged/data-science","source":"tagSlug"},{"type":1,"title":"Open Source","tagSlug":"open-source","url":"https://medium.com/airbnb-engineering/tagged/open-source","source":"tagSlug"},{"type":1,"title":"Machine Learning","tagSlug":"machine-learning","url":"https://medium.com/airbnb-engineering/tagged/machine-learning","source":"tagSlug"},{"type":1,"title":"Payments","tagSlug":"payments","url":"https://medium.com/airbnb-engineering/tagged/payments","source":"tagSlug"},{"type":1,"title":"Security","tagSlug":"security","url":"https://medium.com/airbnb-engineering/tagged/security","source":"tagSlug"},{"type":1,"title":"Mobile","tagSlug":"mobile","url":"https://medium.com/airbnb-engineering/tagged/mobile","source":"tagSlug"}],"colorBehavior":2,"instantArticlesState":0,"acceleratedMobilePagesState":0,"ampLogo":{"imageId":"","filter":"","backgroundSize":"","originalWidth":0,"originalHeight":0,"strategy":"resample","height":0,"width":0},"header":{"title":"Airbnb Engineering & Data Science","description":"","backgroundImage":{},"logoImage":{},"alignment":2,"layout":5},"type":"Collection"}},"Social":{"d701357ebd99":{"userId":"lo_9f9742b1b1f3","targetUserId":"d701357ebd99","type":"Social"}},"SocialStats":{"d701357ebd99":{"userId":"d701357ebd99","usersFollowedCount":156,"usersFollowedByCount":324,"type":"SocialStats"}}}})
// ]]></script></body></html>